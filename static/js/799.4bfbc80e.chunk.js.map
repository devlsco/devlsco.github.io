{"version":3,"file":"static/js/799.4bfbc80e.chunk.js","mappings":"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","sources":["../node_modules/@d-fischer/detect-node/browser.js","../node_modules/@d-fischer/escape-string-regexp/index.js","../node_modules/@d-fischer/qs/lib/formats.js","../node_modules/@d-fischer/qs/lib/parse.js","../node_modules/@d-fischer/qs/lib/stringify.js","../node_modules/@d-fischer/qs/lib/utils.js","../node_modules/node-fetch/browser.js","../node_modules/@d-fischer/connection/es/PersistentConnection.mjs","../node_modules/@d-fischer/connection/node_modules/@d-fischer/isomorphic-ws/browser.mjs","../node_modules/@d-fischer/connection/es/AbstractConnection.mjs","../node_modules/@d-fischer/connection/es/WebSocketConnection.mjs","../node_modules/@d-fischer/logger/es/LogLevel.mjs","../node_modules/@d-fischer/logger/node_modules/tslib/tslib.es6.mjs","../node_modules/@d-fischer/logger/es/getMinLogLevelFromEnv.mjs","../node_modules/@d-fischer/logger/es/BaseLogger.mjs","../node_modules/@d-fischer/logger/es/NodeLogger.mjs","../node_modules/@d-fischer/logger/es/BrowserLogger.mjs","../node_modules/@d-fischer/logger/es/CustomLoggerWrapper.mjs","../node_modules/@d-fischer/logger/es/createLogger.mjs","../node_modules/@d-fischer/shared-utils/es/decorators/Enumerable.mjs","../node_modules/@d-fischer/shared-utils/es/functions/config/resolveConfigValue.mjs","../node_modules/@d-fischer/shared-utils/es/functions/math/fib.mjs","../node_modules/@d-fischer/shared-utils/es/functions/optional/mapOptional.mjs","../node_modules/@d-fischer/shared-utils/es/functions/promise/withResolvers.mjs","../node_modules/@d-fischer/shared-utils/node_modules/tslib/tslib.es6.mjs","../node_modules/@d-fischer/typed-event-emitter/es/Listener.mjs","../node_modules/@d-fischer/typed-event-emitter/es/EventEmitter.mjs","../node_modules/@twurple/auth/es/errors/InvalidTokenError.mjs","../node_modules/@d-fischer/cross-fetch/dist/node-ponyfill.mjs","../node_modules/@twurple/api-call/es/errors/HttpStatusCodeError.mjs","../node_modules/@twurple/api-call/es/helpers/transform.mjs","../node_modules/@twurple/api-call/es/helpers/url.mjs","../node_modules/@twurple/api-call/es/apiCall.mjs","../node_modules/@twurple/auth/es/helpers.external.mjs","../node_modules/@twurple/common/es/DataObject.mjs","../node_modules/@twurple/auth/es/TokenInfo.mjs","../node_modules/@twurple/auth/es/helpers.mjs","../node_modules/@twurple/auth/node_modules/tslib/tslib.es6.mjs","../node_modules/@twurple/chat/node_modules/tslib/tslib.es6.mjs","../node_modules/@d-fischer/rate-limiter/node_modules/tslib/tslib.es6.mjs","../node_modules/@d-fischer/rate-limiter/es/errors/CustomError.mjs","../node_modules/@d-fischer/rate-limiter/es/errors/RateLimitReachedError.mjs","../node_modules/@d-fischer/rate-limiter/es/limiters/TimeBasedRateLimiter.mjs","../node_modules/@d-fischer/rate-limiter/es/limiters/TimedPassthruRateLimiter.mjs","../node_modules/@d-fischer/rate-limiter/es/limiters/PartitionedTimeBasedRateLimiter.mjs","../node_modules/@twurple/auth/es/errors/InvalidTokenTypeError.mjs","../node_modules/@twurple/auth/es/AccessToken.mjs","../node_modules/@twurple/common/es/userResolvers.mjs","../node_modules/@twurple/auth/es/errors/CachedRefreshFailureError.mjs","../node_modules/@twurple/auth/es/errors/IntermediateUserRemovalError.mjs","../node_modules/@twurple/auth/es/errors/UnknownIntentError.mjs","../node_modules/@twurple/auth/es/TokenFetcher.mjs","../node_modules/@twurple/auth/es/providers/RefreshingAuthProvider.mjs","../node_modules/ircv3/node_modules/tslib/tslib.es6.mjs","../node_modules/@d-fischer/connection/es/DirectConnection-stub.mjs","../node_modules/@d-fischer/shared-utils/es/functions/object/arrayToObject.mjs","../node_modules/@d-fischer/shared-utils/es/functions/string/splitWithLimit.mjs","../node_modules/@d-fischer/shared-utils/es/functions/string/padLeft.mjs","../node_modules/@d-fischer/shared-utils/es/functions/object/forEachObjectEntry.mjs","../node_modules/klona/json/index.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/AwayNotifyCapability.mjs","../node_modules/ircv3/es/Errors/NotEnoughParametersError.mjs","../node_modules/ircv3/es/Errors/ParameterRequirementMismatchError.mjs","../node_modules/ircv3/es/ServerProperties.mjs","../node_modules/ircv3/es/Toolkit/StringTools.mjs","../node_modules/ircv3/es/Message/Message.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/BatchCapability/MessageTypes/Commands/Batch.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/BatchCapability/index.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/CapNotifyCapability.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/ChgHostCapability/MessageTypes/Commands/ChgHost.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/ChgHostCapability/index.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/InviteNotifyCapability.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/LabeledResponseCapability/MessageTypes/Commands/Acknowledgement.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/LabeledResponseCapability/index.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/MessageTagsCapability.mjs","../node_modules/ircv3/es/Capability/CoreCapabilities/MultiPrefixCapability.mjs","../node_modules/ircv3/es/Message/MessageCollector.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Password.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/NickChange.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/UserRegistration.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/OperLogin.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ClientQuit.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ServerQuit.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ChannelJoin.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ChannelPart.mjs","../node_modules/ircv3/es/Errors/UnknownChannelModeCharError.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Mode.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Topic.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Names.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ChannelList.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ChannelInvite.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ChannelKick.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Time.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/PrivateMessage.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Notice.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/WhoQuery.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/WhoIsQuery.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/WhoWasQuery.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Kill.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Ping.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Pong.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/ErrorMessage.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Away.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Rehash.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/Restart.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/WallopsMessage.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/UserHostQuery.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/IsOnQuery.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/CapabilityNegotiation.mjs","../node_modules/ircv3/es/Message/MessageTypes/Commands/TagMessage.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply001Welcome.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply002YourHost.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply003Created.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply004ServerInfo.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply005Isupport.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply221UmodeIs.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply301Away.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply302UserHost.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply305UnAway.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply306NowAway.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply311WhoisUser.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply315EndOfWho.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply318EndOfWhois.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply319WhoisChannels.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply322List.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply323ListEnd.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply324ChannelModeIs.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply331NoTopic.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply332Topic.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply333TopicWhoTime.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply341Inviting.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply348ExceptList.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply349EndOfExceptList.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply352WhoReply.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply353NamesReply.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply366EndOfNames.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply367BanList.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply368EndOfBanList.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply372Motd.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply375MotdStart.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply376EndOfMotd.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply381YoureOper.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Reply391Time.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error401NoSuchNick.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error402NoSuchServer.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error403NoSuchChannel.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error404CanNotSendToChan.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error405TooManyChannels.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error410InvalidCapCmd.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error421UnknownCommand.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error422NoMotd.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error431NoNickNameGiven.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error432ErroneusNickname.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error433NickNameInUse.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error436NickCollision.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error441UserNotInChannel.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error442NotOnChannel.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error443UserOnChannel.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error451NotRegistered.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error461NeedMoreParams.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error462AlreadyRegistered.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error471ChannelIsFull.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error472UnknownMode.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error473InviteOnlyChan.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error474BannedFromChan.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error475BadChannelKey.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error479BadChanName.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error481NoPrivileges.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error482ChanOpPrivsNeeded.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error491NoOperHost.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error501UmodeUnknownFlag.mjs","../node_modules/ircv3/es/Message/MessageTypes/Numerics/Error502UsersDontMatch.mjs","../node_modules/ircv3/es/Message/MessageTypes/index.mjs","../node_modules/ircv3/es/Message/MessageParser.mjs","../node_modules/ircv3/es/IrcClient.mjs","../node_modules/ircv3/es/Errors/MessageError.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/messageTypes/ClearChat.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/messageTypes/Reconnect.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/messageTypes/RoomState.mjs","../node_modules/@d-fischer/cache-decorators/es/utils/createCacheKey.mjs","../node_modules/@d-fischer/cache-decorators/es/decorators/CachedGetter.mjs","../node_modules/@twurple/chat/es/ChatUser.mjs","../node_modules/@twurple/chat/es/utils/emoteUtil.mjs","../node_modules/@d-fischer/cache-decorators/es/decorators/Cacheable.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/messageTypes/UserNotice.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/messageTypes/UserState.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/messageTypes/Whisper.mjs","../node_modules/@twurple/chat/es/caps/twitchCommands/index.mjs","../node_modules/@twurple/chat/es/caps/TwitchMembershipCapability.mjs","../node_modules/@twurple/chat/es/caps/twitchTags/messageTypes/ClearMsg.mjs","../node_modules/@twurple/chat/es/caps/twitchTags/messageTypes/GlobalUserState.mjs","../node_modules/@twurple/chat/es/caps/twitchTags/index.mjs","../node_modules/@twurple/chat/es/commands/ChatMessage.mjs","../node_modules/@twurple/chat/es/utils/messageUtil.mjs","../node_modules/@twurple/chat/es/utils/userUtil.mjs","../node_modules/@twurple/chat/es/ChatClient.mjs","../node_modules/@d-fischer/shared-utils/es/functions/promise/delay.mjs","../node_modules/@twurple/chat/es/ChatMessageAttributes.mjs","../node_modules/@twurple/common/es/errors/CustomError.mjs","../node_modules/@twurple/common/es/errors/HellFreezesOverError.mjs","../node_modules/@twurple/common/es/rtfm.mjs","../node_modules/@twurple/pubsub/node_modules/tslib/tslib.es6.mjs","../node_modules/@twurple/pubsub/es/BasicPubSubClient.mjs","../node_modules/@twurple/pubsub/es/PubSubPacket.external.mjs"],"sourcesContent":["module.exports.isNode = false;\n\n","'use strict';\n\nmodule.exports = string => {\n\tif (typeof string !== 'string') {\n\t\tthrow new TypeError('Expected a string');\n\t}\n\n\t// Escape characters with special meaning either inside or outside character sets.\n\t// Use a simple backslash escape when it’s always valid, and a \\unnnn escape when the simpler form would be disallowed by Unicode patterns’ stricter grammar.\n\treturn string\n\t\t.replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&')\n\t\t.replace(/-/g, '\\\\x2d');\n};\n\nmodule.exports.default = module.exports;\n","'use strict';\n\nvar replace = String.prototype.replace;\nvar percentTwenties = /%20/g;\n\nvar util = require('./utils');\n\nvar Format = {\n    RFC1738: 'RFC1738',\n    RFC3986: 'RFC3986'\n};\n\nmodule.exports = util.assign(\n    {\n        'default': Format.RFC3986,\n        formatters: {\n            RFC1738: function (value) {\n                return replace.call(value, percentTwenties, '+');\n            },\n            RFC3986: function (value) {\n                return String(value);\n            }\n        }\n    },\n    Format\n);\n","'use strict';\n\nvar utils = require('./utils');\n\nvar has = Object.prototype.hasOwnProperty;\nvar isArray = Array.isArray;\n\nvar defaults = {\n    allowDots: false,\n    allowPrototypes: false,\n    arrayLimit: 20,\n    charset: 'utf-8',\n    charsetSentinel: false,\n    comma: false,\n    decoder: utils.decode,\n    delimiter: '&',\n    depth: 5,\n    ignoreQueryPrefix: false,\n    interpretNumericEntities: false,\n    parameterLimit: 1000,\n    parseArrays: true,\n    plainObjects: false,\n    strictNullHandling: false\n};\n\nvar interpretNumericEntities = function (str) {\n    return str.replace(/&#(\\d+);/g, function ($0, numberStr) {\n        return String.fromCharCode(parseInt(numberStr, 10));\n    });\n};\n\nvar parseArrayValue = function (val, options) {\n    if (val && typeof val === 'string' && options.comma && val.indexOf(',') > -1) {\n        return val.split(',');\n    }\n\n    return val;\n};\n\nvar maybeMap = function maybeMap(val, fn) {\n    if (isArray(val)) {\n        var mapped = [];\n        for (var i = 0; i < val.length; i += 1) {\n            mapped.push(fn(val[i]));\n        }\n        return mapped;\n    }\n    return fn(val);\n};\n\n// This is what browsers will submit when the ✓ character occurs in an\n// application/x-www-form-urlencoded body and the encoding of the page containing\n// the form is iso-8859-1, or when the submitted form has an accept-charset\n// attribute of iso-8859-1. Presumably also with other charsets that do not contain\n// the ✓ character, such as us-ascii.\nvar isoSentinel = 'utf8=%26%2310003%3B'; // encodeURIComponent('&#10003;')\n\n// These are the percent-encoded utf-8 octets representing a checkmark, indicating that the request actually is utf-8 encoded.\nvar charsetSentinel = 'utf8=%E2%9C%93'; // encodeURIComponent('✓')\n\nvar parseValues = function parseQueryStringValues(str, options) {\n    var obj = {};\n    var cleanStr = options.ignoreQueryPrefix ? str.replace(/^\\?/, '') : str;\n    var limit = options.parameterLimit === Infinity ? undefined : options.parameterLimit;\n    var parts = cleanStr.split(options.delimiter, limit);\n    var skipIndex = -1; // Keep track of where the utf8 sentinel was found\n    var i;\n\n    var charset = options.charset;\n    if (options.charsetSentinel) {\n        for (i = 0; i < parts.length; ++i) {\n            if (parts[i].indexOf('utf8=') === 0) {\n                if (parts[i] === charsetSentinel) {\n                    charset = 'utf-8';\n                } else if (parts[i] === isoSentinel) {\n                    charset = 'iso-8859-1';\n                }\n                skipIndex = i;\n                i = parts.length; // The eslint settings do not allow break;\n            }\n        }\n    }\n\n    for (i = 0; i < parts.length; ++i) {\n        if (i === skipIndex) {\n            continue;\n        }\n        var part = parts[i];\n\n        var bracketEqualsPos = part.indexOf(']=');\n        var pos = bracketEqualsPos === -1 ? part.indexOf('=') : bracketEqualsPos + 1;\n\n        var key, val;\n        if (pos === -1) {\n            key = options.decoder(part, defaults.decoder, charset, 'key');\n            val = options.strictNullHandling ? null : '';\n        } else {\n            key = options.decoder(part.slice(0, pos), defaults.decoder, charset, 'key');\n            val = maybeMap(\n                parseArrayValue(part.slice(pos + 1), options),\n                function (encodedVal) {\n                    return options.decoder(encodedVal, defaults.decoder, charset, 'value');\n                }\n            );\n        }\n\n        if (val && options.interpretNumericEntities && charset === 'iso-8859-1') {\n            val = interpretNumericEntities(val);\n        }\n\n        if (part.indexOf('[]=') > -1) {\n            val = isArray(val) ? [val] : val;\n        }\n\n        if (has.call(obj, key)) {\n            obj[key] = utils.combine(obj[key], val);\n        } else {\n            obj[key] = val;\n        }\n    }\n\n    return obj;\n};\n\nvar parseObject = function (chain, val, options, valuesParsed) {\n    var leaf = valuesParsed ? val : parseArrayValue(val, options);\n\n    for (var i = chain.length - 1; i >= 0; --i) {\n        var obj;\n        var root = chain[i];\n\n        if (root === '[]' && options.parseArrays) {\n            obj = [].concat(leaf);\n        } else {\n            obj = options.plainObjects ? Object.create(null) : {};\n            var cleanRoot = root.charAt(0) === '[' && root.charAt(root.length - 1) === ']' ? root.slice(1, -1) : root;\n            var index = parseInt(cleanRoot, 10);\n            if (!options.parseArrays && cleanRoot === '') {\n                obj = { 0: leaf };\n            } else if (\n                !isNaN(index)\n                && root !== cleanRoot\n                && String(index) === cleanRoot\n                && index >= 0\n                && (options.parseArrays && index <= options.arrayLimit)\n            ) {\n                obj = [];\n                obj[index] = leaf;\n            } else {\n                obj[cleanRoot] = leaf;\n            }\n        }\n\n        leaf = obj; // eslint-disable-line no-param-reassign\n    }\n\n    return leaf;\n};\n\nvar parseKeys = function parseQueryStringKeys(givenKey, val, options, valuesParsed) {\n    if (!givenKey) {\n        return;\n    }\n\n    // Transform dot notation to bracket notation\n    var key = options.allowDots ? givenKey.replace(/\\.([^.[]+)/g, '[$1]') : givenKey;\n\n    // The regex chunks\n\n    var brackets = /(\\[[^[\\]]*])/;\n    var child = /(\\[[^[\\]]*])/g;\n\n    // Get the parent\n\n    var segment = options.depth > 0 && brackets.exec(key);\n    var parent = segment ? key.slice(0, segment.index) : key;\n\n    // Stash the parent if it exists\n\n    var keys = [];\n    if (parent) {\n        // If we aren't using plain objects, optionally prefix keys that would overwrite object prototype properties\n        if (!options.plainObjects && has.call(Object.prototype, parent)) {\n            if (!options.allowPrototypes) {\n                return;\n            }\n        }\n\n        keys.push(parent);\n    }\n\n    // Loop through children appending to the array until we hit depth\n\n    var i = 0;\n    while (options.depth > 0 && (segment = child.exec(key)) !== null && i < options.depth) {\n        i += 1;\n        if (!options.plainObjects && has.call(Object.prototype, segment[1].slice(1, -1))) {\n            if (!options.allowPrototypes) {\n                return;\n            }\n        }\n        keys.push(segment[1]);\n    }\n\n    // If there's a remainder, just add whatever is left\n\n    if (segment) {\n        keys.push('[' + key.slice(segment.index) + ']');\n    }\n\n    return parseObject(keys, val, options, valuesParsed);\n};\n\nvar normalizeParseOptions = function normalizeParseOptions(opts) {\n    if (!opts) {\n        return defaults;\n    }\n\n    if (opts.decoder !== null && opts.decoder !== undefined && typeof opts.decoder !== 'function') {\n        throw new TypeError('Decoder has to be a function.');\n    }\n\n    if (typeof opts.charset !== 'undefined' && opts.charset !== 'utf-8' && opts.charset !== 'iso-8859-1') {\n        throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');\n    }\n    var charset = typeof opts.charset === 'undefined' ? defaults.charset : opts.charset;\n\n    return {\n        allowDots: typeof opts.allowDots === 'undefined' ? defaults.allowDots : !!opts.allowDots,\n        allowPrototypes: typeof opts.allowPrototypes === 'boolean' ? opts.allowPrototypes : defaults.allowPrototypes,\n        arrayLimit: typeof opts.arrayLimit === 'number' ? opts.arrayLimit : defaults.arrayLimit,\n        charset: charset,\n        charsetSentinel: typeof opts.charsetSentinel === 'boolean' ? opts.charsetSentinel : defaults.charsetSentinel,\n        comma: typeof opts.comma === 'boolean' ? opts.comma : defaults.comma,\n        decoder: typeof opts.decoder === 'function' ? opts.decoder : defaults.decoder,\n        delimiter: typeof opts.delimiter === 'string' || utils.isRegExp(opts.delimiter) ? opts.delimiter : defaults.delimiter,\n        // eslint-disable-next-line no-implicit-coercion, no-extra-parens\n        depth: (typeof opts.depth === 'number' || opts.depth === false) ? +opts.depth : defaults.depth,\n        ignoreQueryPrefix: opts.ignoreQueryPrefix === true,\n        interpretNumericEntities: typeof opts.interpretNumericEntities === 'boolean' ? opts.interpretNumericEntities : defaults.interpretNumericEntities,\n        parameterLimit: typeof opts.parameterLimit === 'number' ? opts.parameterLimit : defaults.parameterLimit,\n        parseArrays: opts.parseArrays !== false,\n        plainObjects: typeof opts.plainObjects === 'boolean' ? opts.plainObjects : defaults.plainObjects,\n        strictNullHandling: typeof opts.strictNullHandling === 'boolean' ? opts.strictNullHandling : defaults.strictNullHandling\n    };\n};\n\nmodule.exports = function (str, opts) {\n    var options = normalizeParseOptions(opts);\n\n    if (str === '' || str === null || typeof str === 'undefined') {\n        return options.plainObjects ? Object.create(null) : {};\n    }\n\n    var tempObj = typeof str === 'string' ? parseValues(str, options) : str;\n    var obj = options.plainObjects ? Object.create(null) : {};\n\n    // Iterate over the keys and setup the new object\n\n    var keys = Object.keys(tempObj);\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var newObj = parseKeys(key, tempObj[key], options, typeof str === 'string');\n        obj = utils.merge(obj, newObj, options);\n    }\n\n    return utils.compact(obj);\n};\n","'use strict';\n\nvar utils = require('./utils');\nvar formats = require('./formats');\nvar has = Object.prototype.hasOwnProperty;\n\nvar arrayPrefixGenerators = {\n    brackets: function brackets(prefix) {\n        return prefix + '[]';\n    },\n    comma: 'comma',\n    indices: function indices(prefix, key) {\n        return prefix + '[' + key + ']';\n    },\n    repeat: function repeat(prefix) {\n        return prefix;\n    }\n};\n\nvar isArray = Array.isArray;\nvar push = Array.prototype.push;\nvar pushToArray = function (arr, valueOrArray) {\n    push.apply(arr, isArray(valueOrArray) ? valueOrArray : [valueOrArray]);\n};\n\nvar toISO = Date.prototype.toISOString;\n\nvar defaultFormat = formats['default'];\nvar defaults = {\n    addQueryPrefix: false,\n    allowDots: false,\n    charset: 'utf-8',\n    charsetSentinel: false,\n    delimiter: '&',\n    encode: true,\n    encoder: utils.encode,\n    encodeValuesOnly: false,\n    format: defaultFormat,\n    formatter: formats.formatters[defaultFormat],\n    // deprecated\n    indices: false,\n    serializeDate: function serializeDate(date) {\n        return toISO.call(date);\n    },\n    skipNulls: false,\n    strictNullHandling: false\n};\n\nvar isNonNullishPrimitive = function isNonNullishPrimitive(v) {\n    return typeof v === 'string'\n        || typeof v === 'number'\n        || typeof v === 'boolean'\n        || typeof v === 'symbol'\n        || typeof v === 'bigint';\n};\n\nvar stringify = function stringify(\n    object,\n    prefix,\n    generateArrayPrefix,\n    strictNullHandling,\n    skipNulls,\n    encoder,\n    filter,\n    sort,\n    allowDots,\n    serializeDate,\n    formatter,\n    encodeValuesOnly,\n    charset\n) {\n    var obj = object;\n    if (typeof filter === 'function') {\n        obj = filter(prefix, obj);\n    } else if (obj instanceof Date) {\n        obj = serializeDate(obj);\n    } else if (generateArrayPrefix === 'comma' && isArray(obj)) {\n        obj = obj.join(',');\n    }\n\n    if (obj === null) {\n        if (strictNullHandling) {\n            return encoder && !encodeValuesOnly ? encoder(prefix, defaults.encoder, charset, 'key') : prefix;\n        }\n\n        obj = '';\n    }\n\n    if (isNonNullishPrimitive(obj) || utils.isBuffer(obj)) {\n        if (encoder) {\n            var keyValue = encodeValuesOnly ? prefix : encoder(prefix, defaults.encoder, charset, 'key');\n            return [formatter(keyValue) + '=' + formatter(encoder(obj, defaults.encoder, charset, 'value'))];\n        }\n        return [formatter(prefix) + '=' + formatter(String(obj))];\n    }\n\n    var values = [];\n\n    if (typeof obj === 'undefined') {\n        return values;\n    }\n\n    var objKeys;\n    if (isArray(filter)) {\n        objKeys = filter;\n    } else {\n        var keys = Object.keys(obj);\n        objKeys = sort ? keys.sort(sort) : keys;\n    }\n\n    for (var i = 0; i < objKeys.length; ++i) {\n        var key = objKeys[i];\n\n        if (skipNulls && obj[key] === null) {\n            continue;\n        }\n\n        if (isArray(obj)) {\n            pushToArray(values, stringify(\n                obj[key],\n                typeof generateArrayPrefix === 'function' ? generateArrayPrefix(prefix, key) : prefix,\n                generateArrayPrefix,\n                strictNullHandling,\n                skipNulls,\n                encoder,\n                filter,\n                sort,\n                allowDots,\n                serializeDate,\n                formatter,\n                encodeValuesOnly,\n                charset\n            ));\n        } else {\n            pushToArray(values, stringify(\n                obj[key],\n                prefix + (allowDots ? '.' + key : '[' + key + ']'),\n                generateArrayPrefix,\n                strictNullHandling,\n                skipNulls,\n                encoder,\n                filter,\n                sort,\n                allowDots,\n                serializeDate,\n                formatter,\n                encodeValuesOnly,\n                charset\n            ));\n        }\n    }\n\n    return values;\n};\n\nvar normalizeStringifyOptions = function normalizeStringifyOptions(opts) {\n    if (!opts) {\n        return defaults;\n    }\n\n    if (opts.encoder !== null && opts.encoder !== undefined && typeof opts.encoder !== 'function') {\n        throw new TypeError('Encoder has to be a function.');\n    }\n\n    var charset = opts.charset || defaults.charset;\n    if (typeof opts.charset !== 'undefined' && opts.charset !== 'utf-8' && opts.charset !== 'iso-8859-1') {\n        throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');\n    }\n\n    var format = formats['default'];\n    if (typeof opts.format !== 'undefined') {\n        if (!has.call(formats.formatters, opts.format)) {\n            throw new TypeError('Unknown format option provided.');\n        }\n        format = opts.format;\n    }\n    var formatter = formats.formatters[format];\n\n    var filter = defaults.filter;\n    if (typeof opts.filter === 'function' || isArray(opts.filter)) {\n        filter = opts.filter;\n    }\n\n    return {\n        addQueryPrefix: typeof opts.addQueryPrefix === 'boolean' ? opts.addQueryPrefix : defaults.addQueryPrefix,\n        allowDots: typeof opts.allowDots === 'undefined' ? defaults.allowDots : !!opts.allowDots,\n        charset: charset,\n        charsetSentinel: typeof opts.charsetSentinel === 'boolean' ? opts.charsetSentinel : defaults.charsetSentinel,\n        delimiter: typeof opts.delimiter === 'undefined' ? defaults.delimiter : opts.delimiter,\n        encode: typeof opts.encode === 'boolean' ? opts.encode : defaults.encode,\n        encoder: typeof opts.encoder === 'function' ? opts.encoder : defaults.encoder,\n        encodeValuesOnly: typeof opts.encodeValuesOnly === 'boolean' ? opts.encodeValuesOnly : defaults.encodeValuesOnly,\n        filter: filter,\n        formatter: formatter,\n        serializeDate: typeof opts.serializeDate === 'function' ? opts.serializeDate : defaults.serializeDate,\n        skipNulls: typeof opts.skipNulls === 'boolean' ? opts.skipNulls : defaults.skipNulls,\n        sort: typeof opts.sort === 'function' ? opts.sort : null,\n        strictNullHandling: typeof opts.strictNullHandling === 'boolean' ? opts.strictNullHandling : defaults.strictNullHandling\n    };\n};\n\nmodule.exports = function (object, opts) {\n    var obj = object;\n    var options = normalizeStringifyOptions(opts);\n\n    var objKeys;\n    var filter;\n\n    if (typeof options.filter === 'function') {\n        filter = options.filter;\n        obj = filter('', obj);\n    } else if (isArray(options.filter)) {\n        filter = options.filter;\n        objKeys = filter;\n    }\n\n    var keys = [];\n\n    if (typeof obj !== 'object' || obj === null) {\n        return '';\n    }\n\n    var arrayFormat;\n    if (opts && opts.arrayFormat in arrayPrefixGenerators) {\n        arrayFormat = opts.arrayFormat;\n    } else if (opts && 'indices' in opts) {\n        arrayFormat = opts.indices ? 'indices' : 'repeat';\n    } else {\n        arrayFormat = 'indices';\n    }\n\n    var generateArrayPrefix = arrayPrefixGenerators[arrayFormat];\n\n    if (!objKeys) {\n        objKeys = Object.keys(obj);\n    }\n\n    if (options.sort) {\n        objKeys.sort(options.sort);\n    }\n\n    for (var i = 0; i < objKeys.length; ++i) {\n        var key = objKeys[i];\n\n        if (options.skipNulls && obj[key] === null) {\n            continue;\n        }\n        pushToArray(keys, stringify(\n            obj[key],\n            key,\n            generateArrayPrefix,\n            options.strictNullHandling,\n            options.skipNulls,\n            options.encode ? options.encoder : null,\n            options.filter,\n            options.sort,\n            options.allowDots,\n            options.serializeDate,\n            options.formatter,\n            options.encodeValuesOnly,\n            options.charset\n        ));\n    }\n\n    var joined = keys.join(options.delimiter);\n    var prefix = options.addQueryPrefix === true ? '?' : '';\n\n    if (options.charsetSentinel) {\n        if (options.charset === 'iso-8859-1') {\n            // encodeURIComponent('&#10003;'), the \"numeric entity\" representation of a checkmark\n            prefix += 'utf8=%26%2310003%3B&';\n        } else {\n            // encodeURIComponent('✓')\n            prefix += 'utf8=%E2%9C%93&';\n        }\n    }\n\n    return joined.length > 0 ? prefix + joined : '';\n};\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\nvar isArray = Array.isArray;\n\nvar hexTable = (function () {\n    var array = [];\n    for (var i = 0; i < 256; ++i) {\n        array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase());\n    }\n\n    return array;\n}());\n\nvar compactQueue = function compactQueue(queue) {\n    while (queue.length > 1) {\n        var item = queue.pop();\n        var obj = item.obj[item.prop];\n\n        if (isArray(obj)) {\n            var compacted = [];\n\n            for (var j = 0; j < obj.length; ++j) {\n                if (typeof obj[j] !== 'undefined') {\n                    compacted.push(obj[j]);\n                }\n            }\n\n            item.obj[item.prop] = compacted;\n        }\n    }\n};\n\nvar arrayToObject = function arrayToObject(source, options) {\n    var obj = options && options.plainObjects ? Object.create(null) : {};\n    for (var i = 0; i < source.length; ++i) {\n        if (typeof source[i] !== 'undefined') {\n            obj[i] = source[i];\n        }\n    }\n\n    return obj;\n};\n\nvar merge = function merge(target, source, options) {\n    /* eslint no-param-reassign: 0 */\n    if (!source) {\n        return target;\n    }\n\n    if (typeof source !== 'object') {\n        if (isArray(target)) {\n            target.push(source);\n        } else if (target && typeof target === 'object') {\n            if ((options && (options.plainObjects || options.allowPrototypes)) || !has.call(Object.prototype, source)) {\n                target[source] = true;\n            }\n        } else {\n            return [target, source];\n        }\n\n        return target;\n    }\n\n    if (!target || typeof target !== 'object') {\n        return [target].concat(source);\n    }\n\n    var mergeTarget = target;\n    if (isArray(target) && !isArray(source)) {\n        mergeTarget = arrayToObject(target, options);\n    }\n\n    if (isArray(target) && isArray(source)) {\n        source.forEach(function (item, i) {\n            if (has.call(target, i)) {\n                var targetItem = target[i];\n                if (targetItem && typeof targetItem === 'object' && item && typeof item === 'object') {\n                    target[i] = merge(targetItem, item, options);\n                } else {\n                    target.push(item);\n                }\n            } else {\n                target[i] = item;\n            }\n        });\n        return target;\n    }\n\n    return Object.keys(source).reduce(function (acc, key) {\n        var value = source[key];\n\n        if (has.call(acc, key)) {\n            acc[key] = merge(acc[key], value, options);\n        } else {\n            acc[key] = value;\n        }\n        return acc;\n    }, mergeTarget);\n};\n\nvar assign = function assignSingleSource(target, source) {\n    return Object.keys(source).reduce(function (acc, key) {\n        acc[key] = source[key];\n        return acc;\n    }, target);\n};\n\nvar decode = function (str, decoder, charset) {\n    var strWithoutPlus = str.replace(/\\+/g, ' ');\n    if (charset === 'iso-8859-1') {\n        // unescape never throws, no try...catch needed:\n        return strWithoutPlus.replace(/%[0-9a-f]{2}/gi, unescape);\n    }\n    // utf-8\n    try {\n        return decodeURIComponent(strWithoutPlus);\n    } catch (e) {\n        return strWithoutPlus;\n    }\n};\n\nvar encode = function encode(str, defaultEncoder, charset) {\n    // This code was originally written by Brian White (mscdex) for the io.js core querystring library.\n    // It has been adapted here for stricter adherence to RFC 3986\n    if (str.length === 0) {\n        return str;\n    }\n\n    var string = str;\n    if (typeof str === 'symbol') {\n        string = Symbol.prototype.toString.call(str);\n    } else if (typeof str !== 'string') {\n        string = String(str);\n    }\n\n    if (charset === 'iso-8859-1') {\n        return escape(string).replace(/%u[0-9a-f]{4}/gi, function ($0) {\n            return '%26%23' + parseInt($0.slice(2), 16) + '%3B';\n        });\n    }\n\n    var out = '';\n    for (var i = 0; i < string.length; ++i) {\n        var c = string.charCodeAt(i);\n\n        if (\n            c === 0x2D // -\n            || c === 0x2E // .\n            || c === 0x5F // _\n            || c === 0x7E // ~\n            || (c >= 0x30 && c <= 0x39) // 0-9\n            || (c >= 0x41 && c <= 0x5A) // a-z\n            || (c >= 0x61 && c <= 0x7A) // A-Z\n        ) {\n            out += string.charAt(i);\n            continue;\n        }\n\n        if (c < 0x80) {\n            out = out + hexTable[c];\n            continue;\n        }\n\n        if (c < 0x800) {\n            out = out + (hexTable[0xC0 | (c >> 6)] + hexTable[0x80 | (c & 0x3F)]);\n            continue;\n        }\n\n        if (c < 0xD800 || c >= 0xE000) {\n            out = out + (hexTable[0xE0 | (c >> 12)] + hexTable[0x80 | ((c >> 6) & 0x3F)] + hexTable[0x80 | (c & 0x3F)]);\n            continue;\n        }\n\n        i += 1;\n        c = 0x10000 + (((c & 0x3FF) << 10) | (string.charCodeAt(i) & 0x3FF));\n        out += hexTable[0xF0 | (c >> 18)]\n            + hexTable[0x80 | ((c >> 12) & 0x3F)]\n            + hexTable[0x80 | ((c >> 6) & 0x3F)]\n            + hexTable[0x80 | (c & 0x3F)];\n    }\n\n    return out;\n};\n\nvar compact = function compact(value) {\n    var queue = [{ obj: { o: value }, prop: 'o' }];\n    var refs = [];\n\n    for (var i = 0; i < queue.length; ++i) {\n        var item = queue[i];\n        var obj = item.obj[item.prop];\n\n        var keys = Object.keys(obj);\n        for (var j = 0; j < keys.length; ++j) {\n            var key = keys[j];\n            var val = obj[key];\n            if (typeof val === 'object' && val !== null && refs.indexOf(val) === -1) {\n                queue.push({ obj: obj, prop: key });\n                refs.push(val);\n            }\n        }\n    }\n\n    compactQueue(queue);\n\n    return value;\n};\n\nvar isRegExp = function isRegExp(obj) {\n    return Object.prototype.toString.call(obj) === '[object RegExp]';\n};\n\nvar isBuffer = function isBuffer(obj) {\n    if (!obj || typeof obj !== 'object') {\n        return false;\n    }\n\n    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));\n};\n\nvar combine = function combine(a, b) {\n    return [].concat(a, b);\n};\n\nmodule.exports = {\n    arrayToObject: arrayToObject,\n    assign: assign,\n    combine: combine,\n    compact: compact,\n    decode: decode,\n    encode: encode,\n    isBuffer: isBuffer,\n    isRegExp: isRegExp,\n    merge: merge\n};\n","\"use strict\";\n\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n\t// the only reliable means to get the global object is\n\t// `Function('return this')()`\n\t// However, this causes CSP violations in Chrome apps.\n\tif (typeof self !== 'undefined') { return self; }\n\tif (typeof window !== 'undefined') { return window; }\n\tif (typeof global !== 'undefined') { return global; }\n\tthrow new Error('unable to locate global object');\n}\n\nvar globalObject = getGlobal();\n\nmodule.exports = exports = globalObject.fetch;\n\n// Needed for TypeScript and Webpack.\nif (globalObject.fetch) {\n\texports.default = globalObject.fetch.bind(globalObject);\n}\n\nexports.Headers = globalObject.Headers;\nexports.Request = globalObject.Request;\nexports.Response = globalObject.Response;\n","import { fibWithLimit, resolveConfigValueSync } from '@d-fischer/shared-utils';\nimport { EventEmitter } from '@d-fischer/typed-event-emitter';\nexport class PersistentConnection extends EventEmitter {\n    constructor(_type, _target, _config = {}) {\n        var _a;\n        super();\n        this._type = _type;\n        this._target = _target;\n        this._config = _config;\n        this._retryLimit = Infinity;\n        this._initialRetryLimit = 3;\n        this._connecting = false;\n        this._connectionRetryCount = 0;\n        this.onReceive = this.registerEvent();\n        this.onConnect = this.registerEvent();\n        this.onDisconnect = this.registerEvent();\n        this.onEnd = this.registerEvent();\n        this._retryLimit = (_a = _config.retryLimit) !== null && _a !== void 0 ? _a : Infinity;\n        this._logger = _config.logger;\n    }\n    get isConnected() {\n        var _a, _b;\n        return (_b = (_a = this._currentConnection) === null || _a === void 0 ? void 0 : _a.isConnected) !== null && _b !== void 0 ? _b : false;\n    }\n    get isConnecting() {\n        var _a, _b;\n        return (_b = (_a = this._currentConnection) === null || _a === void 0 ? void 0 : _a.isConnecting) !== null && _b !== void 0 ? _b : this._connecting;\n    }\n    get hasSocket() {\n        var _a, _b;\n        return (_b = (_a = this._currentConnection) === null || _a === void 0 ? void 0 : _a.hasSocket) !== null && _b !== void 0 ? _b : false;\n    }\n    sendLine(line) {\n        var _a;\n        (_a = this._currentConnection) === null || _a === void 0 ? void 0 : _a.sendLine(line);\n    }\n    connect() {\n        if (this._currentConnection || this._connecting) {\n            throw new Error('Connection already present');\n        }\n        this._connecting = true;\n        this._connectionRetryCount = 0;\n        this._tryConnect(true);\n    }\n    disconnect() {\n        var _a;\n        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace(`PersistentConnection disconnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`);\n        this._connecting = false;\n        if (this._currentConnection) {\n            const lastConnection = this._currentConnection;\n            this._currentConnection = undefined;\n            lastConnection.disconnect();\n        }\n    }\n    assumeExternalDisconnect() {\n        var _a, _b;\n        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace('PersistentConnection assumeExternalDisconnect');\n        (_b = this._currentConnection) === null || _b === void 0 ? void 0 : _b.assumeExternalDisconnect();\n    }\n    reconnect() {\n        this._reconnect(true);\n    }\n    acknowledgeSuccessfulReconnect() {\n        if (this._previousConnection) {\n            this._previousConnection.disconnect();\n            this._previousConnection = undefined;\n        }\n    }\n    _startTryingToConnect(userGenerated = false) {\n        this._connecting = true;\n        this._connectionRetryCount = 0;\n        this._tryConnect(userGenerated);\n    }\n    _tryConnect(userGenerated = false) {\n        var _a, _b;\n        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace(`PersistentConnection tryConnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`);\n        const retryLimit = userGenerated ? this._initialRetryLimit : this._retryLimit;\n        (_b = this._retryTimerGenerator) !== null && _b !== void 0 ? _b : (this._retryTimerGenerator = fibWithLimit(120));\n        const newConnection = (this._currentConnection = new this._type(resolveConfigValueSync(this._target), this._config));\n        newConnection.onReceive(line => this.emit(this.onReceive, line));\n        newConnection.onConnect(() => {\n            this.emit(this.onConnect);\n            this._connecting = false;\n            this._retryTimerGenerator = undefined;\n        });\n        newConnection.onDisconnect((manually, reason) => {\n            var _a, _b, _c;\n            this.emit(this.onDisconnect, manually, reason);\n            if (manually) {\n                this.emit(this.onEnd, true);\n                this._connecting = false;\n                this._retryTimerGenerator = undefined;\n                newConnection.disconnect();\n                if (this._currentConnection === newConnection) {\n                    this._currentConnection = undefined;\n                }\n                if (this._previousConnection === newConnection) {\n                    this._previousConnection = undefined;\n                }\n            }\n            else if (this._connecting) {\n                (_a = this._logger) === null || _a === void 0 ? void 0 : _a.debug(`Connection error caught: ${(_b = reason === null || reason === void 0 ? void 0 : reason.message) !== null && _b !== void 0 ? _b : 'unknown error'}`);\n                if (this._connectionRetryCount >= retryLimit) {\n                    return;\n                }\n                this._connectionRetryCount++;\n                const secs = this._retryTimerGenerator.next().value;\n                if (secs !== 0) {\n                    (_c = this._logger) === null || _c === void 0 ? void 0 : _c.info(`Retrying in ${secs} seconds`);\n                }\n                setTimeout(() => {\n                    var _a;\n                    if (!this._connecting) {\n                        return;\n                    }\n                    (_a = this._logger) === null || _a === void 0 ? void 0 : _a.info(userGenerated ? 'Retrying connection' : 'Trying to reconnect');\n                    this._tryConnect();\n                }, secs * 1000);\n            }\n            else {\n                this._reconnect();\n            }\n        });\n        newConnection.connect();\n    }\n    _reconnect(userGenerated = false) {\n        if (userGenerated && this._config.overlapManualReconnect) {\n            this._previousConnection = this._currentConnection;\n            this._currentConnection = undefined;\n        }\n        else {\n            this.disconnect();\n        }\n        this._startTryingToConnect(userGenerated);\n    }\n}\n","// https://github.com/maxogden/websocket-stream/blob/48dc3ddf943e5ada668c31ccd94e9186f02fafbd/ws-fallback.js\n\nvar ws = null\n\nif (typeof WebSocket !== 'undefined') {\n  ws = WebSocket\n} else if (typeof MozWebSocket !== 'undefined') {\n  ws = MozWebSocket\n} else if (typeof global !== 'undefined') {\n  ws = global.WebSocket || global.MozWebSocket\n} else if (typeof window !== 'undefined') {\n  ws = window.WebSocket || window.MozWebSocket\n} else if (typeof self !== 'undefined') {\n  ws = self.WebSocket || self.MozWebSocket\n}\n\nexport {\n    ws as WebSocket\n}\n","import { EventEmitter } from '@d-fischer/typed-event-emitter';\nexport class AbstractConnection extends EventEmitter {\n    constructor({ lineBased, logger, additionalOptions } = {}) {\n        super();\n        this._currentLine = '';\n        this._connecting = false;\n        this._connected = false;\n        this.onReceive = this.registerEvent();\n        this.onConnect = this.registerEvent();\n        this.onDisconnect = this.registerEvent();\n        this.onEnd = this.registerEvent();\n        this._lineBased = lineBased !== null && lineBased !== void 0 ? lineBased : false;\n        this._logger = logger;\n        this._additionalOptions = additionalOptions;\n    }\n    get isConnecting() {\n        return this._connecting;\n    }\n    get isConnected() {\n        return this._connected;\n    }\n    sendLine(line) {\n        if (this._connected) {\n            line = line.replace(/[\\0\\r\\n]/g, '');\n            this.sendRaw(`${line}\\r\\n`);\n        }\n    }\n    assumeExternalDisconnect() {\n        var _a;\n        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace('AbstractConnection assumeExternalDisconnect');\n        this._connected = false;\n        this._connecting = false;\n        this.clearSocket();\n        this.emit(this.onDisconnect, false);\n    }\n    receiveRaw(data) {\n        var _a, _b;\n        if (!this._lineBased) {\n            this.emit(this.onReceive, data);\n            return;\n        }\n        const receivedLines = data.split('\\r\\n');\n        this._currentLine += (_a = receivedLines.shift()) !== null && _a !== void 0 ? _a : '';\n        if (receivedLines.length) {\n            this.emit(this.onReceive, this._currentLine);\n            this._currentLine = (_b = receivedLines.pop()) !== null && _b !== void 0 ? _b : '';\n            for (const line of receivedLines) {\n                this.emit(this.onReceive, line);\n            }\n        }\n    }\n}\n","import { WebSocket } from '@d-fischer/isomorphic-ws';\nimport { AbstractConnection } from \"./AbstractConnection.mjs\";\nexport class WebSocketConnection extends AbstractConnection {\n    constructor(target, options) {\n        super(options);\n        this._socket = null;\n        this._closingOnDemand = false;\n        if (target.hostName && target.port) {\n            this._url = `ws${target.secure ? 's' : ''}://${target.hostName}:${target.port}`;\n        }\n        else if (target.url) {\n            this._url = target.url;\n        }\n        else {\n            throw new Error('WebSocketConnection requires either hostName & port or url to be set');\n        }\n    }\n    get hasSocket() {\n        return !!this._socket;\n    }\n    sendRaw(line) {\n        var _a;\n        (_a = this._socket) === null || _a === void 0 ? void 0 : _a.send(line);\n    }\n    connect() {\n        var _a, _b;\n        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace('WebSocketConnection connect');\n        this._connecting = true;\n        this._socket = new WebSocket(this._url, (_b = this._additionalOptions) === null || _b === void 0 ? void 0 : _b.wsOptions);\n        this._socket.onopen = () => {\n            var _a;\n            (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace('WebSocketConnection onOpen');\n            this._connected = true;\n            this._connecting = false;\n            this.emit(this.onConnect);\n        };\n        this._socket.onmessage = ({ data }) => {\n            this.receiveRaw(data.toString());\n        };\n        // The following empty error callback needs to exist so connection errors are passed down to `onclose` down below - otherwise the process just crashes instead\n        this._socket.onerror = e => {\n            var _a;\n            (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace(`WebSocketConnection onError message:${e.message}`);\n        };\n        this._socket.onclose = e => {\n            var _a;\n            const wasConnected = this._connected;\n            const wasConnecting = this._connecting;\n            (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace(`WebSocketConnection onClose wasConnected:${wasConnected.toString()} wasConnecting:${wasConnecting.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${e.wasClean.toString()}`);\n            this._connected = false;\n            this._connecting = false;\n            if (e.wasClean || this._closingOnDemand) {\n                this._closingOnDemand = false;\n                this.emit(this.onDisconnect, true);\n                this.emit(this.onEnd, true);\n            }\n            else {\n                const err = new Error(`[${e.code}] ${e.reason}`);\n                this.emit(this.onDisconnect, false, err);\n                this.emit(this.onEnd, false, err);\n            }\n            this.clearSocket();\n        };\n    }\n    disconnect() {\n        var _a, _b;\n        (_a = this._logger) === null || _a === void 0 ? void 0 : _a.trace('WebSocketConnection disconnect');\n        this._closingOnDemand = true;\n        (_b = this._socket) === null || _b === void 0 ? void 0 : _b.close();\n    }\n    clearSocket() {\n        if (this._socket) {\n            this._socket.onopen = null;\n            this._socket.onmessage = null;\n            this._socket.onerror = null;\n            this._socket.onclose = null;\n            this._socket = null;\n        }\n    }\n}\n","var _a;\nimport { isNode } from '@d-fischer/detect-node';\nexport var LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"CRITICAL\"] = 0] = \"CRITICAL\";\n    LogLevel[LogLevel[\"ERROR\"] = 1] = \"ERROR\";\n    LogLevel[LogLevel[\"WARNING\"] = 2] = \"WARNING\";\n    LogLevel[LogLevel[\"INFO\"] = 3] = \"INFO\";\n    LogLevel[LogLevel[\"DEBUG\"] = 4] = \"DEBUG\";\n    LogLevel[LogLevel[\"TRACE\"] = 7] = \"TRACE\";\n})(LogLevel || (LogLevel = {}));\nexport function resolveLogLevel(level) {\n    if (typeof level === 'number') {\n        if (Object.prototype.hasOwnProperty.call(LogLevel, level)) {\n            return level;\n        }\n        var eligibleLevels = Object.keys(LogLevel)\n            .map(function (k) { return parseInt(k, 10); })\n            .filter(function (k) { return !isNaN(k) && k < level; });\n        if (!eligibleLevels.length) {\n            return LogLevel.WARNING;\n        }\n        return Math.max.apply(Math, eligibleLevels);\n    }\n    // TODO drop the replace for next major, it keeps the old deprecated debug1/2/3 levels running\n    var strLevel = level.replace(/\\d+$/, '').toUpperCase();\n    if (!Object.prototype.hasOwnProperty.call(LogLevel, strLevel)) {\n        throw new Error(\"Unknown log level string: \".concat(level));\n    }\n    return LogLevel[strLevel];\n}\n// Node 8+ defines console.debug as noop, and earlier versions don't define it at all\nvar debugFunction = isNode ? console.log.bind(console) : console.debug.bind(console);\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport var LogLevelToConsoleFunction = (_a = {},\n    _a[LogLevel.CRITICAL] = console.error.bind(console),\n    _a[LogLevel.ERROR] = console.error.bind(console),\n    _a[LogLevel.WARNING] = console.warn.bind(console),\n    _a[LogLevel.INFO] = console.info.bind(console),\n    _a[LogLevel.DEBUG] = debugFunction.bind(console),\n    _a[LogLevel.TRACE] = console.trace.bind(console),\n    _a);\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","var _a, _b;\nimport { resolveLogLevel } from \"./LogLevel.mjs\";\nvar data = typeof process === 'undefined'\n    ? []\n    : (_b = (_a = process.env.LOGGING) === null || _a === void 0 ? void 0 : _a.split(';').map(function (part) {\n        var _a = part.split('=', 2), namespace = _a[0], strLevel = _a[1];\n        if (strLevel) {\n            return [namespace === 'default' ? undefined : namespace.split(':'), resolveLogLevel(strLevel)];\n        }\n        return null;\n    }).filter(function (v) { return !!v; }).sort(function (_a, _b) {\n        var _c, _d;\n        var a = _a[0];\n        var b = _b[0];\n        return ((_c = b === null || b === void 0 ? void 0 : b.length) !== null && _c !== void 0 ? _c : 0) - ((_d = a === null || a === void 0 ? void 0 : a.length) !== null && _d !== void 0 ? _d : 0);\n    })) !== null && _b !== void 0 ? _b : [];\nvar defaultIndex = data.findIndex(function (_a) {\n    var nsParts = _a[0];\n    return !nsParts;\n});\nvar defaultLevel = undefined;\nif (defaultIndex !== -1) {\n    defaultLevel = data[defaultIndex][1];\n    data.splice(defaultIndex);\n}\nfunction isPrefix(value, prefix) {\n    return prefix.length <= value.length && prefix.every(function (item, i) { return item === value[i]; });\n}\nexport function getMinLogLevelFromEnv(name) {\n    var nameSplit = name.split(':');\n    for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {\n        var _a = data_1[_i], nsParts = _a[0], level = _a[1];\n        if (isPrefix(nameSplit, nsParts)) {\n            return level;\n        }\n    }\n    return defaultLevel;\n}\n","import { mapOptional } from '@d-fischer/shared-utils';\nimport { isNode } from '@d-fischer/detect-node';\nimport { getMinLogLevelFromEnv } from \"./getMinLogLevelFromEnv.mjs\";\nimport { LogLevel, resolveLogLevel } from \"./LogLevel.mjs\";\nvar BaseLogger = /** @class */ (function () {\n    function BaseLogger(_a) {\n        var name = _a.name, minLevel = _a.minLevel, _b = _a.emoji, emoji = _b === void 0 ? false : _b, colors = _a.colors, _c = _a.timestamps, timestamps = _c === void 0 ? isNode : _c;\n        var _d, _e;\n        this._name = name;\n        this._minLevel =\n            (_e = (_d = mapOptional(minLevel, function (lv) { return resolveLogLevel(lv); })) !== null && _d !== void 0 ? _d : getMinLogLevelFromEnv(name)) !== null && _e !== void 0 ? _e : LogLevel.WARNING;\n        this._emoji = emoji;\n        this._colors = colors;\n        this._timestamps = timestamps;\n    }\n    // region convenience methods\n    BaseLogger.prototype.crit = function (message) {\n        this.log(LogLevel.CRITICAL, message);\n    };\n    BaseLogger.prototype.error = function (message) {\n        this.log(LogLevel.ERROR, message);\n    };\n    BaseLogger.prototype.warn = function (message) {\n        this.log(LogLevel.WARNING, message);\n    };\n    BaseLogger.prototype.info = function (message) {\n        this.log(LogLevel.INFO, message);\n    };\n    BaseLogger.prototype.debug = function (message) {\n        this.log(LogLevel.DEBUG, message);\n    };\n    BaseLogger.prototype.trace = function (message) {\n        this.log(LogLevel.TRACE, message);\n    };\n    return BaseLogger;\n}());\nexport { BaseLogger };\n","var _a, _b, _c;\nimport { __extends } from \"tslib\";\nimport { LogLevel, LogLevelToConsoleFunction } from \"./LogLevel.mjs\";\nimport { BaseLogger } from \"./BaseLogger.mjs\";\nexport var LogLevelToEmoji = (_a = {},\n    _a[LogLevel.CRITICAL] = \"\\uD83D\\uDED1\",\n    _a[LogLevel.ERROR] = \"\\u274C\",\n    // these following two need extra spaces at the end because somehow they consume less space in a terminal than they should...\n    _a[LogLevel.WARNING] = \"\\u26A0\\uFE0F \",\n    _a[LogLevel.INFO] = \"\\u2139\\uFE0F \",\n    _a[LogLevel.DEBUG] = \"\\uD83D\\uDC1E\",\n    _a[LogLevel.TRACE] = \"\\uD83D\\uDC3E\",\n    _a);\nvar colors = {\n    black: 30,\n    red: 31,\n    green: 32,\n    yellow: 33,\n    blue: 34,\n    magenta: 35,\n    cyan: 36,\n    white: 37,\n    blackBright: 90,\n    redBright: 91,\n    greenBright: 92,\n    yellowBright: 93,\n    blueBright: 94,\n    magentaBright: 95,\n    cyanBright: 96,\n    whiteBright: 97\n};\nvar bgColors = {\n    bgBlack: 40,\n    bgRed: 41,\n    bgGreen: 42,\n    bgYellow: 43,\n    bgBlue: 44,\n    bgMagenta: 45,\n    bgCyan: 46,\n    bgWhite: 47,\n    bgBlackBright: 100,\n    bgRedBright: 101,\n    bgGreenBright: 102,\n    bgYellowBright: 103,\n    bgBlueBright: 104,\n    bgMagentaBright: 105,\n    bgCyanBright: 106,\n    bgWhiteBright: 107\n};\nfunction createGenericWrapper(color, ending, inner) {\n    return function (str) { return \"\\u001B[\".concat(color, \"m\").concat(inner ? inner(str) : str, \"\\u001B[\").concat(ending, \"m\"); };\n}\nfunction createColorWrapper(color) {\n    return createGenericWrapper(colors[color], 39);\n}\nfunction createBgWrapper(color, fgWrapper) {\n    return createGenericWrapper(bgColors[color], 49, fgWrapper);\n}\nexport var LogLevelToColor = (_b = {},\n    _b[LogLevel.CRITICAL] = createColorWrapper('red'),\n    _b[LogLevel.ERROR] = createColorWrapper('redBright'),\n    _b[LogLevel.WARNING] = createColorWrapper('yellow'),\n    _b[LogLevel.INFO] = createColorWrapper('blue'),\n    _b[LogLevel.DEBUG] = createColorWrapper('magenta'),\n    _b[LogLevel.TRACE] = createGenericWrapper(0, 0),\n    _b);\nexport var LogLevelToBackgroundColor = (_c = {},\n    _c[LogLevel.CRITICAL] = createBgWrapper('bgRed', createColorWrapper('white')),\n    _c[LogLevel.ERROR] = createBgWrapper('bgRedBright', createColorWrapper('white')),\n    _c[LogLevel.WARNING] = createBgWrapper('bgYellow', createColorWrapper('black')),\n    _c[LogLevel.INFO] = createBgWrapper('bgBlue', createColorWrapper('white')),\n    _c[LogLevel.DEBUG] = createBgWrapper('bgMagenta', createColorWrapper('black')),\n    _c[LogLevel.TRACE] = createGenericWrapper(7, 27),\n    _c);\nvar NodeLogger = /** @class */ (function (_super) {\n    __extends(NodeLogger, _super);\n    function NodeLogger() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NodeLogger.prototype.log = function (level, message) {\n        var _a, _b, _c;\n        if (level > this._minLevel) {\n            return;\n        }\n        var logFn = LogLevelToConsoleFunction[level];\n        var builtMessage = '';\n        if (this._timestamps) {\n            builtMessage += \"[\".concat(new Date().toISOString(), \"] \");\n        }\n        if (this._emoji) {\n            var emoji = LogLevelToEmoji[level];\n            builtMessage += \"\".concat(emoji, \" \");\n        }\n        var useColors = (_c = (_a = this._colors) !== null && _a !== void 0 ? _a : (_b = process.stdout) === null || _b === void 0 ? void 0 : _b.isTTY) !== null && _c !== void 0 ? _c : true;\n        if (useColors) {\n            builtMessage += \"\".concat(LogLevelToBackgroundColor[level](this._name), \" \").concat(LogLevelToBackgroundColor[level](LogLevel[level]), \" \").concat(LogLevelToColor[level](message));\n        }\n        else {\n            builtMessage += \"[\".concat(this._name, \":\").concat(LogLevel[level].toLowerCase(), \"] \").concat(message);\n        }\n        logFn(builtMessage);\n    };\n    return NodeLogger;\n}(BaseLogger));\nexport { NodeLogger };\n","import { __extends } from \"tslib\";\nimport { LogLevelToConsoleFunction } from \"./LogLevel.mjs\";\nimport { BaseLogger } from \"./BaseLogger.mjs\";\nvar BrowserLogger = /** @class */ (function (_super) {\n    __extends(BrowserLogger, _super);\n    function BrowserLogger() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BrowserLogger.prototype.log = function (level, message) {\n        if (level > this._minLevel) {\n            return;\n        }\n        var logFn = LogLevelToConsoleFunction[level];\n        var formattedMessage = \"[\".concat(this._name, \"] \").concat(message);\n        if (this._timestamps) {\n            formattedMessage = \"[\".concat(new Date().toISOString(), \"] \").concat(message);\n        }\n        logFn(formattedMessage);\n    };\n    return BrowserLogger;\n}(BaseLogger));\nexport { BrowserLogger };\n","import { mapOptional } from '@d-fischer/shared-utils';\nimport { getMinLogLevelFromEnv } from \"./getMinLogLevelFromEnv.mjs\";\nimport { LogLevel, resolveLogLevel } from \"./LogLevel.mjs\";\nvar CustomLoggerWrapper = /** @class */ (function () {\n    function CustomLoggerWrapper(_a) {\n        var name = _a.name, minLevel = _a.minLevel, custom = _a.custom;\n        var _b;\n        this._minLevel = (_b = mapOptional(minLevel, function (lv) { return resolveLogLevel(lv); })) !== null && _b !== void 0 ? _b : getMinLogLevelFromEnv(name);\n        this._override = typeof custom === 'function' ? { log: custom } : custom;\n    }\n    CustomLoggerWrapper.prototype.log = function (level, message) {\n        if (this._shouldLog(level)) {\n            this._override.log(level, message);\n        }\n    };\n    CustomLoggerWrapper.prototype.crit = function (message) {\n        if (!this._override.crit) {\n            this.log(LogLevel.CRITICAL, message);\n        }\n        else if (this._shouldLog(LogLevel.CRITICAL)) {\n            this._override.crit(message);\n        }\n    };\n    CustomLoggerWrapper.prototype.error = function (message) {\n        if (!this._override.error) {\n            this.log(LogLevel.ERROR, message);\n        }\n        else if (this._shouldLog(LogLevel.ERROR)) {\n            this._override.error(message);\n        }\n    };\n    CustomLoggerWrapper.prototype.warn = function (message) {\n        if (!this._override.warn) {\n            this.log(LogLevel.WARNING, message);\n        }\n        else if (this._shouldLog(LogLevel.WARNING)) {\n            this._override.warn(message);\n        }\n    };\n    CustomLoggerWrapper.prototype.info = function (message) {\n        if (!this._override.info) {\n            this.log(LogLevel.INFO, message);\n        }\n        else if (this._shouldLog(LogLevel.INFO)) {\n            this._override.info(message);\n        }\n    };\n    CustomLoggerWrapper.prototype.debug = function (message) {\n        if (!this._override.debug) {\n            this.log(LogLevel.DEBUG, message);\n        }\n        else if (this._shouldLog(LogLevel.DEBUG)) {\n            this._override.debug(message);\n        }\n    };\n    CustomLoggerWrapper.prototype.trace = function (message) {\n        if (!this._override.trace) {\n            this.log(LogLevel.TRACE, message);\n        }\n        else if (this._shouldLog(LogLevel.TRACE)) {\n            this._override.trace(message);\n        }\n    };\n    CustomLoggerWrapper.prototype._shouldLog = function (level) {\n        return this._minLevel === undefined || this._minLevel >= level;\n    };\n    return CustomLoggerWrapper;\n}());\nexport { CustomLoggerWrapper };\n","import { isNode } from '@d-fischer/detect-node';\nimport { BrowserLogger } from \"./BrowserLogger.mjs\";\nimport { CustomLoggerWrapper } from \"./CustomLoggerWrapper.mjs\";\nimport { NodeLogger } from \"./NodeLogger.mjs\";\nexport function createLogger(options) {\n    if (options.custom) {\n        return new CustomLoggerWrapper(options);\n    }\n    if (isNode) {\n        return new NodeLogger(options);\n    }\n    return new BrowserLogger(options);\n}\n","/* eslint-disable @typescript-eslint/naming-convention */\nexport function Enumerable(enumerable) {\n    if (enumerable === void 0) { enumerable = true; }\n    return function (target, key) {\n        // first property defined in prototype, that's why we use getters/setters\n        // (otherwise assignment in object will override property in prototype)\n        Object.defineProperty(target, key, {\n            get: function () {\n                return;\n            },\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            set: function (val) {\n                // here we have a reference to the instance and can set property directly to it\n                Object.defineProperty(this, key, {\n                    value: val,\n                    writable: true,\n                    enumerable: enumerable\n                });\n            },\n            enumerable: enumerable\n        });\n    };\n}\n","import { __awaiter, __generator } from \"tslib\";\nexport function resolveConfigValue(value) {\n    return __awaiter(this, void 0, Promise, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(typeof value === 'function')) return [3 /*break*/, 2];\n                    return [4 /*yield*/, value()];\n                case 1: \n                // eslint-disable-next-line @typescript-eslint/ban-types\n                return [2 /*return*/, _a.sent()];\n                case 2: return [2 /*return*/, value];\n            }\n        });\n    });\n}\nexport function resolveConfigValueSync(value) {\n    if (typeof value === 'function') {\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        return value();\n    }\n    return value;\n}\n","import { __generator, __read } from \"tslib\";\nexport function fibWithLimit(limit) {\n    var current, next;\n    var _a;\n    return __generator(this, function (_b) {\n        switch (_b.label) {\n            case 0:\n                current = 0;\n                next = 1;\n                _b.label = 1;\n            case 1:\n                if (!(current < limit)) return [3 /*break*/, 3];\n                return [4 /*yield*/, current];\n            case 2:\n                _b.sent();\n                _a = __read([next, current + next], 2), current = _a[0], next = _a[1];\n                return [3 /*break*/, 1];\n            case 3:\n                if (!true) return [3 /*break*/, 5];\n                return [4 /*yield*/, limit];\n            case 4:\n                _b.sent();\n                return [3 /*break*/, 3];\n            case 5: return [2 /*return*/];\n        }\n    });\n}\n","export function isNullish(value) {\n    return value == null;\n}\nexport function mapNullable(value, cb) {\n    return isNullish(value) ? null : cb(value);\n}\nexport function mapOptional(value, cb) {\n    return isNullish(value) ? undefined : cb(value);\n}\n","export function promiseWithResolvers() {\n    // eslint-disable-next-line @typescript-eslint/init-declarations\n    var resolve;\n    // eslint-disable-next-line @typescript-eslint/init-declarations\n    var reject;\n    var promise = new Promise(function (_resolve, _reject) {\n        resolve = _resolve;\n        reject = _reject;\n    });\n    return { promise: promise, resolve: resolve, reject: reject };\n}\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","export class Listener {\n    /** @private */\n    constructor(owner, event, listener, \n    /** @private */ _internal = false) {\n        this.owner = owner;\n        this.event = event;\n        this.listener = listener;\n        this._internal = _internal;\n    }\n    unbind() {\n        this.owner.removeListener(this);\n    }\n}\n","import { Listener } from \"./Listener.mjs\";\nexport class EventEmitter {\n    constructor() {\n        this._eventListeners = new Map();\n        this._internalEventListeners = new Map();\n    }\n    on(event, listener) {\n        return this._addListener(false, event, listener);\n    }\n    addListener(event, listener) {\n        return this._addListener(false, event, listener);\n    }\n    removeListener(idOrEvent, listener) {\n        this._removeListener(false, idOrEvent, listener);\n    }\n    registerEvent() {\n        const eventBinder = (handler) => this.addListener(eventBinder, handler);\n        return eventBinder;\n    }\n    emit(event, ...args) {\n        if (this._eventListeners.has(event)) {\n            for (const listener of this._eventListeners.get(event)) {\n                listener(...args);\n            }\n        }\n        if (this._internalEventListeners.has(event)) {\n            for (const listener of this._internalEventListeners.get(event)) {\n                listener(...args);\n            }\n        }\n    }\n    registerInternalEvent() {\n        const eventBinder = (handler) => this.addInternalListener(eventBinder, handler);\n        return eventBinder;\n    }\n    addInternalListener(event, listener) {\n        return this._addListener(true, event, listener);\n    }\n    removeInternalListener(idOrEvent, listener) {\n        this._removeListener(true, idOrEvent, listener);\n    }\n    _addListener(internal, event, listener) {\n        const listenerMap = internal ? this._eventListeners : this._internalEventListeners;\n        if (listenerMap.has(event)) {\n            listenerMap.get(event).push(listener);\n        }\n        else {\n            listenerMap.set(event, [listener]);\n        }\n        return new Listener(this, event, listener, internal);\n    }\n    _removeListener(internal, idOrEvent, listener) {\n        const listenerMap = internal ? this._eventListeners : this._internalEventListeners;\n        if (!idOrEvent) {\n            listenerMap.clear();\n        }\n        else if (typeof idOrEvent === 'object') {\n            const id = idOrEvent;\n            this._removeListener(id._internal, id.event, id.listener);\n        }\n        else {\n            const event = idOrEvent;\n            if (listenerMap.has(event)) {\n                if (listener) {\n                    const listeners = listenerMap.get(event);\n                    let idx = 0;\n                    while ((idx = listeners.indexOf(listener)) !== -1) {\n                        listeners.splice(idx, 1);\n                    }\n                }\n                else {\n                    listenerMap.delete(event);\n                }\n            }\n        }\n    }\n}\n","import { CustomError } from '@twurple/common';\n/**\n * Thrown whenever an invalid token is supplied.\n */\nexport class InvalidTokenError extends CustomError {\n    /** @private */\n    constructor(options) {\n        super('Invalid token supplied', options);\n    }\n}\n","import nodeFetch from 'node-fetch'\nvar realFetch = nodeFetch.default || nodeFetch\n\nvar fetch = function (url, options) {\n  // Support schemaless URIs on the server for parity with the browser.\n  // Ex: //github.com/ -> https://github.com/\n  if (/^\\/\\//.test(url)) {\n    url = 'https:' + url\n  }\n  return realFetch.call(this, url, options)\n}\n\nexport default fetch\n\nexport { fetch }\nexport const Headers = nodeFetch.Headers\nexport const Request = nodeFetch.Request\nexport const Response = nodeFetch.Response\n","import { CustomError } from '@twurple/common';\n/**\n * Thrown whenever a HTTP error occurs. Some HTTP errors are handled in the library when they're expected.\n */\nexport class HttpStatusCodeError extends CustomError {\n    /** @private */\n    constructor(_statusCode, statusText, _url, _method, _body, isJson) {\n        super(`Encountered HTTP status code ${_statusCode}: ${statusText}\\n\\nURL: ${_url}\\nMethod: ${_method}\\nBody:\\n${!isJson && _body.length > 150 ? `${_body.slice(0, 147)}...` : _body}`);\n        this._statusCode = _statusCode;\n        this._url = _url;\n        this._method = _method;\n        this._body = _body;\n    }\n    /**\n     * The HTTP status code of the error.\n     */\n    get statusCode() {\n        return this._statusCode;\n    }\n    /**\n     * The URL that was requested.\n     */\n    get url() {\n        return this._url;\n    }\n    /**\n     * The HTTP method that was used for the request.\n     */\n    get method() {\n        return this._method;\n    }\n    /**\n     * The body that was used for the request, as a string.\n     */\n    get body() {\n        return this._body;\n    }\n}\n","import { stringify } from '@d-fischer/qs';\nimport { HttpStatusCodeError } from \"../errors/HttpStatusCodeError.mjs\";\n/** @private */\nexport async function handleTwitchApiResponseError(response, options) {\n    var _a;\n    if (!response.ok) {\n        const isJson = response.headers.get('Content-Type') === 'application/json';\n        const text = isJson ? JSON.stringify(await response.json(), null, 2) : await response.text();\n        const params = stringify(options.query, { arrayFormat: 'repeat', addQueryPrefix: true });\n        const fullUrl = `${options.url}${params}`;\n        throw new HttpStatusCodeError(response.status, response.statusText, fullUrl, (_a = options.method) !== null && _a !== void 0 ? _a : 'GET', text, isJson);\n    }\n}\n/** @private */\nexport async function transformTwitchApiResponse(response) {\n    if (response.status === 204) {\n        return undefined; // oof\n    }\n    const text = await response.text();\n    if (!text) {\n        return undefined; // mega oof - Twitch doesn't return a response when it should\n    }\n    return JSON.parse(text);\n}\n","/** @internal */\nexport function getTwitchApiUrl(url, type) {\n    switch (type) {\n        case 'helix':\n            return `https://api.twitch.tv/helix/${url.replace(/^\\//, '')}`;\n        case 'auth':\n            return `https://id.twitch.tv/oauth2/${url.replace(/^\\//, '')}`;\n        case 'custom':\n            return url;\n        default:\n            return url; // wat\n    }\n}\n","import fetch, { Headers } from '@d-fischer/cross-fetch';\nimport { stringify } from '@d-fischer/qs';\nimport { handleTwitchApiResponseError, transformTwitchApiResponse } from \"./helpers/transform.mjs\";\nimport { getTwitchApiUrl } from \"./helpers/url.mjs\";\n/**\n * Makes a call to the Twitch API using the given credentials, returning the raw Response object.\n *\n * @param options The configuration of the call.\n * @param clientId The client ID of your application.\n * @param accessToken The access token to call the API with.\n *\n * You need to obtain one using one of the [Twitch OAuth flows](https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/).\n * @param authorizationType The type of Authorization header to send.\n *\n * Defaults to \"Bearer\" for Helix and \"OAuth\" for everything else.\n * @param fetchOptions Additional options to be passed to the `fetch` function.\n */\nexport async function callTwitchApiRaw(options, clientId, accessToken, authorizationType, fetchOptions = {}) {\n    var _a, _b;\n    const type = (_a = options.type) !== null && _a !== void 0 ? _a : 'helix';\n    const url = getTwitchApiUrl(options.url, type);\n    const params = stringify(options.query, { arrayFormat: 'repeat', addQueryPrefix: true });\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    const headers = new Headers({ Accept: 'application/json' });\n    let body = undefined;\n    if (options.jsonBody) {\n        body = JSON.stringify(options.jsonBody);\n        headers.append('Content-Type', 'application/json');\n    }\n    if (clientId && type !== 'auth') {\n        headers.append('Client-ID', clientId);\n    }\n    if (accessToken) {\n        headers.append('Authorization', `${type === 'helix' ? authorizationType !== null && authorizationType !== void 0 ? authorizationType : 'Bearer' : 'OAuth'} ${accessToken}`);\n    }\n    const requestOptions = {\n        ...fetchOptions,\n        method: (_b = options.method) !== null && _b !== void 0 ? _b : 'GET',\n        headers,\n        body\n    };\n    return await fetch(`${url}${params}`, requestOptions);\n}\n/**\n * Makes a call to the Twitch API using given credentials.\n *\n * @param options The configuration of the call.\n * @param clientId The client ID of your application.\n * @param accessToken The access token to call the API with.\n *\n * You need to obtain one using one of the [Twitch OAuth flows](https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/).\n * @param authorizationType The type of Authorization header to send.\n *\n * Defaults to \"Bearer\" for Helix and \"OAuth\" for everything else.\n * @param fetchOptions Additional options to be passed to the `fetch` function.\n */\nexport async function callTwitchApi(options, clientId, accessToken, authorizationType, fetchOptions = {}) {\n    const response = await callTwitchApiRaw(options, clientId, accessToken, authorizationType, fetchOptions);\n    await handleTwitchApiResponseError(response, options);\n    return await transformTwitchApiResponse(response);\n}\n","/** @internal */\nexport function createExchangeCodeQuery(clientId, clientSecret, code, redirectUri) {\n    return {\n        grant_type: 'authorization_code',\n        client_id: clientId,\n        client_secret: clientSecret,\n        code,\n        redirect_uri: redirectUri\n    };\n}\n/** @internal */\nexport function createGetAppTokenQuery(clientId, clientSecret) {\n    return {\n        grant_type: 'client_credentials',\n        client_id: clientId,\n        client_secret: clientSecret\n    };\n}\n/** @internal */\nexport function createRefreshTokenQuery(clientId, clientSecret, refreshToken) {\n    return {\n        grant_type: 'refresh_token',\n        client_id: clientId,\n        client_secret: clientSecret,\n        refresh_token: refreshToken\n    };\n}\n/** @internal */\nexport function createRevokeTokenQuery(clientId, accessToken) {\n    return {\n        client_id: clientId,\n        token: accessToken\n    };\n}\n","import { klona } from 'klona';\n/** @private */\nexport const rawDataSymbol = Symbol('twurpleRawData');\n/**\n * Gets the raw data of a data object.\n *\n * @param obj The data object to get the raw data of.\n */\nexport function getRawData(obj) {\n    return klona(obj[rawDataSymbol]);\n}\n/** @private */\nexport class DataObject {\n    /** @private */\n    constructor(data) {\n        this[rawDataSymbol] = data;\n    }\n}\n","import { __decorate } from \"tslib\";\nimport { mapNullable } from '@d-fischer/shared-utils';\nimport { DataObject, rawDataSymbol, rtfm } from '@twurple/common';\n/**\n * Information about an access token.\n */\nlet TokenInfo = class TokenInfo extends DataObject {\n    /** @internal */\n    constructor(data) {\n        super(data);\n        this._obtainmentDate = new Date();\n    }\n    /**\n     * The client ID.\n     */\n    get clientId() {\n        return this[rawDataSymbol].client_id;\n    }\n    /**\n     * The ID of the authenticated user.\n     */\n    get userId() {\n        var _a;\n        return (_a = this[rawDataSymbol].user_id) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The name of the authenticated user.\n     */\n    get userName() {\n        var _a;\n        return (_a = this[rawDataSymbol].login) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The scopes for which the token is valid.\n     */\n    get scopes() {\n        return this[rawDataSymbol].scopes;\n    }\n    /**\n     * The time when the token will expire.\n     *\n     * If this returns null, it means that the token never expires (happens with some old client IDs).\n     */\n    get expiryDate() {\n        return mapNullable(this[rawDataSymbol].expires_in, v => new Date(this._obtainmentDate.getTime() + v * 1000));\n    }\n};\nTokenInfo = __decorate([\n    rtfm('auth', 'TokenInfo', 'clientId')\n], TokenInfo);\nexport { TokenInfo };\n","import { callTwitchApi, HttpStatusCodeError } from '@twurple/api-call';\nimport { InvalidTokenError } from \"./errors/InvalidTokenError.mjs\";\nimport { InvalidTokenTypeError } from \"./errors/InvalidTokenTypeError.mjs\";\nimport { createExchangeCodeQuery, createGetAppTokenQuery, createRefreshTokenQuery, createRevokeTokenQuery } from \"./helpers.external.mjs\";\nimport { TokenInfo } from \"./TokenInfo.mjs\";\n/** @internal */\nfunction createAccessTokenFromData(data) {\n    var _a, _b;\n    return {\n        accessToken: data.access_token,\n        refreshToken: data.refresh_token || null,\n        scope: (_a = data.scope) !== null && _a !== void 0 ? _a : [],\n        expiresIn: (_b = data.expires_in) !== null && _b !== void 0 ? _b : null,\n        obtainmentTimestamp: Date.now()\n    };\n}\n/**\n * Gets an access token with your client credentials and an authorization code.\n *\n * @param clientId The client ID of your application.\n * @param clientSecret The client secret of your application.\n * @param code The authorization code.\n * @param redirectUri The redirect URI.\n *\n * This serves no real purpose here, but must still match one of the redirect URIs you configured in the Twitch Developer dashboard.\n */\nexport async function exchangeCode(clientId, clientSecret, code, redirectUri) {\n    return createAccessTokenFromData(await callTwitchApi({\n        type: 'auth',\n        url: 'token',\n        method: 'POST',\n        query: createExchangeCodeQuery(clientId, clientSecret, code, redirectUri)\n    }));\n}\n/**\n * Gets an app access token with your client credentials.\n *\n * @param clientId The client ID of your application.\n * @param clientSecret The client secret of your application.\n */\nexport async function getAppToken(clientId, clientSecret) {\n    return createAccessTokenFromData(await callTwitchApi({\n        type: 'auth',\n        url: 'token',\n        method: 'POST',\n        query: createGetAppTokenQuery(clientId, clientSecret)\n    }));\n}\n/**\n * Refreshes an expired access token with your client credentials and the refresh token that was given by the initial authentication.\n *\n * @param clientId The client ID of your application.\n * @param clientSecret The client secret of your application.\n * @param refreshToken The refresh token.\n */\nexport async function refreshUserToken(clientId, clientSecret, refreshToken) {\n    return createAccessTokenFromData(await callTwitchApi({\n        type: 'auth',\n        url: 'token',\n        method: 'POST',\n        query: createRefreshTokenQuery(clientId, clientSecret, refreshToken)\n    }));\n}\n/**\n * Revokes an access token.\n *\n * @param clientId The client ID of your application.\n * @param accessToken The access token.\n */\nexport async function revokeToken(clientId, accessToken) {\n    await callTwitchApi({\n        type: 'auth',\n        url: 'revoke',\n        method: 'POST',\n        query: createRevokeTokenQuery(clientId, accessToken)\n    });\n}\n/**\n * Gets information about an access token.\n *\n * @param accessToken The access token to get the information of.\n * @param clientId The client ID of your application.\n *\n * You need to obtain one using one of the [Twitch OAuth flows](https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/).\n */\nexport async function getTokenInfo(accessToken, clientId) {\n    try {\n        const data = await callTwitchApi({ type: 'auth', url: 'validate' }, clientId, accessToken);\n        return new TokenInfo(data);\n    }\n    catch (e) {\n        if (e instanceof HttpStatusCodeError && e.statusCode === 401) {\n            throw new InvalidTokenError({ cause: e });\n        }\n        throw e;\n    }\n}\n/** @private */\nexport async function getValidTokenFromProviderForUser(provider, userId, scopes, logger) {\n    let lastTokenError = null;\n    let foundUser = false;\n    try {\n        const accessToken = await provider.getAccessTokenForUser(userId, scopes);\n        if (accessToken) {\n            foundUser = true;\n            // check validity\n            const tokenInfo = await getTokenInfo(accessToken.accessToken);\n            return { accessToken, tokenInfo };\n        }\n    }\n    catch (e) {\n        if (e instanceof InvalidTokenError) {\n            lastTokenError = e;\n        }\n        else {\n            logger === null || logger === void 0 ? void 0 : logger.error(`Retrieving an access token failed: ${e.message}`);\n        }\n    }\n    if (foundUser) {\n        logger === null || logger === void 0 ? void 0 : logger.warn('No valid token available; trying to refresh');\n        if (provider.refreshAccessTokenForUser) {\n            try {\n                const newToken = await provider.refreshAccessTokenForUser(userId);\n                // check validity\n                const tokenInfo = await getTokenInfo(newToken.accessToken);\n                return { accessToken: newToken, tokenInfo };\n            }\n            catch (e) {\n                if (e instanceof InvalidTokenError) {\n                    lastTokenError = e;\n                }\n                else {\n                    logger === null || logger === void 0 ? void 0 : logger.error(`Refreshing the access token failed: ${e.message}`);\n                }\n            }\n        }\n    }\n    throw lastTokenError !== null && lastTokenError !== void 0 ? lastTokenError : new Error('Could not retrieve a valid token');\n}\n/** @private */\nexport async function getValidTokenFromProviderForIntent(provider, intent, scopes, logger) {\n    let lastTokenError = null;\n    let foundUser = false;\n    if (!provider.getAccessTokenForIntent) {\n        throw new InvalidTokenTypeError(`This call requires an AuthProvider that supports intents.\nPlease use an auth provider that does, such as \\`RefreshingAuthProvider\\`.`);\n    }\n    try {\n        const accessToken = await provider.getAccessTokenForIntent(intent, scopes);\n        if (accessToken) {\n            foundUser = true;\n            // check validity\n            const tokenInfo = await getTokenInfo(accessToken.accessToken);\n            return { accessToken, tokenInfo };\n        }\n    }\n    catch (e) {\n        if (e instanceof InvalidTokenError) {\n            lastTokenError = e;\n        }\n        else {\n            logger === null || logger === void 0 ? void 0 : logger.error(`Retrieving an access token failed: ${e.message}`);\n        }\n    }\n    if (foundUser) {\n        logger === null || logger === void 0 ? void 0 : logger.warn('No valid token available; trying to refresh');\n        if (provider.refreshAccessTokenForIntent) {\n            try {\n                const newToken = await provider.refreshAccessTokenForIntent(intent);\n                // check validity\n                const tokenInfo = await getTokenInfo(newToken.accessToken);\n                return { accessToken: newToken, tokenInfo };\n            }\n            catch (e) {\n                if (e instanceof InvalidTokenError) {\n                    lastTokenError = e;\n                }\n                else {\n                    logger === null || logger === void 0 ? void 0 : logger.error(`Refreshing the access token failed: ${e.message}`);\n                }\n            }\n        }\n    }\n    throw lastTokenError !== null && lastTokenError !== void 0 ? lastTokenError : new Error('Could not retrieve a valid token');\n}\nconst scopeEquivalencies = new Map([\n    ['channel_commercial', ['channel:edit:commercial']],\n    ['channel_editor', ['channel:manage:broadcast']],\n    ['channel_read', ['channel:read:stream_key']],\n    ['channel_subscriptions', ['channel:read:subscriptions']],\n    ['user_blocks_read', ['user:read:blocked_users']],\n    ['user_blocks_edit', ['user:manage:blocked_users']],\n    ['user_follows_edit', ['user:edit:follows']],\n    ['user_read', ['user:read:email']],\n    ['user_subscriptions', ['user:read:subscriptions']],\n    ['user:edit:broadcast', ['channel:manage:broadcast', 'channel:manage:extensions']]\n]);\n/**\n * Compares scopes for a non-upgradable {@link AuthProvider} instance.\n *\n * @param scopesToCompare The scopes to compare against.\n * @param requestedScopes The scopes you requested.\n */\nexport function compareScopes(scopesToCompare, requestedScopes) {\n    if (requestedScopes === null || requestedScopes === void 0 ? void 0 : requestedScopes.length) {\n        const scopes = new Set(scopesToCompare.flatMap(scope => { var _a; return [scope, ...((_a = scopeEquivalencies.get(scope)) !== null && _a !== void 0 ? _a : [])]; }));\n        if (requestedScopes.every(scope => !scopes.has(scope))) {\n            const scopesStr = requestedScopes.join(', ');\n            throw new Error(`This token does not have any of the requested scopes (${scopesStr}) and can not be upgraded.\nIf you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:\n\n\\thttps://twurple.js.org/reference/auth/interfaces/AuthProvider.html`);\n        }\n    }\n}\n/**\n * Compares scope sets for a non-upgradable {@link AuthProvider} instance.\n *\n * @param scopesToCompare The scopes to compare against.\n * @param requestedScopeSets The scope sets you requested.\n */\nexport function compareScopeSets(scopesToCompare, requestedScopeSets) {\n    for (const requestedScopes of requestedScopeSets) {\n        compareScopes(scopesToCompare, requestedScopes);\n    }\n}\n/**\n * Compares scopes for a non-upgradable `AuthProvider` instance, loading them from the token if necessary,\n * and returns them together with the user ID.\n *\n * @param clientId The client ID of your application.\n * @param token The access token.\n * @param userId The user ID that was already loaded.\n * @param loadedScopes The scopes that were already loaded.\n * @param requestedScopeSets The scope sets you requested.\n */\nexport async function loadAndCompareTokenInfo(clientId, token, userId, loadedScopes, requestedScopeSets) {\n    if ((requestedScopeSets === null || requestedScopeSets === void 0 ? void 0 : requestedScopeSets.length) || !userId) {\n        const userInfo = await getTokenInfo(token, clientId);\n        if (!userInfo.userId) {\n            throw new Error('Trying to use an app access token as a user access token');\n        }\n        const scopesToCompare = loadedScopes !== null && loadedScopes !== void 0 ? loadedScopes : userInfo.scopes;\n        if (requestedScopeSets) {\n            compareScopeSets(scopesToCompare, requestedScopeSets.filter((val) => Boolean(val)));\n        }\n        return [scopesToCompare, userInfo.userId];\n    }\n    return [loadedScopes, userId];\n}\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","import { __extends, __read, __spreadArray } from \"tslib\";\n/** @private */\nvar CustomError = /** @class */ (function (_super) {\n    __extends(CustomError, _super);\n    function CustomError() {\n        var params = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            params[_i] = arguments[_i];\n        }\n        var _newTarget = this.constructor;\n        var _this = this;\n        var _a;\n        // @ts-ignore\n        _this = _super.apply(this, __spreadArray([], __read(params), false)) || this;\n        // restore prototype chain\n        Object.setPrototypeOf(_this, _newTarget.prototype);\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        (_a = Error.captureStackTrace) === null || _a === void 0 ? void 0 : _a.call(Error, _this, _newTarget.constructor);\n        return _this;\n    }\n    Object.defineProperty(CustomError.prototype, \"name\", {\n        get: function () {\n            return this.constructor.name;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return CustomError;\n}(Error));\nexport { CustomError };\n","import { __extends } from \"tslib\";\nimport { CustomError } from \"./CustomError.mjs\";\nvar RateLimitReachedError = /** @class */ (function (_super) {\n    __extends(RateLimitReachedError, _super);\n    function RateLimitReachedError() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return RateLimitReachedError;\n}(CustomError));\nexport { RateLimitReachedError };\n","import { __assign, __awaiter, __generator } from \"tslib\";\nimport { createLogger } from '@d-fischer/logger';\nimport { RateLimitReachedError } from \"../errors/RateLimitReachedError.mjs\";\nvar TimeBasedRateLimiter = /** @class */ (function () {\n    function TimeBasedRateLimiter(_a) {\n        var logger = _a.logger, bucketSize = _a.bucketSize, timeFrame = _a.timeFrame, doRequest = _a.doRequest;\n        this._queue = [];\n        this._usedFromBucket = 0;\n        this._paused = false;\n        this._logger = createLogger(__assign({ name: 'rate-limiter', emoji: true }, logger));\n        this._bucketSize = bucketSize;\n        this._timeFrame = timeFrame;\n        this._callback = doRequest;\n    }\n    TimeBasedRateLimiter.prototype.request = function (req, options) {\n        return __awaiter(this, void 0, Promise, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, new Promise(function (resolve, reject) {\n                            var _a;\n                            var reqSpec = {\n                                req: req,\n                                resolve: resolve,\n                                reject: reject,\n                                limitReachedBehavior: (_a = options === null || options === void 0 ? void 0 : options.limitReachedBehavior) !== null && _a !== void 0 ? _a : 'enqueue'\n                            };\n                            if (_this._usedFromBucket >= _this._bucketSize || _this._paused) {\n                                switch (reqSpec.limitReachedBehavior) {\n                                    case 'enqueue': {\n                                        _this._queue.push(reqSpec);\n                                        if (_this._usedFromBucket + _this._queue.length >= _this._bucketSize) {\n                                            _this._logger.warn(\"Rate limit of \".concat(_this._bucketSize, \" was reached, waiting for \").concat(_this._paused ? 'the limiter to be unpaused' : 'a free bucket entry', \"; queue size is \").concat(_this._queue.length));\n                                        }\n                                        else {\n                                            _this._logger.info(\"Enqueueing request because the rate limiter is paused; queue size is \".concat(_this._queue.length));\n                                        }\n                                        break;\n                                    }\n                                    case 'null': {\n                                        reqSpec.resolve(null);\n                                        _this._logger.warn(\"Rate limit of \".concat(_this._bucketSize, \" was reached, dropping request and returning null\"));\n                                        if (_this._paused) {\n                                            _this._logger.info('Returning null for request because the rate limiter is paused');\n                                        }\n                                        else {\n                                            _this._logger.warn(\"Rate limit of \".concat(_this._bucketSize, \" was reached, dropping request and returning null\"));\n                                        }\n                                        break;\n                                    }\n                                    case 'throw': {\n                                        reqSpec.reject(new RateLimitReachedError(\"Request dropped because \".concat(_this._paused ? 'the rate limiter is paused' : 'the rate limit was reached')));\n                                        break;\n                                    }\n                                    default: {\n                                        throw new Error('this should never happen');\n                                    }\n                                }\n                            }\n                            else {\n                                void _this._runRequest(reqSpec);\n                            }\n                        })];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    TimeBasedRateLimiter.prototype.clear = function () {\n        this._queue = [];\n    };\n    TimeBasedRateLimiter.prototype.pause = function () {\n        this._paused = true;\n    };\n    TimeBasedRateLimiter.prototype.resume = function () {\n        this._paused = false;\n        this._runNextRequest();\n    };\n    TimeBasedRateLimiter.prototype._runRequest = function (reqSpec) {\n        return __awaiter(this, void 0, void 0, function () {\n            var req, resolve, reject, _a, e_1;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this._logger.debug(\"doing a request, new queue length is \".concat(this._queue.length));\n                        this._usedFromBucket += 1;\n                        req = reqSpec.req, resolve = reqSpec.resolve, reject = reqSpec.reject;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, 4, 5]);\n                        _a = resolve;\n                        return [4 /*yield*/, this._callback(req)];\n                    case 2:\n                        _a.apply(void 0, [_b.sent()]);\n                        return [3 /*break*/, 5];\n                    case 3:\n                        e_1 = _b.sent();\n                        reject(e_1);\n                        return [3 /*break*/, 5];\n                    case 4:\n                        setTimeout(function () {\n                            _this._usedFromBucket -= 1;\n                            if (_this._queue.length && _this._usedFromBucket < _this._bucketSize) {\n                                _this._runNextRequest();\n                            }\n                        }, this._timeFrame);\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TimeBasedRateLimiter.prototype._runNextRequest = function () {\n        if (this._paused) {\n            return;\n        }\n        var reqSpec = this._queue.shift();\n        if (reqSpec) {\n            void this._runRequest(reqSpec);\n        }\n    };\n    return TimeBasedRateLimiter;\n}());\nexport { TimeBasedRateLimiter };\n","import { __assign, __awaiter, __extends, __generator } from \"tslib\";\nimport { TimeBasedRateLimiter } from \"./TimeBasedRateLimiter.mjs\";\nvar TimedPassthruRateLimiter = /** @class */ (function (_super) {\n    __extends(TimedPassthruRateLimiter, _super);\n    function TimedPassthruRateLimiter(child, config) {\n        return _super.call(this, __assign(__assign({}, config), { doRequest: function (req, options) {\n                return __awaiter(this, void 0, Promise, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0: return [4 /*yield*/, child.request(req, options)];\n                            case 1: return [2 /*return*/, _a.sent()];\n                        }\n                    });\n                });\n            } })) || this;\n    }\n    return TimedPassthruRateLimiter;\n}(TimeBasedRateLimiter));\nexport { TimedPassthruRateLimiter };\n","import { __assign, __awaiter, __generator, __values } from \"tslib\";\nimport { createLogger } from '@d-fischer/logger';\nimport { RateLimitReachedError } from \"../errors/RateLimitReachedError.mjs\";\nvar PartitionedTimeBasedRateLimiter = /** @class */ (function () {\n    function PartitionedTimeBasedRateLimiter(_a) {\n        var logger = _a.logger, bucketSize = _a.bucketSize, timeFrame = _a.timeFrame, doRequest = _a.doRequest, getPartitionKey = _a.getPartitionKey;\n        this._partitionedQueue = new Map();\n        this._usedFromBucket = new Map();\n        this._paused = false;\n        this._logger = createLogger(__assign({ name: 'rate-limiter', emoji: true }, logger));\n        this._bucketSize = bucketSize;\n        this._timeFrame = timeFrame;\n        this._callback = doRequest;\n        this._partitionKeyCallback = getPartitionKey;\n    }\n    PartitionedTimeBasedRateLimiter.prototype.request = function (req, options) {\n        return __awaiter(this, void 0, Promise, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, new Promise(function (resolve, reject) {\n                            var _a, _b;\n                            var reqSpec = {\n                                req: req,\n                                resolve: resolve,\n                                reject: reject,\n                                limitReachedBehavior: (_a = options === null || options === void 0 ? void 0 : options.limitReachedBehavior) !== null && _a !== void 0 ? _a : 'enqueue'\n                            };\n                            var partitionKey = _this._partitionKeyCallback(req);\n                            var usedFromBucket = (_b = _this._usedFromBucket.get(partitionKey)) !== null && _b !== void 0 ? _b : 0;\n                            if (usedFromBucket >= _this._bucketSize || _this._paused) {\n                                switch (reqSpec.limitReachedBehavior) {\n                                    case 'enqueue': {\n                                        var queue = _this._getPartitionedQueue(partitionKey);\n                                        queue.push(reqSpec);\n                                        if (usedFromBucket + queue.length >= _this._bucketSize) {\n                                            _this._logger.warn(\"Rate limit of \".concat(_this._bucketSize, \" for \").concat(partitionKey ? \"partition \".concat(partitionKey) : 'default partition', \" was reached, waiting for \").concat(_this._paused ? 'the limiter to be unpaused' : 'a free bucket entry', \"; queue size is \").concat(queue.length));\n                                        }\n                                        else {\n                                            _this._logger.info(\"Enqueueing request for \".concat(partitionKey ? \"partition \".concat(partitionKey) : 'default partition', \" because the rate limiter is paused; queue size is \").concat(queue.length));\n                                        }\n                                        break;\n                                    }\n                                    case 'null': {\n                                        reqSpec.resolve(null);\n                                        if (_this._paused) {\n                                            _this._logger.info(\"Returning null for request for \".concat(partitionKey ? \"partition \".concat(partitionKey) : 'default partition', \" because the rate limiter is paused\"));\n                                        }\n                                        else {\n                                            _this._logger.warn(\"Rate limit of \".concat(_this._bucketSize, \" for \").concat(partitionKey ? \"partition \".concat(partitionKey) : 'default partition', \" was reached, dropping request and returning null\"));\n                                        }\n                                        break;\n                                    }\n                                    case 'throw': {\n                                        reqSpec.reject(new RateLimitReachedError(\"Request dropped because \".concat(_this._paused\n                                            ? 'the rate limiter is paused'\n                                            : \"the rate limit for \".concat(partitionKey ? \"partition \".concat(partitionKey) : 'default partition', \" was reached\"))));\n                                        break;\n                                    }\n                                    default: {\n                                        throw new Error('this should never happen');\n                                    }\n                                }\n                            }\n                            else {\n                                void _this._runRequest(reqSpec, partitionKey);\n                            }\n                        })];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    PartitionedTimeBasedRateLimiter.prototype.clear = function () {\n        this._partitionedQueue.clear();\n    };\n    PartitionedTimeBasedRateLimiter.prototype.pause = function () {\n        this._paused = true;\n    };\n    PartitionedTimeBasedRateLimiter.prototype.resume = function () {\n        var e_1, _a;\n        this._paused = false;\n        try {\n            for (var _b = __values(this._partitionedQueue.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var partitionKey = _c.value;\n                this._runNextRequest(partitionKey);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    };\n    PartitionedTimeBasedRateLimiter.prototype._getPartitionedQueue = function (partitionKey) {\n        if (this._partitionedQueue.has(partitionKey)) {\n            return this._partitionedQueue.get(partitionKey);\n        }\n        var newQueue = [];\n        this._partitionedQueue.set(partitionKey, newQueue);\n        return newQueue;\n    };\n    PartitionedTimeBasedRateLimiter.prototype._runRequest = function (reqSpec, partitionKey) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var queue, req, resolve, reject, _b, e_2;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        queue = this._getPartitionedQueue(partitionKey);\n                        this._logger.debug(\"doing a request for \".concat(partitionKey ? \"partition \".concat(partitionKey) : 'default partition', \", new queue length is \").concat(queue.length));\n                        this._usedFromBucket.set(partitionKey, ((_a = this._usedFromBucket.get(partitionKey)) !== null && _a !== void 0 ? _a : 0) + 1);\n                        req = reqSpec.req, resolve = reqSpec.resolve, reject = reqSpec.reject;\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 3, 4, 5]);\n                        _b = resolve;\n                        return [4 /*yield*/, this._callback(req)];\n                    case 2:\n                        _b.apply(void 0, [_c.sent()]);\n                        return [3 /*break*/, 5];\n                    case 3:\n                        e_2 = _c.sent();\n                        reject(e_2);\n                        return [3 /*break*/, 5];\n                    case 4:\n                        setTimeout(function () {\n                            var newUsed = _this._usedFromBucket.get(partitionKey) - 1;\n                            _this._usedFromBucket.set(partitionKey, newUsed);\n                            if (queue.length && newUsed < _this._bucketSize) {\n                                _this._runNextRequest(partitionKey);\n                            }\n                        }, this._timeFrame);\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PartitionedTimeBasedRateLimiter.prototype._runNextRequest = function (partitionKey) {\n        if (this._paused) {\n            return;\n        }\n        var queue = this._getPartitionedQueue(partitionKey);\n        var reqSpec = queue.shift();\n        if (reqSpec) {\n            void this._runRequest(reqSpec, partitionKey);\n        }\n    };\n    return PartitionedTimeBasedRateLimiter;\n}());\nexport { PartitionedTimeBasedRateLimiter };\n","import { CustomError } from '@twurple/common';\n/**\n * Thrown whenever a different token type (user vs. app) is expected in the method you're calling.\n */\nexport class InvalidTokenTypeError extends CustomError {\n}\n","import { mapNullable } from '@d-fischer/shared-utils';\n// one minute\nconst EXPIRY_GRACE_PERIOD = 60000;\nfunction getExpiryMillis(token) {\n    return mapNullable(token.expiresIn, _ => token.obtainmentTimestamp + _ * 1000 - EXPIRY_GRACE_PERIOD);\n}\n/**\n * Calculates the date when the access token will expire.\n *\n * A one-minute grace period is applied for smooth handling of API latency.\n *\n * May be `null`, in which case the token does not expire.\n * This can only be the case with very old Client IDs.\n *\n * @param token The access token.\n */\nexport function getExpiryDateOfAccessToken(token) {\n    return mapNullable(getExpiryMillis(token), _ => new Date(_));\n}\n/**\n * Calculates whether the given access token is expired.\n *\n * A one-minute grace period is applied for smooth handling of API latency.\n *\n * @param token The access token.\n */\nexport function accessTokenIsExpired(token) {\n    var _a;\n    return (_a = mapNullable(getExpiryMillis(token), _ => Date.now() > _)) !== null && _a !== void 0 ? _a : false;\n}\n","/**\n * Extracts the user ID from an argument that is possibly an object containing that ID.\n *\n * @param user The user ID or object.\n */\nexport function extractUserId(user) {\n    if (typeof user === 'string') {\n        return user;\n    }\n    else if (typeof user === 'number') {\n        return user.toString(10);\n    }\n    else {\n        return user.id;\n    }\n}\n/**\n * Extracts the user name from an argument that is possibly an object containing that name.\n *\n * @param user The user name or object.\n */\nexport function extractUserName(user) {\n    return typeof user === 'string' ? user : user.name;\n}\n","import { CustomError } from '@twurple/common';\n/**\n * Thrown whenever you try to execute an action in the context of a user\n * who is already known to have an invalid token saved in its {@link AuthProvider}.\n */\nexport class CachedRefreshFailureError extends CustomError {\n    constructor(userId) {\n        super(`The user context for the user ${userId} has been disabled.\nThis happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).\n\nUse .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`);\n        this.userId = userId;\n    }\n}\n","import { CustomError } from '@twurple/common';\n/**\n * Thrown whenever a user is removed from an {@link AuthProvider}\n * and at the same time you try to execute an action in that user's context.\n */\nexport class IntermediateUserRemovalError extends CustomError {\n    constructor(userId) {\n        super(`User ${userId} was removed while trying to fetch a token.\n\nMake sure you're not executing any actions when you want to remove a user.`);\n        this.userId = userId;\n    }\n}\n","import { CustomError } from '@twurple/common';\n/**\n * Thrown when an intent is requested that was not recognized by the {@link AuthProvider}.\n */\nexport class UnknownIntentError extends CustomError {\n    /** @private */\n    constructor(intent) {\n        super(`Unknown intent: ${intent}`);\n        this.intent = intent;\n    }\n}\n","import { promiseWithResolvers } from '@d-fischer/shared-utils';\nexport class TokenFetcher {\n    constructor(executor) {\n        this._newTokenScopeSets = [];\n        this._newTokenPromise = null;\n        this._queuedScopeSets = [];\n        this._queueExecutor = null;\n        this._queuePromise = null;\n        this._executor = executor;\n    }\n    async fetch(...scopeSets) {\n        var _a;\n        const filteredScopeSets = scopeSets.filter((val) => Boolean(val));\n        if (this._newTokenPromise) {\n            if (!filteredScopeSets.length) {\n                return await this._newTokenPromise;\n            }\n            if (this._queueExecutor) {\n                this._queuedScopeSets.push(...filteredScopeSets);\n            }\n            else {\n                this._queuedScopeSets = [...filteredScopeSets];\n            }\n            if (!this._queuePromise) {\n                const { promise, resolve, reject } = promiseWithResolvers();\n                this._queuePromise = promise;\n                this._queueExecutor = async () => {\n                    var _a;\n                    if (!this._queuePromise) {\n                        return;\n                    }\n                    this._newTokenScopeSets = this._queuedScopeSets;\n                    this._queuedScopeSets = [];\n                    this._newTokenPromise = this._queuePromise;\n                    this._queuePromise = null;\n                    this._queueExecutor = null;\n                    try {\n                        resolve(await this._executor(this._newTokenScopeSets));\n                    }\n                    catch (e) {\n                        reject(e);\n                    }\n                    finally {\n                        this._newTokenPromise = null;\n                        this._newTokenScopeSets = [];\n                        (_a = this._queueExecutor) === null || _a === void 0 ? void 0 : _a.call(this);\n                    }\n                };\n            }\n            return await this._queuePromise;\n        }\n        this._newTokenScopeSets = [...filteredScopeSets];\n        const { promise, resolve, reject } = promiseWithResolvers();\n        this._newTokenPromise = promise;\n        try {\n            resolve(await this._executor(this._newTokenScopeSets));\n        }\n        catch (e) {\n            reject(e);\n        }\n        finally {\n            this._newTokenPromise = null;\n            this._newTokenScopeSets = [];\n            (_a = this._queueExecutor) === null || _a === void 0 ? void 0 : _a.call(this);\n        }\n        return await promise;\n    }\n}\n","import { __decorate } from \"tslib\";\nimport { Enumerable } from '@d-fischer/shared-utils';\nimport { EventEmitter } from '@d-fischer/typed-event-emitter';\nimport { extractUserId, HellFreezesOverError, rtfm } from '@twurple/common';\nimport { accessTokenIsExpired } from \"../AccessToken.mjs\";\nimport { CachedRefreshFailureError } from \"../errors/CachedRefreshFailureError.mjs\";\nimport { IntermediateUserRemovalError } from \"../errors/IntermediateUserRemovalError.mjs\";\nimport { InvalidTokenError } from \"../errors/InvalidTokenError.mjs\";\nimport { InvalidTokenTypeError } from \"../errors/InvalidTokenTypeError.mjs\";\nimport { UnknownIntentError } from \"../errors/UnknownIntentError.mjs\";\nimport { compareScopeSets, exchangeCode, getAppToken, getTokenInfo, loadAndCompareTokenInfo, refreshUserToken } from \"../helpers.mjs\";\nimport { TokenFetcher } from \"../TokenFetcher.mjs\";\n/**\n * An auth provider with the ability to make use of refresh tokens,\n * automatically refreshing the access token whenever necessary.\n */\nlet RefreshingAuthProvider = class RefreshingAuthProvider extends EventEmitter {\n    /**\n     * Creates a new auth provider based on the given one that can automatically\n     * refresh access tokens.\n     *\n     * @param refreshConfig The information necessary to automatically refresh an access token.\n     */\n    constructor(refreshConfig) {\n        var _a;\n        super();\n        /** @internal */ this._userAccessTokens = new Map();\n        /** @internal */ this._userTokenFetchers = new Map();\n        this._intentToUserId = new Map();\n        this._userIdToIntents = new Map();\n        this._cachedRefreshFailures = new Set();\n        /**\n         * Fires when a user token is refreshed.\n         *\n         * @param userId The ID of the user whose token was successfully refreshed.\n         * @param token The refreshed token data.\n         */\n        this.onRefresh = this.registerEvent();\n        /**\n         * Fires when a user token fails to refresh.\n         *\n         * @param userId The ID of the user whose token wasn't successfully refreshed.\n         */\n        this.onRefreshFailure = this.registerEvent();\n        this._clientId = refreshConfig.clientId;\n        this._clientSecret = refreshConfig.clientSecret;\n        this._redirectUri = refreshConfig.redirectUri;\n        this._appImpliedScopes = (_a = refreshConfig.appImpliedScopes) !== null && _a !== void 0 ? _a : [];\n        this._appTokenFetcher = new TokenFetcher(async (scopes) => await this._fetchAppToken(scopes));\n    }\n    /**\n     * Adds the given user with their corresponding token to the provider.\n     *\n     * @param user The user to add.\n     * @param initialToken The token for the user.\n     * @param intents The intents to add to the user.\n     *\n     * Any intents that were already set before will be overwritten to point to this user instead.\n     */\n    addUser(user, initialToken, intents) {\n        const userId = extractUserId(user);\n        if (!initialToken.refreshToken) {\n            throw new Error(`Trying to add user ${userId} without refresh token`);\n        }\n        this._cachedRefreshFailures.delete(userId);\n        this._userAccessTokens.set(userId, {\n            ...initialToken,\n            userId\n        });\n        if (!this._userTokenFetchers.has(userId)) {\n            this._userTokenFetchers.set(userId, new TokenFetcher(async (scopes) => await this._fetchUserToken(userId, scopes)));\n        }\n        if (intents) {\n            this.addIntentsToUser(user, intents);\n        }\n    }\n    /**\n     * Figures out the user associated to the given token and adds them to the provider.\n     *\n     * If you already know the ID of the user you're adding,\n     * consider using {@link RefreshingAuthProvider#addUser} instead.\n     *\n     * @param initialToken The token for the user.\n     * @param intents The intents to add to the user.\n     *\n     * Any intents that were already set before will be overwritten to point to the associated user instead.\n     */\n    async addUserForToken(initialToken, intents) {\n        let tokenWithInfo = null;\n        if (initialToken.accessToken && !accessTokenIsExpired(initialToken)) {\n            try {\n                const tokenInfo = await getTokenInfo(initialToken.accessToken);\n                tokenWithInfo = [initialToken, tokenInfo];\n            }\n            catch (e) {\n                if (!(e instanceof InvalidTokenError)) {\n                    throw e;\n                }\n            }\n        }\n        if (!tokenWithInfo) {\n            if (!initialToken.refreshToken) {\n                throw new InvalidTokenError();\n            }\n            const refreshedToken = await refreshUserToken(this._clientId, this._clientSecret, initialToken.refreshToken);\n            const tokenInfo = await getTokenInfo(refreshedToken.accessToken);\n            this.emit(this.onRefresh, tokenInfo.userId, refreshedToken);\n            tokenWithInfo = [refreshedToken, tokenInfo];\n        }\n        const [tokenToAdd, tokenInfo] = tokenWithInfo;\n        if (!tokenInfo.userId) {\n            throw new InvalidTokenTypeError('Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.');\n        }\n        const token = tokenToAdd.scope\n            ? tokenToAdd\n            : {\n                ...tokenToAdd,\n                scope: tokenInfo.scopes\n            };\n        this.addUser(tokenInfo.userId, token, intents);\n        return tokenInfo.userId;\n    }\n    /**\n     * Gets an OAuth token from the given authorization code and adds the user to the provider.\n     *\n     * An authorization code can be obtained using the\n     * [OAuth Authorization Code flow](https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/#authorization-code-grant-flow).\n     *\n     * @param code The authorization code.\n     * @param intents The intents to add to the user.\n     *\n     * Any intents that were already set before will be overwritten to point to the associated user instead.\n     */\n    async addUserForCode(code, intents) {\n        if (!this._redirectUri) {\n            throw new Error('This method requires you to pass a `redirectUri` as a configuration property');\n        }\n        const token = await exchangeCode(this._clientId, this._clientSecret, code, this._redirectUri);\n        return await this.addUserForToken(token, intents);\n    }\n    /**\n     * Checks whether a user was added to the provider.\n     *\n     * @param user The user to check.\n     */\n    hasUser(user) {\n        return this._userTokenFetchers.has(extractUserId(user));\n    }\n    /**\n     * Removes a user from the provider.\n     *\n     * This also makes all intents this user was assigned to unusable.\n     *\n     * @param user The user to remove.\n     */\n    removeUser(user) {\n        const userId = extractUserId(user);\n        if (this._userIdToIntents.has(userId)) {\n            const intents = this._userIdToIntents.get(userId);\n            for (const intent of intents) {\n                this._intentToUserId.delete(intent);\n            }\n            this._userIdToIntents.delete(userId);\n        }\n        this._userAccessTokens.delete(userId);\n        this._userTokenFetchers.delete(userId);\n        this._cachedRefreshFailures.delete(userId);\n    }\n    /**\n     * Adds intents to a user.\n     *\n     * Any intents that were already set before will be overwritten to point to this user instead.\n     *\n     * @param user The user to add intents to.\n     * @param intents The intents to add to the user.\n     */\n    addIntentsToUser(user, intents) {\n        const userId = extractUserId(user);\n        if (!this._userAccessTokens.has(userId)) {\n            throw new Error('Trying to add intents to a user that was not added to this provider');\n        }\n        for (const intent of intents) {\n            if (this._intentToUserId.has(intent)) {\n                this._userIdToIntents.get(this._intentToUserId.get(intent)).delete(intent);\n            }\n            this._intentToUserId.set(intent, userId);\n            if (this._userIdToIntents.has(userId)) {\n                this._userIdToIntents.get(userId).add(intent);\n            }\n            else {\n                this._userIdToIntents.set(userId, new Set([intent]));\n            }\n        }\n    }\n    /**\n     * Gets all intents assigned to the given user.\n     *\n     * @param user The user to get intents of.\n     */\n    getIntentsForUser(user) {\n        const userId = extractUserId(user);\n        return this._userIdToIntents.has(userId) ? Array.from(this._userIdToIntents.get(userId)) : [];\n    }\n    /**\n     * Removes all given intents from any user who they might be assigned to.\n     *\n     * Intents that have not been assigned are silently ignored.\n     *\n     * @param intents The intents to remove.\n     */\n    removeIntents(intents) {\n        var _a;\n        for (const intent of intents) {\n            if (this._intentToUserId.has(intent)) {\n                const userId = this._intentToUserId.get(intent);\n                (_a = this._userIdToIntents.get(userId)) === null || _a === void 0 ? void 0 : _a.delete(intent);\n                this._intentToUserId.delete(intent);\n            }\n        }\n    }\n    /**\n     * Requests that the provider fetches a new token from Twitch for the given user.\n     *\n     * @param user The user to refresh the token for.\n     */\n    async refreshAccessTokenForUser(user) {\n        const userId = extractUserId(user);\n        if (this._cachedRefreshFailures.has(userId)) {\n            throw new CachedRefreshFailureError(userId);\n        }\n        const previousTokenData = this._userAccessTokens.get(userId);\n        if (!previousTokenData) {\n            throw new Error('Trying to refresh token for user that was not added to the provider');\n        }\n        const tokenData = await this._refreshUserTokenWithCallback(userId, previousTokenData.refreshToken);\n        this._checkIntermediateUserRemoval(userId);\n        this._userAccessTokens.set(userId, {\n            ...tokenData,\n            userId\n        });\n        this.emit(this.onRefresh, userId, tokenData);\n        return {\n            ...tokenData,\n            userId\n        };\n    }\n    /**\n     * Requests that the provider fetches a new token from Twitch for the given intent.\n     *\n     * @param intent The intent to refresh the token for.\n     */\n    async refreshAccessTokenForIntent(intent) {\n        if (!this._intentToUserId.has(intent)) {\n            throw new UnknownIntentError(intent);\n        }\n        const userId = this._intentToUserId.get(intent);\n        return await this.refreshAccessTokenForUser(userId);\n    }\n    /**\n     * The client ID.\n     */\n    get clientId() {\n        return this._clientId;\n    }\n    /**\n     * Gets the scopes that are currently available using the access token.\n     *\n     * @param user The user to get the current scopes for.\n     */\n    getCurrentScopesForUser(user) {\n        var _a;\n        const token = this._userAccessTokens.get(extractUserId(user));\n        if (!token) {\n            throw new Error('Trying to get scopes for user that was not added to the provider');\n        }\n        return (_a = token.scope) !== null && _a !== void 0 ? _a : [];\n    }\n    /**\n     * Gets an access token for the given user.\n     *\n     * @param user The user to get an access token for.\n     * @param scopeSets The requested scopes.\n     */\n    async getAccessTokenForUser(user, ...scopeSets) {\n        const userId = extractUserId(user);\n        const fetcher = this._userTokenFetchers.get(userId);\n        if (!fetcher) {\n            return null;\n        }\n        if (this._cachedRefreshFailures.has(userId)) {\n            throw new CachedRefreshFailureError(userId);\n        }\n        return await fetcher.fetch(...scopeSets);\n    }\n    /**\n     * Fetches a token for a user identified by the given intent.\n     *\n     * @param intent The intent to fetch a token for.\n     * @param scopeSets The requested scopes.\n     */\n    async getAccessTokenForIntent(intent, ...scopeSets) {\n        if (!this._intentToUserId.has(intent)) {\n            return null;\n        }\n        const userId = this._intentToUserId.get(intent);\n        const newToken = await this.getAccessTokenForUser(userId, ...scopeSets);\n        if (!newToken) {\n            throw new HellFreezesOverError(`Found intent ${intent} corresponding to user ID ${userId} but no token was found`);\n        }\n        return {\n            ...newToken,\n            userId\n        };\n    }\n    /**\n     * Fetches any token to use with a request that supports both user and app tokens,\n     * i.e. public data relating to a user.\n     *\n     * @param user The user.\n     */\n    async getAnyAccessToken(user) {\n        if (user) {\n            const userId = extractUserId(user);\n            if (this._userAccessTokens.has(userId)) {\n                const token = await this.getAccessTokenForUser(userId);\n                if (!token) {\n                    throw new HellFreezesOverError(`Token for user ID ${userId} exists but nothing was returned by getAccessTokenForUser`);\n                }\n                return {\n                    ...token,\n                    userId\n                };\n            }\n        }\n        return await this.getAppAccessToken();\n    }\n    /**\n     * Fetches an app access token.\n     *\n     * @param forceNew Whether to always get a new token, even if the old one is still deemed valid internally.\n     */\n    async getAppAccessToken(forceNew = false) {\n        if (forceNew) {\n            this._appAccessToken = undefined;\n        }\n        return await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(scopes => [scopes]));\n    }\n    _checkIntermediateUserRemoval(userId) {\n        if (!this._userTokenFetchers.has(userId)) {\n            this._cachedRefreshFailures.delete(userId);\n            throw new IntermediateUserRemovalError(userId);\n        }\n    }\n    async _fetchUserToken(userId, scopeSets) {\n        const previousToken = this._userAccessTokens.get(userId);\n        if (!previousToken) {\n            throw new Error('Trying to get token for user that was not added to the provider');\n        }\n        // if we don't have a current token, we just pass this and refresh right away\n        if (previousToken.accessToken && !accessTokenIsExpired(previousToken)) {\n            try {\n                // don't create new object on every get\n                if (previousToken.scope) {\n                    compareScopeSets(previousToken.scope, scopeSets);\n                    return previousToken;\n                }\n                const [scope = []] = await loadAndCompareTokenInfo(this._clientId, previousToken.accessToken, userId, previousToken.scope, scopeSets);\n                const newToken = {\n                    ...previousToken,\n                    scope\n                };\n                this._checkIntermediateUserRemoval(userId);\n                this._userAccessTokens.set(userId, newToken);\n                return newToken;\n            }\n            catch (e) {\n                // if loading scopes failed, ignore InvalidTokenError and proceed with refreshing\n                if (!(e instanceof InvalidTokenError)) {\n                    throw e;\n                }\n            }\n        }\n        this._checkIntermediateUserRemoval(userId);\n        const refreshedToken = await this.refreshAccessTokenForUser(userId);\n        compareScopeSets(refreshedToken.scope, scopeSets);\n        return refreshedToken;\n    }\n    async _refreshUserTokenWithCallback(userId, refreshToken) {\n        try {\n            return await refreshUserToken(this.clientId, this._clientSecret, refreshToken);\n        }\n        catch (e) {\n            this._cachedRefreshFailures.add(userId);\n            this.emit(this.onRefreshFailure, userId);\n            throw e;\n        }\n    }\n    async _fetchAppToken(scopeSets) {\n        if (scopeSets.length > 0) {\n            for (const scopes of scopeSets) {\n                if (this._appImpliedScopes.length) {\n                    if (scopes.every(scope => !this._appImpliedScopes.includes(scope))) {\n                        throw new Error(`One of the scopes ${scopes.join(', ')} requested but only the scope ${this._appImpliedScopes.join(', ')} is implied`);\n                    }\n                }\n                else {\n                    throw new Error(`One of the scopes ${scopes.join(', ')} requested but the client credentials flow does not support scopes`);\n                }\n            }\n        }\n        if (!this._appAccessToken || accessTokenIsExpired(this._appAccessToken)) {\n            return await this._refreshAppToken();\n        }\n        return this._appAccessToken;\n    }\n    async _refreshAppToken() {\n        return (this._appAccessToken = await getAppToken(this._clientId, this._clientSecret));\n    }\n};\n__decorate([\n    Enumerable(false)\n], RefreshingAuthProvider.prototype, \"_clientSecret\", void 0);\n__decorate([\n    Enumerable(false)\n], RefreshingAuthProvider.prototype, \"_userAccessTokens\", void 0);\n__decorate([\n    Enumerable(false)\n], RefreshingAuthProvider.prototype, \"_userTokenFetchers\", void 0);\n__decorate([\n    Enumerable(false)\n], RefreshingAuthProvider.prototype, \"_appAccessToken\", void 0);\n__decorate([\n    Enumerable(false)\n], RefreshingAuthProvider.prototype, \"_appTokenFetcher\", void 0);\nRefreshingAuthProvider = __decorate([\n    rtfm('auth', 'RefreshingAuthProvider', 'clientId')\n], RefreshingAuthProvider);\nexport { RefreshingAuthProvider };\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","export class DirectConnection {\n    constructor() {\n        throw new Error('DirectConnection is not implemented in a browser environment');\n    }\n}\n","import { __read, __spreadArray } from \"tslib\";\nexport function arrayToObject(arr, fn) {\n    return Object.assign.apply(Object, __spreadArray([{}], __read(arr.map(fn)), false));\n}\n","import { __read, __spreadArray } from \"tslib\";\nexport function splitWithLimit(str, delim, count) {\n    var parts = str.split(delim);\n    if (parts.length <= count) {\n        return parts;\n    }\n    return __spreadArray(__spreadArray([], __read(parts.slice(0, count - 1)), false), [parts.slice(count - 1).join(delim)], false);\n}\n","export function padLeft(str, length, padding) {\n    if (typeof str === 'number') {\n        str = str.toString();\n    }\n    length = length - str.length;\n    if (length <= 0) {\n        return str;\n    }\n    if (padding === undefined) {\n        padding = ' ';\n    }\n    var paddingStr = '';\n    do {\n        /* eslint-disable no-bitwise */\n        if ((length & 1) === 1) {\n            paddingStr += padding;\n        }\n        length >>= 1;\n        if (length) {\n            padding += padding;\n        }\n        /* eslint-enable no-bitwise */\n    } while (length);\n    return paddingStr + str;\n}\n","import { __read } from \"tslib\";\nexport function forEachObjectEntry(obj, fn) {\n    Object.entries(obj).forEach(function (_a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        return fn(value, key);\n    });\n}\n","export function klona(val) {\n\tvar k, out, tmp;\n\n\tif (Array.isArray(val)) {\n\t\tout = Array(k=val.length);\n\t\twhile (k--) out[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\treturn out;\n\t}\n\n\tif (Object.prototype.toString.call(val) === '[object Object]') {\n\t\tout = {}; // null\n\t\tfor (k in val) {\n\t\t\tif (k === '__proto__') {\n\t\t\t\tObject.defineProperty(out, k, {\n\t\t\t\t\tvalue: klona(val[k]),\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\twritable: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tout[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\treturn val;\n}\n","// dummy capability, this capability reuses the same AWAY sytax from rfc1459 for broadcasts\nexport const AwayNotifyCapability = {\n    name: 'away-notify'\n};\n","export class NotEnoughParametersError extends Error {\n    constructor(_command, _expectedParams, _actualParams) {\n        super(`command \"${_command}\" expected ${_expectedParams} or more parameters, got ${_actualParams}`);\n        this._command = _command;\n        this._expectedParams = _expectedParams;\n        this._actualParams = _actualParams;\n        Object.setPrototypeOf(this, NotEnoughParametersError.prototype);\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, NotEnoughParametersError);\n        }\n    }\n    get command() {\n        return this._command;\n    }\n    get expectedParams() {\n        return this._expectedParams;\n    }\n    get actualParams() {\n        return this._actualParams;\n    }\n}\n","export class ParameterRequirementMismatchError extends Error {\n    constructor(_command, _paramName, _paramSpec, _givenValue) {\n        var _a;\n        super(`required parameter \"${_paramName}\" did not validate against ${(_a = _paramSpec.type) !== null && _a !== void 0 ? _a : 'regex'} validation: \"${_givenValue}\"`);\n        this._command = _command;\n        this._paramName = _paramName;\n        this._paramSpec = _paramSpec;\n        this._givenValue = _givenValue;\n        Object.setPrototypeOf(this, ParameterRequirementMismatchError.prototype);\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, ParameterRequirementMismatchError);\n        }\n    }\n    get command() {\n        return this._command;\n    }\n    get paramName() {\n        return this._paramName;\n    }\n    get paramSpec() {\n        return this._paramSpec;\n    }\n    get givenValue() {\n        return this._givenValue;\n    }\n}\n","// sane defaults based on RFC 1459\nexport const defaultServerProperties = {\n    channelTypes: '#&',\n    supportedUserModes: 'iwso',\n    supportedChannelModes: {\n        prefix: 'ov',\n        list: 'b',\n        alwaysWithParam: 'ovk',\n        paramWhenSet: 'l',\n        noParam: 'imnpst'\n    },\n    prefixes: [\n        {\n            modeChar: 'v',\n            prefix: '+'\n        },\n        {\n            modeChar: 'o',\n            prefix: '@'\n        }\n    ]\n};\n","import escapeRegexString from '@d-fischer/escape-string-regexp';\nimport { splitWithLimit } from '@d-fischer/shared-utils';\nexport function sanitizeParameter(param, spaceAllowed = false) {\n    if (spaceAllowed) {\n        return param.replace(/[\\0\\r\\n]/g, '');\n    }\n    else {\n        return param.replace(/[\\0\\r\\n ]/g, '');\n    }\n}\nexport function isChannel(str, validTypes = '#&') {\n    const re = new RegExp(`^[${escapeRegexString(validTypes)}][^ \\b\\0\\n\\r,]+$`);\n    return re.test(str);\n}\n/* eslint-disable @typescript-eslint/naming-convention */\nconst ctcpEscapeMap = {\n    0: '\\0',\n    n: '\\n',\n    r: '\\r',\n    '\\x10': '\\x10'\n};\n/* eslint-enable @typescript-eslint/naming-convention */\nexport function decodeCtcp(message) {\n    if (!message.startsWith('\\x01')) {\n        // this is not a CTCP message\n        return false;\n    }\n    message = message.substring(1);\n    // remove trailing \\x01 if present\n    if (message.endsWith('\\x01')) {\n        message = message.slice(0, -1);\n    }\n    if (!message) {\n        // completely empty CTCPs don't exist either, I think\n        return false;\n    }\n    // unescape weirdly escaped stuff\n    message = message.replace(/\\x10(.)/, (_, escapedChar) => escapedChar in ctcpEscapeMap ? ctcpEscapeMap[escapedChar] : '');\n    let [command, params = ''] = splitWithLimit(message, ' ', 2);\n    command = command ? command.toUpperCase() : '';\n    return { command, params };\n}\n","import { forEachObjectEntry } from '@d-fischer/shared-utils';\nimport { NotEnoughParametersError } from \"../Errors/NotEnoughParametersError.mjs\";\nimport { ParameterRequirementMismatchError } from \"../Errors/ParameterRequirementMismatchError.mjs\";\nimport { defaultServerProperties } from \"../ServerProperties.mjs\";\nimport { isChannel } from \"../Toolkit/StringTools.mjs\";\n/* eslint-disable @typescript-eslint/naming-convention */\nconst tagEscapeMap = {\n    '\\\\': '\\\\',\n    ';': ':',\n    '\\n': 'n',\n    '\\r': 'r',\n    ' ': 's'\n};\n/* eslint-enable @typescript-eslint/naming-convention */\nfunction escapeTag(str) {\n    return str.replace(/[\\\\;\\n\\r ]/g, match => `\\\\${tagEscapeMap[match]}`);\n}\nexport function prefixToString(prefix) {\n    let result = `${prefix.nick}`;\n    if (prefix.user) {\n        result += `!${prefix.user}`;\n    }\n    if (prefix.host) {\n        result += `@${prefix.host}`;\n    }\n    return result;\n}\nexport function createMessage(type, params, prefix, tags, serverProperties = defaultServerProperties, isServer = false) {\n    const message = new type(type.COMMAND, undefined, { serverProperties });\n    const parsedParams = {};\n    if (message._paramSpec) {\n        forEachObjectEntry(message._paramSpec, (paramSpec, paramName) => {\n            if (isServer && paramSpec.noServer) {\n                return;\n            }\n            if (!isServer && paramSpec.noClient) {\n                return;\n            }\n            if (paramName in params) {\n                const param = params[paramName];\n                if (param !== undefined) {\n                    if (type.checkParam(param, paramSpec, serverProperties)) {\n                        parsedParams[paramName] = {\n                            value: param,\n                            trailing: Boolean(paramSpec.trailing)\n                        };\n                    }\n                    else if (!paramSpec.optional) {\n                        throw new Error(`required parameter \"${paramName}\" did not suit requirements: \"${param}\"`);\n                    }\n                }\n            }\n            if (!(paramName in parsedParams) && !paramSpec.optional) {\n                throw new Error(`required parameter \"${paramName}\" not found in command \"${type.COMMAND}\"`);\n            }\n        });\n    }\n    message._parsedParams = parsedParams;\n    if (message._paramSpec) {\n        for (const key of Object.keys(message._paramSpec)) {\n            Object.defineProperty(message, key, {\n                get() {\n                    var _a, _b;\n                    return (_b = (_a = this._parsedParams) === null || _a === void 0 ? void 0 : _a[key]) === null || _b === void 0 ? void 0 : _b.value;\n                }\n            });\n        }\n    }\n    message._initPrefixAndTags(prefix, tags);\n    return message;\n}\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport class Message {\n    static checkParam(param, spec, serverProperties = defaultServerProperties) {\n        if (spec.type === 'channel') {\n            if (!isChannel(param, serverProperties.channelTypes)) {\n                return false;\n            }\n        }\n        if (spec.type === 'channelList') {\n            const channels = param.split(',');\n            if (!channels.every(chan => isChannel(chan, serverProperties.channelTypes))) {\n                return false;\n            }\n        }\n        if (spec.match) {\n            if (!spec.match.test(param)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    constructor(command, { params, tags, prefix, rawLine } = {}, { serverProperties = defaultServerProperties, isServer = false, shouldParseParams = true } = {}, paramSpec) {\n        this._params = [];\n        this._serverProperties = defaultServerProperties;\n        this._paramSpec = paramSpec;\n        this._command = command;\n        this._params = params;\n        this._tags = tags !== null && tags !== void 0 ? tags : new Map();\n        this._prefix = prefix;\n        this._serverProperties = serverProperties;\n        this._raw = rawLine;\n        if (shouldParseParams) {\n            this.parseParams(isServer);\n        }\n    }\n    getMinParamCount(isServer = false) {\n        if (!this._paramSpec) {\n            return 0;\n        }\n        return Object.values(this._paramSpec).filter(spec => {\n            if (spec.noServer && isServer) {\n                return false;\n            }\n            if (spec.noClient && !isServer) {\n                return false;\n            }\n            return !spec.optional;\n        }).length;\n    }\n    get paramCount() {\n        var _a, _b;\n        return (_b = (_a = this._params) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0;\n    }\n    prefixToString() {\n        if (!this._prefix) {\n            return '';\n        }\n        return prefixToString(this._prefix);\n    }\n    tagsToString() {\n        return [...this._tags.entries()].map(([key, value]) => (value ? `${key}=${escapeTag(value)}` : key)).join(';');\n    }\n    toString(includePrefix = false, fromRawParams = false) {\n        const fullCommand = fromRawParams ? this._buildCommandFromRawParams() : this._buildCommandFromNamedParams();\n        const parts = [fullCommand];\n        if (includePrefix) {\n            const prefix = this.prefixToString();\n            if (prefix) {\n                parts.unshift(`:${prefix}`);\n            }\n        }\n        const tags = this.tagsToString();\n        if (tags) {\n            parts.unshift(`@${tags}`);\n        }\n        return parts.join(' ');\n    }\n    /** @private */\n    _initPrefixAndTags(prefix, tags) {\n        this._prefix = prefix;\n        if (tags) {\n            this._tags = tags;\n        }\n    }\n    parseParams(isServer = false) {\n        if (this._params) {\n            let requiredParamsLeft = this.getMinParamCount(isServer);\n            if (requiredParamsLeft > this._params.length) {\n                throw new NotEnoughParametersError(this._command, requiredParamsLeft, this._params.length);\n            }\n            const paramSpecList = this._paramSpec;\n            if (!paramSpecList) {\n                return;\n            }\n            let i = 0;\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            const parsedParams = {};\n            for (const [paramName, paramSpec] of Object.entries(paramSpecList)) {\n                if (paramSpec.noServer && isServer) {\n                    continue;\n                }\n                if (paramSpec.noClient && !isServer) {\n                    continue;\n                }\n                if (this._params.length - i <= requiredParamsLeft) {\n                    if (paramSpec.optional) {\n                        continue;\n                    }\n                    else if (this._params.length - i !== requiredParamsLeft) {\n                        throw new Error('not enough parameters left for required parameters parsing (this is a library bug)');\n                    }\n                }\n                let param = this._params[i];\n                // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n                if (!param) {\n                    if (paramSpec.optional) {\n                        break;\n                    }\n                    throw new Error('unexpected parameter underflow');\n                }\n                if (paramSpec.rest) {\n                    const restParams = [];\n                    while (this._params[i] && !this._params[i].trailing) {\n                        restParams.push(this._params[i].value);\n                        ++i;\n                    }\n                    if (!restParams.length) {\n                        if (paramSpec.optional) {\n                            continue;\n                        }\n                        throw new Error(`no parameters left for required rest parameter \"${paramName}\"`);\n                    }\n                    param = {\n                        value: restParams.join(' '),\n                        trailing: false\n                    };\n                }\n                if (Message.checkParam(param.value, paramSpec)) {\n                    parsedParams[paramName] = { ...param };\n                    if (!paramSpec.optional) {\n                        --requiredParamsLeft;\n                    }\n                    if (!paramSpec.rest) {\n                        ++i;\n                    }\n                }\n                else if (!paramSpec.optional) {\n                    throw new ParameterRequirementMismatchError(this._command, paramName, paramSpec, param.value);\n                }\n                if (paramSpec.trailing) {\n                    break;\n                }\n            }\n            this._parsedParams = parsedParams;\n            if (this._paramSpec) {\n                for (const key of Object.keys(this._paramSpec)) {\n                    Object.defineProperty(this, key, {\n                        get() {\n                            var _a, _b;\n                            return (_b = (_a = this._parsedParams) === null || _a === void 0 ? void 0 : _a[key]) === null || _b === void 0 ? void 0 : _b.value;\n                        }\n                    });\n                }\n            }\n        }\n    }\n    get rawParamValues() {\n        var _a, _b;\n        return (_b = (_a = this._params) === null || _a === void 0 ? void 0 : _a.map(param => param.value)) !== null && _b !== void 0 ? _b : [];\n    }\n    get prefix() {\n        return this._prefix;\n    }\n    get command() {\n        return this._command;\n    }\n    get tags() {\n        return this._tags;\n    }\n    get rawLine() {\n        return this._raw;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    isResponseTo(originalMessage) {\n        return false;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    endsResponseTo(originalMessage) {\n        return false;\n    }\n    _acceptsInReplyCollection(message) {\n        // TODO implement IRCv3 labeled-response / batch here\n        return message.isResponseTo(this);\n    }\n    _buildCommandFromNamedParams() {\n        const specKeys = this._paramSpec ? Object.keys(this._paramSpec) : [];\n        return [\n            this._command,\n            ...specKeys\n                .map((paramName) => {\n                var _a;\n                const param = (_a = this._parsedParams) === null || _a === void 0 ? void 0 : _a[paramName];\n                if (param) {\n                    return (param.trailing ? ':' : '') + param.value;\n                }\n                return undefined;\n            })\n                .filter((param) => param !== undefined)\n        ].join(' ');\n    }\n    _buildCommandFromRawParams() {\n        var _a, _b;\n        return [\n            this._command,\n            ...((_b = (_a = this._params) === null || _a === void 0 ? void 0 : _a.map(param => `${param.trailing ? ':' : ''}${param.value}`)) !== null && _b !== void 0 ? _b : [])\n        ].join(' ');\n    }\n}\nMessage.COMMAND = '';\nMessage.SUPPORTS_CAPTURE = false;\n","import { Message } from \"../../../../../Message/Message.mjs\";\nexport class Batch extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            reference: {},\n            type: { optional: true },\n            additionalParams: { optional: true }\n        });\n    }\n}\nBatch.COMMAND = 'BATCH';\n","import { Batch } from \"./MessageTypes/Commands/Batch.mjs\";\nexport const BatchCapability = {\n    name: 'batch',\n    messageTypes: [Batch],\n    usesTags: true\n};\n","// dummy capability, this capability reuses the IRCv3 CAP command with a new subcommand\nexport const CapNotifyCapability = {\n    name: 'cap-notify'\n};\n","import { Message } from \"../../../../../Message/Message.mjs\";\nexport class ChgHost extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            newUser: {},\n            newHost: {}\n        });\n    }\n}\nChgHost.COMMAND = 'CHGHOST';\n","import { ChgHost } from \"./MessageTypes/Commands/ChgHost.mjs\";\nexport const ChgHostCapability = {\n    name: 'chghost',\n    messageTypes: [ChgHost]\n};\n","// dummy capability, this capability reuses the same INVITE sytax from rfc1459 for broadcasts\nexport const InviteNotifyCapability = {\n    name: 'invite-notify'\n};\n","import { Message } from \"../../../../../Message/Message.mjs\";\nexport class Acknowledgement extends Message {\n}\nAcknowledgement.COMMAND = 'ACK';\n","import { Acknowledgement } from \"./MessageTypes/Commands/Acknowledgement.mjs\";\nexport const LabeledResponseCapability = {\n    name: 'labeled-response',\n    messageTypes: [Acknowledgement],\n    usesTags: true\n};\n","// dummy capability, TAGMSG is a core command due to other capabilities' implicit dependency on it\nexport const MessageTagsCapability = {\n    name: 'message-tags',\n    usesTags: true\n};\n","// dummy capability, the code handles both single and multiple prefixes just fine\nexport const MultiPrefixCapability = {\n    name: 'multi-prefix'\n};\n","export class MessageCollector {\n    constructor(_client, _originalMessage, ...types) {\n        this._client = _client;\n        this._originalMessage = _originalMessage;\n        this._messages = [];\n        this._endEventHandlers = new Map();\n        this._types = new Set(types);\n    }\n    untilEvent(eventType) {\n        this._cleanEndEventHandler(eventType);\n        const listener = this._client.on(eventType, () => this.end());\n        this._endEventHandlers.set(eventType, listener);\n    }\n    async promise() {\n        if (!this._promise) {\n            this._promise = new Promise(resolve => (this._promiseResolve = resolve));\n        }\n        return await this._promise;\n    }\n    collect(message) {\n        if (!this._originalMessage._acceptsInReplyCollection(message)) {\n            return false;\n        }\n        this._messages.push(message);\n        if (message.endsResponseTo(this._originalMessage)) {\n            this.end();\n        }\n        return true;\n    }\n    end() {\n        this._client.stopCollect(this);\n        this._cleanEndEventHandlers();\n        if (this._promiseResolve) {\n            this._promiseResolve(this._messages);\n        }\n    }\n    _cleanEndEventHandlers() {\n        this._endEventHandlers.forEach(listener => this._client.removeListener(listener));\n        this._endEventHandlers.clear();\n    }\n    _cleanEndEventHandler(eventType) {\n        if (this._endEventHandlers.has(eventType)) {\n            this._client.removeListener(this._endEventHandlers.get(eventType));\n            this._endEventHandlers.delete(eventType);\n        }\n    }\n}\n","import { Message } from \"../../Message.mjs\";\nexport class Password extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            password: {}\n        });\n    }\n}\nPassword.COMMAND = 'PASS';\n","import { Message } from \"../../Message.mjs\";\nexport class NickChange extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            nick: {}\n        });\n    }\n}\nNickChange.COMMAND = 'NICK';\n","import { Message } from \"../../Message.mjs\";\nexport class UserRegistration extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            user: {},\n            mode: {},\n            unused: {},\n            realName: { trailing: true }\n        });\n    }\n}\nUserRegistration.COMMAND = 'USER';\n","import { Message } from \"../../Message.mjs\";\nexport class OperLogin extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            name: {},\n            password: {}\n        });\n    }\n}\nOperLogin.COMMAND = 'OPER';\n","import { Message } from \"../../Message.mjs\";\nexport class ClientQuit extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            text: { trailing: true, optional: true }\n        });\n    }\n}\nClientQuit.COMMAND = 'QUIT';\n","import { Message } from \"../../Message.mjs\";\nexport class ServerQuit extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            server: {},\n            reason: { trailing: true }\n        });\n    }\n}\nServerQuit.COMMAND = 'SQUIT';\n","import { Message } from \"../../Message.mjs\";\nexport class ChannelJoin extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            key: { optional: true }\n        });\n    }\n}\nChannelJoin.COMMAND = 'JOIN';\n","import { Message } from \"../../Message.mjs\";\nexport class ChannelPart extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            reason: { trailing: true, optional: true }\n        });\n    }\n}\nChannelPart.COMMAND = 'PART';\n","export class UnknownChannelModeCharError extends Error {\n    constructor(_char) {\n        super(`Unknown channel mode character ${_char}`);\n        this._char = _char;\n        Object.setPrototypeOf(this, UnknownChannelModeCharError.prototype);\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, UnknownChannelModeCharError);\n        }\n    }\n    get char() {\n        return this._char;\n    }\n}\n","import { UnknownChannelModeCharError } from \"../../../Errors/UnknownChannelModeCharError.mjs\";\nimport { isChannel } from \"../../../Toolkit/StringTools.mjs\";\nimport { Message } from \"../../Message.mjs\";\nexport class Mode extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {},\n            modes: { rest: true, optional: true }\n        });\n    }\n    get isChannel() {\n        return isChannel(this.target, this._serverProperties.channelTypes);\n    }\n    separate() {\n        const result = [];\n        const modeRestParam = this.modes;\n        if (!modeRestParam) {\n            throw new Error(\"can't separate a channel mode request, just set actions\");\n        }\n        const modeParams = modeRestParam.split(' ');\n        const modes = modeParams.shift();\n        let currentModeAction = 'add';\n        for (const ch of modes) {\n            let thisModeAction = currentModeAction;\n            switch (ch) {\n                case '+': {\n                    currentModeAction = 'add';\n                    break;\n                }\n                case '-': {\n                    currentModeAction = 'remove';\n                    break;\n                }\n                default: {\n                    let requiresParam = false;\n                    let known = true;\n                    if (this.isChannel) {\n                        if (this._serverProperties.supportedChannelModes.alwaysWithParam.includes(ch) ||\n                            this._serverProperties.supportedChannelModes.prefix.includes(ch)) {\n                            requiresParam = true;\n                        }\n                        else if (this._serverProperties.supportedChannelModes.paramWhenSet.includes(ch)) {\n                            if (currentModeAction === 'add') {\n                                requiresParam = true;\n                            }\n                        }\n                        else if (this._serverProperties.supportedChannelModes.list.includes(ch)) {\n                            if (modeParams.length) {\n                                requiresParam = true;\n                            }\n                            else {\n                                thisModeAction = 'getList';\n                            }\n                        }\n                        else if (this._serverProperties.supportedChannelModes.noParam.includes(ch)) {\n                            // whatever\n                        }\n                        else {\n                            throw new UnknownChannelModeCharError(ch);\n                        }\n                    }\n                    else {\n                        // user modes never have a param\n                        // also, they don't break the whole command if invalid mode letters are given\n                        known = this._serverProperties.supportedUserModes.includes(ch);\n                    }\n                    if (requiresParam && !modeParams.length) {\n                        continue;\n                    }\n                    result.push({\n                        prefix: this._prefix,\n                        action: thisModeAction,\n                        letter: ch,\n                        param: requiresParam ? modeParams.shift() : undefined,\n                        known\n                    });\n                }\n            }\n        }\n        return result;\n    }\n}\nMode.COMMAND = 'MODE';\n","import { Message } from \"../../Message.mjs\";\nexport class Topic extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            newTopic: { optional: true, trailing: true }\n        });\n    }\n}\nTopic.COMMAND = 'TOPIC';\n","import { Message } from \"../../Message.mjs\";\nexport class Names extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channelList', optional: true }\n        });\n    }\n}\nNames.COMMAND = 'NAMES';\nNames.SUPPORTS_CAPTURE = true;\n","import { Message } from \"../../Message.mjs\";\nexport class ChannelList extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { optional: true },\n            server: { optional: true }\n        });\n    }\n}\nChannelList.COMMAND = 'LIST';\n","import { Message } from \"../../Message.mjs\";\nexport class ChannelInvite extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {},\n            channel: { type: 'channel' }\n        });\n    }\n}\nChannelInvite.COMMAND = 'INVITE';\n","import { Message } from \"../../Message.mjs\";\nexport class ChannelKick extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            target: {},\n            reason: { trailing: true, optional: true }\n        });\n    }\n}\nChannelKick.COMMAND = 'KICK';\n","import { Message } from \"../../Message.mjs\";\nexport class Time extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            server: { optional: true }\n        });\n    }\n}\nTime.COMMAND = 'TIME';\n","import { Message } from \"../../Message.mjs\";\nexport class PrivateMessage extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {},\n            text: { trailing: true }\n        });\n    }\n}\nPrivateMessage.COMMAND = 'PRIVMSG';\n","import { Message } from \"../../Message.mjs\";\nexport class Notice extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {},\n            text: { trailing: true }\n        });\n    }\n}\nNotice.COMMAND = 'NOTICE';\n","import { Message } from \"../../Message.mjs\";\nexport class WhoQuery extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            mask: {},\n            flags: { optional: true },\n            extendedMask: { optional: true, trailing: true }\n        });\n    }\n}\nWhoQuery.COMMAND = 'WHO';\n","import { Message } from \"../../Message.mjs\";\nexport class WhoIsQuery extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            server: { optional: true },\n            nickMask: {}\n        });\n    }\n}\nWhoIsQuery.COMMAND = 'WHOIS';\n","import { Message } from \"../../Message.mjs\";\nexport class WhoWasQuery extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            nick: {},\n            count: { optional: true },\n            server: { optional: true }\n        });\n    }\n}\nWhoWasQuery.COMMAND = 'WHOWAS';\n","import { Message } from \"../../Message.mjs\";\nexport class Kill extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {},\n            reason: { trailing: true, optional: true }\n        });\n    }\n}\nKill.COMMAND = 'KILL';\n","import { Message } from \"../../Message.mjs\";\nexport class Ping extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            text: { trailing: true }\n        });\n    }\n}\nPing.COMMAND = 'PING';\n","import { Message } from \"../../Message.mjs\";\nexport class Pong extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            server: { noClient: true },\n            text: { trailing: true }\n        });\n    }\n}\nPong.COMMAND = 'PONG';\n","import { Message } from \"../../Message.mjs\";\nexport class ErrorMessage extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            text: { trailing: true }\n        });\n    }\n}\nErrorMessage.COMMAND = 'ERROR';\n","import { Message } from \"../../Message.mjs\";\nexport class Away extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            text: {\n                trailing: true,\n                optional: true\n            }\n        });\n    }\n}\nAway.COMMAND = 'AWAY';\n","import { Message } from \"../../Message.mjs\";\nexport class Rehash extends Message {\n}\nRehash.COMMAND = 'REHASH';\n","import { Message } from \"../../Message.mjs\";\nexport class Restart extends Message {\n}\nRestart.COMMAND = 'RESTART';\n","import { Message } from \"../../Message.mjs\";\nexport class WallopsMessage extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            text: { trailing: true }\n        });\n    }\n}\nWallopsMessage.COMMAND = 'WALLOPS';\n","import { Message } from \"../../Message.mjs\";\nexport class UserHostQuery extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            nicks: { rest: true }\n        });\n    }\n}\nUserHostQuery.COMMAND = 'USERHOST';\n","import { Message } from \"../../Message.mjs\";\nexport class IsOnQuery extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            nicks: { rest: true }\n        });\n    }\n}\nIsOnQuery.COMMAND = 'ISON';\n","import { Message } from \"../../Message.mjs\";\nexport class CapabilityNegotiation extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {\n                match: /^(?:[a-z_\\-\\[\\]\\\\^{}|`][a-z0-9_\\-\\[\\]\\\\^{}|`]+|\\*)$/i,\n                optional: true,\n                noClient: true\n            },\n            subCommand: { match: /^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i },\n            version: { match: /^\\d+$/, optional: true },\n            continued: { match: /^\\*$/, optional: true },\n            capabilities: { trailing: true, optional: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        if (!(originalMessage instanceof CapabilityNegotiation)) {\n            return false;\n        }\n        switch (this.subCommand) {\n            case 'ACK':\n            case 'NAK': {\n                // trim is necessary because some networks seem to add trailing spaces (looking at you, Freenode)...\n                return (originalMessage.subCommand === 'REQ' && originalMessage.capabilities === this.capabilities.trim());\n            }\n            case 'LS':\n            case 'LIST': {\n                return originalMessage.subCommand === this.subCommand;\n            }\n            default: {\n                return false;\n            }\n        }\n    }\n    endsResponseTo(originalMessage) {\n        if (!(originalMessage instanceof CapabilityNegotiation)) {\n            return false;\n        }\n        switch (this.subCommand) {\n            case 'LS':\n            case 'LIST': {\n                return !this.continued;\n            }\n            default: {\n                return true;\n            }\n        }\n    }\n}\nCapabilityNegotiation.COMMAND = 'CAP';\nCapabilityNegotiation.SUPPORTS_CAPTURE = true;\n","import { Message } from \"../../Message.mjs\";\nexport class TagMessage extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {}\n        });\n    }\n}\nTagMessage.COMMAND = 'TAGMSG';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply001Welcome extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            welcomeText: {\n                trailing: true\n            }\n        });\n    }\n}\nReply001Welcome.COMMAND = '001';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply002YourHost extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            yourHost: { trailing: true }\n        });\n    }\n}\nReply002YourHost.COMMAND = '002';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply003Created extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            createdText: { trailing: true }\n        });\n    }\n}\nReply003Created.COMMAND = '003';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply004ServerInfo extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            serverName: {},\n            version: {},\n            userModes: {},\n            channelModes: {},\n            channelModesWithParam: {\n                optional: true\n            }\n        });\n    }\n}\nReply004ServerInfo.COMMAND = '004';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply005Isupport extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            supports: { rest: true },\n            suffix: { trailing: true }\n        });\n    }\n}\nReply005Isupport.COMMAND = '005';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply221UmodeIs extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            modes: {}\n        });\n    }\n}\nReply221UmodeIs.COMMAND = '221';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply301Away extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            text: { trailing: true }\n        });\n    }\n}\nReply301Away.COMMAND = '301';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply302UserHost extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            hosts: { trailing: true }\n        });\n    }\n}\nReply302UserHost.COMMAND = '302';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply305UnAway extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nReply305UnAway.COMMAND = '305';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply306NowAway extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nReply306NowAway.COMMAND = '306';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply311WhoisUser extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            username: {},\n            host: {},\n            _unused: {},\n            realname: { trailing: true }\n        });\n    }\n}\nReply311WhoisUser.COMMAND = '311';\n","import { Message } from \"../../Message.mjs\";\nimport { WhoQuery } from \"../Commands/WhoQuery.mjs\";\nexport class Reply315EndOfWho extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            query: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage instanceof WhoQuery;\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nReply315EndOfWho.COMMAND = '315';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply318EndOfWhois extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nickMask: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nReply318EndOfWhois.COMMAND = '318';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply319WhoisChannels extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            channels: { trailing: true }\n        });\n    }\n}\nReply319WhoisChannels.COMMAND = '319';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply322List extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            memberCount: {},\n            topic: { trailing: true }\n        });\n    }\n}\nReply322List.COMMAND = '322';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply323ListEnd extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nReply323ListEnd.COMMAND = '323';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply324ChannelModeIs extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            modes: { rest: true }\n        });\n    }\n}\nReply324ChannelModeIs.COMMAND = '324';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply331NoTopic extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nReply331NoTopic.COMMAND = '331';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply332Topic extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            topic: { trailing: true }\n        });\n    }\n}\nReply332Topic.COMMAND = '332';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply333TopicWhoTime extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            who: {},\n            ts: {}\n        });\n    }\n}\nReply333TopicWhoTime.COMMAND = '333';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply341Inviting extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            channel: { type: 'channel' }\n        });\n    }\n}\nReply341Inviting.COMMAND = '341';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply348ExceptList extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            mask: {},\n            creatorName: { optional: true },\n            timestamp: { optional: true }\n        });\n    }\n}\nReply348ExceptList.COMMAND = '348';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply349EndOfExceptList extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nReply349EndOfExceptList.COMMAND = '349';\n","import { Message } from \"../../Message.mjs\";\nimport { WhoQuery } from \"../Commands/WhoQuery.mjs\";\nexport class Reply352WhoReply extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: {},\n            user: {},\n            host: {},\n            server: {},\n            nick: {},\n            flags: {},\n            hopsAndRealName: { trailing: true }\n        });\n    }\n    /**\n     * Checks whether the found user is /away.\n     */\n    get isAway() {\n        return this.flags.includes('G');\n    }\n    /**\n     * Checks whether the found user is an IRCOp.\n     */\n    get isOper() {\n        return this.flags.includes('*');\n    }\n    /**\n     * Checks whether the found user is a bot.\n     */\n    get isBot() {\n        return this.flags.includes('B');\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage instanceof WhoQuery;\n    }\n}\nReply352WhoReply.COMMAND = '352';\n","import { Message } from \"../../Message.mjs\";\nimport { Names } from \"../Commands/Names.mjs\";\nexport class Reply353NamesReply extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channelType: {},\n            channel: { type: 'channel' },\n            names: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage instanceof Names;\n    }\n}\nReply353NamesReply.COMMAND = '353';\n","import { Message } from \"../../Message.mjs\";\nimport { Names } from \"../Commands/Names.mjs\";\nexport class Reply366EndOfNames extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage instanceof Names;\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nReply366EndOfNames.COMMAND = '366';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply367BanList extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            mask: {},\n            creatorName: { optional: true },\n            timestamp: { optional: true }\n        });\n    }\n}\nReply367BanList.COMMAND = '367';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply368EndOfBanList extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nReply368EndOfBanList.COMMAND = '368';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply372Motd extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            line: { trailing: true }\n        });\n    }\n}\nReply372Motd.COMMAND = '372';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply375MotdStart extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            line: { trailing: true }\n        });\n    }\n}\nReply375MotdStart.COMMAND = '375';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply376EndOfMotd extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nReply376EndOfMotd.COMMAND = '376';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply381YoureOper extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nReply381YoureOper.COMMAND = '381';\n","import { Message } from \"../../Message.mjs\";\nexport class Reply391Time extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            server: { optional: true },\n            timestamp: { trailing: true }\n        });\n    }\n}\nReply391Time.COMMAND = '391';\n","import { Message } from \"../../Message.mjs\";\nexport class Error401NoSuchNick extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError401NoSuchNick.COMMAND = '401';\n","import { Message } from \"../../Message.mjs\";\nexport class Error402NoSuchServer extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            server: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError402NoSuchServer.COMMAND = '402';\n","import { Message } from \"../../Message.mjs\";\nexport class Error403NoSuchChannel extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError403NoSuchChannel.COMMAND = '403';\n","import { Message } from \"../../Message.mjs\";\nexport class Error404CanNotSendToChan extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nError404CanNotSendToChan.COMMAND = '404';\n","import { Message } from \"../../Message.mjs\";\nexport class Error405TooManyChannels extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nError405TooManyChannels.COMMAND = '405';\n","import { Message } from \"../../Message.mjs\";\nexport class Error410InvalidCapCmd extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            subCommand: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError410InvalidCapCmd.COMMAND = '410';\n","import { Message } from \"../../Message.mjs\";\nexport class Error421UnknownCommand extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            originalCommand: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === this.originalCommand;\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError421UnknownCommand.COMMAND = '421';\n","import { Message } from \"../../Message.mjs\";\nexport class Error422NoMotd extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError422NoMotd.COMMAND = '422';\n","import { Message } from \"../../Message.mjs\";\nexport class Error431NoNickNameGiven extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError431NoNickNameGiven.COMMAND = '431';\n","import { Message } from \"../../Message.mjs\";\nexport class Error432ErroneusNickname extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError432ErroneusNickname.COMMAND = '432';\n","import { Message } from \"../../Message.mjs\";\nexport class Error433NickNameInUse extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError433NickNameInUse.COMMAND = '433';\n","import { Message } from \"../../Message.mjs\";\nexport class Error436NickCollision extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError436NickCollision.COMMAND = '436';\n","import { Message } from \"../../Message.mjs\";\nexport class Error441UserNotInChannel extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError441UserNotInChannel.COMMAND = '441';\n","import { Message } from \"../../Message.mjs\";\nexport class Error442NotOnChannel extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError442NotOnChannel.COMMAND = '442';\n","import { Message } from \"../../Message.mjs\";\nexport class Error443UserOnChannel extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            nick: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n    isResponseTo(originalMessage) {\n        return originalMessage.command === 'NICK';\n    }\n    endsResponseTo() {\n        return true;\n    }\n}\nError443UserOnChannel.COMMAND = '443';\n","import { Message } from \"../../Message.mjs\";\nexport class Error451NotRegistered extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError451NotRegistered.COMMAND = '451';\n","import { Message } from \"../../Message.mjs\";\nexport class Error461NeedMoreParams extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            originalCommand: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError461NeedMoreParams.COMMAND = '461';\n","import { Message } from \"../../Message.mjs\";\nexport class Error462AlreadyRegistered extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError462AlreadyRegistered.COMMAND = '462';\n","import { Message } from \"../../Message.mjs\";\nexport class Error471ChannelIsFull extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nError471ChannelIsFull.COMMAND = '471';\n","import { Message } from \"../../Message.mjs\";\nexport class Error472UnknownMode extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            char: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError472UnknownMode.COMMAND = '472';\n","import { Message } from \"../../Message.mjs\";\nexport class Error473InviteOnlyChan extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nError473InviteOnlyChan.COMMAND = '473';\n","import { Message } from \"../../Message.mjs\";\nexport class Error474BannedFromChan extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nError474BannedFromChan.COMMAND = '474';\n","import { Message } from \"../../Message.mjs\";\nexport class Error475BadChannelKey extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: { type: 'channel' },\n            suffix: { trailing: true }\n        });\n    }\n}\nError475BadChannelKey.COMMAND = '475';\n","import { Message } from \"../../Message.mjs\";\nexport class Error479BadChanName extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError479BadChanName.COMMAND = '479';\n","import { Message } from \"../../Message.mjs\";\nexport class Error481NoPrivileges extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError481NoPrivileges.COMMAND = '481';\n","import { Message } from \"../../Message.mjs\";\nexport class Error482ChanOpPrivsNeeded extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            channel: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError482ChanOpPrivsNeeded.COMMAND = '482';\n","import { Message } from \"../../Message.mjs\";\nexport class Error491NoOperHost extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError491NoOperHost.COMMAND = '491';\n","import { Message } from \"../../Message.mjs\";\nexport class Error501UmodeUnknownFlag extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            modeChar: { optional: true, match: /^\\w$/ },\n            suffix: { trailing: true }\n        });\n    }\n}\nError501UmodeUnknownFlag.COMMAND = '501';\n","import { Message } from \"../../Message.mjs\";\nexport class Error502UsersDontMatch extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            me: {},\n            suffix: { trailing: true }\n        });\n    }\n}\nError502UsersDontMatch.COMMAND = '502';\n","import * as Commands from \"./Commands/index.mjs\";\nimport * as Numerics from \"./Numerics/index.mjs\";\nexport { Commands, Numerics };\nexport const all = new Map([...Object.values(Commands), ...Object.values(Numerics)].map((cmd) => [cmd.COMMAND, cmd]));\n","import { splitWithLimit } from '@d-fischer/shared-utils';\nimport { defaultServerProperties } from \"../ServerProperties.mjs\";\nimport { Message } from \"./Message.mjs\";\nimport { all as coreMessageTypes } from \"./MessageTypes/index.mjs\";\nexport function parsePrefix(raw) {\n    const [nick, hostName] = splitWithLimit(raw, '!', 2);\n    if (hostName) {\n        const [user, host] = splitWithLimit(hostName, '@', 2);\n        if (host) {\n            return { nick, user, host };\n        }\n        else {\n            return { nick, host: user };\n        }\n    }\n    else {\n        return { nick };\n    }\n}\nconst tagUnescapeMap = {\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    ':': ';',\n    n: '\\n',\n    r: '\\r',\n    s: ' '\n};\nexport function parseTags(raw) {\n    const tags = new Map();\n    const tagStrings = raw.split(';');\n    for (const tagString of tagStrings) {\n        const [tagName, tagValue] = splitWithLimit(tagString, '=', 2);\n        if (tagName === '') {\n            continue; // Ignore empty tags: @ @; etc.\n        }\n        // unescape according to http://ircv3.net/specs/core/message-tags-3.2.html#escaping-values\n        tags.set(tagName, tagValue\n            ? tagValue.replace(/\\\\(.?)/g, (_, match) => Object.prototype.hasOwnProperty.call(tagUnescapeMap, match) ? tagUnescapeMap[match] : match)\n            : '');\n    }\n    return tags;\n}\nexport function parseMessage(rawLine, serverProperties = defaultServerProperties, knownCommands = coreMessageTypes, isServer = false, nonConformingCommands = [], shouldParseParams = true) {\n    const splitLine = rawLine.split(' ');\n    // eslint-disable-next-line @typescript-eslint/init-declarations\n    let token;\n    // eslint-disable-next-line @typescript-eslint/init-declarations\n    let command;\n    const params = [];\n    let tags = undefined;\n    // eslint-disable-next-line @typescript-eslint/init-declarations\n    let prefix;\n    while (splitLine.length) {\n        token = splitLine[0];\n        if (token.startsWith('@') && !tags && !command && !prefix) {\n            tags = parseTags(token.slice(1));\n        }\n        else if (token.startsWith(':')) {\n            if (!prefix && !command) {\n                if (token.length > 1) {\n                    // Not an empty prefix\n                    prefix = parsePrefix(token.slice(1));\n                }\n            }\n            else {\n                params.push({\n                    value: splitLine.join(' ').slice(1),\n                    trailing: true\n                });\n                break;\n            }\n        }\n        else if (command) {\n            params.push({\n                value: token,\n                trailing: false\n            });\n        }\n        else {\n            command = token.toUpperCase();\n        }\n        splitLine.shift();\n    }\n    if (!tags) {\n        tags = new Map();\n    }\n    if (!command) {\n        throw new Error(`line without command received: ${rawLine}`);\n    }\n    shouldParseParams && (shouldParseParams = !nonConformingCommands.includes(command));\n    let messageClass = Message;\n    if (knownCommands.has(command)) {\n        messageClass = knownCommands.get(command);\n    }\n    return new messageClass(command, {\n        params,\n        tags,\n        prefix,\n        rawLine\n    }, {\n        serverProperties,\n        isServer,\n        shouldParseParams\n    });\n}\n","import { __decorate } from \"tslib\";\nimport { DirectConnection, PersistentConnection, WebSocketConnection } from '@d-fischer/connection';\nimport { createLogger } from '@d-fischer/logger';\nimport { arrayToObject, Enumerable, forEachObjectEntry, padLeft, resolveConfigValue, splitWithLimit } from '@d-fischer/shared-utils';\nimport { EventEmitter } from '@d-fischer/typed-event-emitter';\nimport { klona } from 'klona/json';\nimport * as CoreCapabilities from \"./Capability/CoreCapabilities/index.mjs\";\nimport { createMessage } from \"./Message/Message.mjs\";\nimport { MessageCollector } from \"./Message/MessageCollector.mjs\";\nimport { parseMessage } from \"./Message/MessageParser.mjs\";\nimport * as MessageTypes from \"./Message/MessageTypes/index.mjs\";\nimport { CapabilityNegotiation, ChannelJoin, ChannelPart, ClientQuit, NickChange, Notice, Password, Ping, Pong, PrivateMessage, UserRegistration } from \"./Message/MessageTypes/Commands/index.mjs\";\nimport { Error422NoMotd, Error462AlreadyRegistered, Reply001Welcome, Reply004ServerInfo, Reply005Isupport, Reply376EndOfMotd } from \"./Message/MessageTypes/Numerics/index.mjs\";\nimport { defaultServerProperties } from \"./ServerProperties.mjs\";\nimport { decodeCtcp } from \"./Toolkit/StringTools.mjs\";\nexport class IrcClient extends EventEmitter {\n    constructor(options) {\n        super();\n        this._registered = false;\n        this._supportsCapabilities = true;\n        this._events = new Map();\n        this._registeredMessageTypes = new Map();\n        /**\n         * @eventListener\n         */\n        this.onConnect = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onRegister = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onDisconnect = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onPrivmsg = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onAction = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onNotice = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onNickChange = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onCtcp = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onCtcpReply = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onPasswordError = this.registerEvent();\n        /**\n         * @eventListener\n         */\n        this.onAnyMessage = this.registerEvent();\n        this._serverProperties = klona(defaultServerProperties);\n        this._supportedFeatures = {};\n        this._collectors = [];\n        this._clientCapabilities = new Map();\n        this._serverCapabilities = new Map();\n        this._negotiatedCapabilities = new Map();\n        this._currentChannels = new Set();\n        this._hasRegisteredBefore = false;\n        this._channelsFromLastRegister = new Set();\n        this._initialConnectionSetupDone = false;\n        const { connection, credentials, channels, channelTypes, webSocket, logger = {} } = options;\n        this._options = options;\n        const { pingOnInactivity = 60, pingTimeout = 10 } = connection;\n        this._pingOnInactivity = pingOnInactivity;\n        this._pingTimeout = pingTimeout;\n        this._currentNick = credentials.nick;\n        this._logger = createLogger({ name: 'ircv3', emoji: true, ...logger });\n        this.registerCoreMessageTypes();\n        const { hostName, secure, reconnect = true } = connection;\n        const connectionTarget = {\n            hostName,\n            port: this.port,\n            secure\n        };\n        const connectionOptions = {\n            lineBased: true,\n            logger: this._logger,\n            additionalOptions: options.connectionOptions\n        };\n        const ConnectionType = webSocket ? WebSocketConnection : DirectConnection;\n        if (reconnect) {\n            this._connection = new PersistentConnection(ConnectionType, connectionTarget, connectionOptions);\n        }\n        else {\n            this._connection = new ConnectionType(connectionOptions, this._logger, options.connectionOptions);\n        }\n        for (const cap of Object.values(CoreCapabilities)) {\n            this.addCapability(cap);\n        }\n        this.addInternalListener(this.onRegister, async () => {\n            const hasRegisteredBefore = this._hasRegisteredBefore;\n            const channelsFromLastRegister = this._channelsFromLastRegister;\n            this._hasRegisteredBefore = true;\n            this._channelsFromLastRegister = new Set();\n            const resolvedChannels = hasRegisteredBefore && this._options.rejoinChannelsOnReconnect\n                ? channelsFromLastRegister\n                : await resolveConfigValue(channels);\n            if (resolvedChannels) {\n                for (const channel of resolvedChannels) {\n                    this.join(channel);\n                }\n            }\n        });\n        this.onTypedMessage(CapabilityNegotiation, async ({ subCommand, capabilities }) => {\n            const caps = capabilities.split(' ');\n            // eslint-disable-next-line default-case\n            switch (subCommand.toUpperCase()) {\n                case 'NEW': {\n                    this._logger.debug(`Server registered new capabilities: ${caps.join(', ')}`);\n                    const capList = arrayToObject(caps, (part) => {\n                        if (!part) {\n                            return {};\n                        }\n                        const [cap, param] = splitWithLimit(part, '=', 2);\n                        return {\n                            [cap]: {\n                                name: cap,\n                                param: param || true\n                            }\n                        };\n                    });\n                    for (const [name, cap] of Object.entries(capList)) {\n                        this._serverCapabilities.set(name, cap);\n                    }\n                    const capNames = Object.keys(capList);\n                    await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries())\n                        .filter(([name]) => capNames.includes(name))\n                        .map(([, cap]) => cap));\n                    break;\n                }\n                case 'DEL': {\n                    this._logger.debug(`Server removed capabilities: ${caps.join(', ')}`);\n                    for (const cap of caps) {\n                        this._serverCapabilities.delete(cap);\n                        this._negotiatedCapabilities.delete(cap);\n                    }\n                }\n            }\n        });\n        this.onTypedMessage(Ping, ({ text }) => {\n            this.sendMessage(Pong, { text });\n        });\n        this.onTypedMessage(Reply001Welcome, ({ me }) => this._handleReceivedClientNick(me));\n        this.onTypedMessage(Reply004ServerInfo, ({ userModes }) => {\n            if (userModes) {\n                this._serverProperties.supportedUserModes = userModes;\n            }\n        });\n        this.onTypedMessage(Reply005Isupport, ({ supports }) => {\n            const newFeatures = arrayToObject(supports.split(' '), part => {\n                const [support, param] = splitWithLimit(part, '=', 2);\n                return { [support]: param || true };\n            });\n            this._supportedFeatures = {\n                ...this._supportedFeatures,\n                ...newFeatures\n            };\n        });\n        this.onTypedMessage(Reply376EndOfMotd, ({ me }) => {\n            if (!this._registered) {\n                this._handleReceivedClientNick(me);\n                this._registered = true;\n                this.emit(this.onRegister);\n            }\n        });\n        this.onTypedMessage(Error422NoMotd, ({ me }) => {\n            if (!this._registered) {\n                this._handleReceivedClientNick(me);\n                this._registered = true;\n                this.emit(this.onRegister);\n            }\n        });\n        this.onTypedMessage(Error462AlreadyRegistered, ({ me }) => {\n            // what, I thought we are not registered yet?\n            if (!this._registered) {\n                // screw this, we are now.\n                this._logger.warn(\"We thought we're not registered yet, but we actually are\");\n                this._handleReceivedClientNick(me);\n                this._registered = true;\n                this.emit(this.onRegister);\n            }\n        });\n        this.onTypedMessage(PrivateMessage, msg => {\n            var _a;\n            const { target, text } = msg;\n            const ctcpMessage = decodeCtcp(text);\n            const nick = (_a = msg.prefix) === null || _a === void 0 ? void 0 : _a.nick;\n            if (ctcpMessage) {\n                if (ctcpMessage.command === 'ACTION') {\n                    this.emit(this.onAction, target, nick, ctcpMessage.params, msg);\n                }\n                else {\n                    this.emit(this.onCtcp, target, nick, ctcpMessage.command, ctcpMessage.params, msg);\n                }\n            }\n            else {\n                this.emit(this.onPrivmsg, target, nick, text, msg);\n            }\n        });\n        this.onTypedMessage(NickChange, msg => {\n            var _a;\n            const { nick: newNick } = msg;\n            const oldNick = (_a = msg.prefix) === null || _a === void 0 ? void 0 : _a.nick;\n            if (oldNick === this._currentNick) {\n                this._currentNick = newNick;\n            }\n            this.emit(this.onNickChange, oldNick, newNick, msg);\n        });\n        this.onTypedMessage(Notice, msg => {\n            var _a;\n            const { target, text } = msg;\n            const ctcpMessage = decodeCtcp(text);\n            const nick = (_a = msg.prefix) === null || _a === void 0 ? void 0 : _a.nick;\n            if (ctcpMessage) {\n                this.emit(this.onCtcpReply, target, nick, ctcpMessage.command, ctcpMessage.params, msg);\n            }\n            this.emit(this.onNotice, target, nick, text, msg);\n        });\n        if (!this._options.manuallyAcknowledgeJoins) {\n            this.onTypedMessage(ChannelJoin, ({ channel, prefix }) => {\n                if ((prefix === null || prefix === void 0 ? void 0 : prefix.nick) === this._currentNick) {\n                    this.acknowledgeJoin(channel);\n                }\n            });\n        }\n        this.onTypedMessage(ChannelPart, msg => {\n            var _a;\n            if (((_a = msg.prefix) === null || _a === void 0 ? void 0 : _a.nick) === this._currentNick) {\n                this._currentChannels.delete(msg.channel);\n                this._channelsFromLastRegister.delete(msg.channel);\n            }\n        });\n        this.addInternalListener(this.onRegister, () => this._startPingCheckTimer());\n        this._desiredNick = credentials.nick;\n        this._userName = credentials.userName;\n        this._realName = credentials.realName;\n        if (channelTypes) {\n            this._serverProperties.channelTypes = channelTypes;\n        }\n    }\n    receiveLine(line) {\n        var _a;\n        this._logger.debug(`Received message: ${line}`);\n        // eslint-disable-next-line @typescript-eslint/init-declarations\n        let parsedMessage;\n        try {\n            parsedMessage = parseMessage(line, this._serverProperties, this._registeredMessageTypes, true, this._options.nonConformingCommands);\n        }\n        catch (e) {\n            this._logger.error(`Error parsing message: ${e.message}`);\n            this._logger.trace((_a = e.stack) !== null && _a !== void 0 ? _a : 'No stack available');\n            return;\n        }\n        this._logger.trace(`Parsed message: ${JSON.stringify(parsedMessage)}`);\n        this._startPingCheckTimer();\n        this.emit(this.onAnyMessage, parsedMessage);\n        this._handleEvents(parsedMessage);\n    }\n    get serverProperties() {\n        return klona(this._serverProperties);\n    }\n    get port() {\n        const { webSocket, connection: { port, secure } } = this._options;\n        if (port) {\n            return port;\n        }\n        if (webSocket) {\n            return secure ? 443 : 80;\n        }\n        return secure ? 6697 : 6667;\n    }\n    pingCheck() {\n        const now = Date.now();\n        const nowStr = now.toString();\n        const handler = this.onTypedMessage(Pong, (msg) => {\n            const { text } = msg;\n            if (text === nowStr) {\n                this._logger.debug(`Current ping: ${Date.now() - now}ms`);\n                if (this._pingTimeoutTimer) {\n                    clearTimeout(this._pingTimeoutTimer);\n                }\n                this.removeMessageListener(handler);\n            }\n        });\n        this._pingTimeoutTimer = setTimeout(() => {\n            this.removeMessageListener(handler);\n            // eslint-disable-next-line no-restricted-syntax\n            if (this._options.connection.reconnect === false) {\n                this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`);\n            }\n            else {\n                this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`);\n            }\n            this._connection.assumeExternalDisconnect();\n        }, this._pingTimeout * 1000);\n        this.sendMessage(Ping, { text: nowStr });\n    }\n    reconnect(message) {\n        this.quit(message);\n        this.connect();\n    }\n    registerMessageType(cls) {\n        if (cls.COMMAND !== '') {\n            this._logger.trace(`Registering message type ${cls.COMMAND}`);\n            this._registeredMessageTypes.set(cls.COMMAND.toUpperCase(), cls);\n        }\n    }\n    knowsCommand(command) {\n        return this._registeredMessageTypes.has(command.toUpperCase());\n    }\n    getCommandClass(command) {\n        return this._registeredMessageTypes.get(command.toUpperCase());\n    }\n    acknowledgeJoin(channel) {\n        this._currentChannels.add(channel);\n        this._channelsFromLastRegister.add(channel);\n    }\n    connect() {\n        this._supportsCapabilities = false;\n        this._negotiatedCapabilities = new Map();\n        this._currentChannels = new Set();\n        this._currentNick = this._desiredNick;\n        this._setupConnection();\n        this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`);\n        this._connection.connect();\n    }\n    addCapability(cap) {\n        this._clientCapabilities.set(cap.name, cap);\n        if (cap.messageTypes) {\n            for (const messageType of Object.values(cap.messageTypes)) {\n                this.registerMessageType(messageType);\n            }\n        }\n    }\n    async registerCapability(cap) {\n        this.addCapability(cap);\n        if (this._serverCapabilities.has(cap.name)) {\n            return await this._negotiateCapabilities([cap]);\n        }\n        return [];\n    }\n    send(message) {\n        this.sendRaw(message.toString());\n    }\n    sendRaw(line) {\n        if (this._connection.isConnected) {\n            this._logger.debug(`Sending message: ${line}`);\n            this._connection.sendLine(line);\n        }\n    }\n    onNamedMessage(commandName, handler, handlerName) {\n        if (!this._events.has(commandName)) {\n            this._events.set(commandName, new Map());\n        }\n        const handlerList = this._events.get(commandName);\n        if (!handlerName) {\n            do {\n                handlerName = `${commandName}:${padLeft(Math.random() * 10000, 4, '0')}`;\n            } while (handlerList.has(handlerName));\n        }\n        handlerList.set(handlerName, handler);\n        return handlerName;\n    }\n    onTypedMessage(type, handler, handlerName) {\n        return this.onNamedMessage(type.COMMAND, handler, handlerName);\n    }\n    removeMessageListener(handlerName) {\n        const [commandName] = handlerName.split(':');\n        if (!this._events.has(commandName)) {\n            return;\n        }\n        this._events.get(commandName).delete(handlerName);\n    }\n    createMessage(type, params, tags) {\n        const tagsMap = tags ? new Map(Object.entries(tags)) : undefined;\n        return createMessage(type, params, undefined, tagsMap, this.serverProperties);\n    }\n    sendMessage(type, params, tags) {\n        this.send(this.createMessage(type, params, tags));\n    }\n    async sendMessageAndCaptureReply(type, params) {\n        if (!type.SUPPORTS_CAPTURE) {\n            throw new Error(`The command \"${type.COMMAND}\" does not support reply capture`);\n        }\n        const message = this.createMessage(type, params);\n        const promise = this.collect(message).promise();\n        this.send(message);\n        return await promise;\n    }\n    get isConnected() {\n        return this._connection.isConnected;\n    }\n    get isConnecting() {\n        return this._connection.isConnecting;\n    }\n    get isRegistered() {\n        return this._registered;\n    }\n    get currentNick() {\n        return this._currentNick;\n    }\n    get currentChannels() {\n        return Array.from(this._currentChannels);\n    }\n    /** @private */\n    collect(originalMessage, ...types) {\n        const collector = new MessageCollector(this, originalMessage, ...types);\n        this._collectors.push(collector);\n        return collector;\n    }\n    /** @private */\n    stopCollect(collector) {\n        this._collectors.splice(this._collectors.findIndex(value => value === collector), 1);\n    }\n    // convenience methods\n    join(channel, key) {\n        this.sendMessage(ChannelJoin, { channel, key });\n    }\n    part(channel) {\n        this.sendMessage(ChannelPart, { channel });\n    }\n    quit(text) {\n        this.sendMessage(ClientQuit, { text });\n        this.quitAbruptly();\n    }\n    quitAbruptly() {\n        this._registered = false;\n        this._connection.disconnect();\n    }\n    say(target, text, tags = {}) {\n        this.sendMessage(PrivateMessage, { target, text }, tags);\n    }\n    sendCtcp(target, type, message) {\n        this.say(target, `\\x01${type.toUpperCase()} ${message}\\x01`);\n    }\n    action(target, message) {\n        this.sendCtcp(target, 'ACTION', message);\n    }\n    changeNick(newNick) {\n        if (this._currentNick === newNick) {\n            return;\n        }\n        this._desiredNick = newNick;\n        if (this.isRegistered) {\n            this.sendMessage(NickChange, { nick: newNick });\n        }\n    }\n    registerCoreMessageTypes() {\n        forEachObjectEntry(MessageTypes.Commands, (type) => {\n            this.registerMessageType(type);\n        });\n        forEachObjectEntry(MessageTypes.Numerics, (type) => {\n            this.registerMessageType(type);\n        });\n    }\n    async _negotiateCapabilityBatch(capabilities) {\n        return await Promise.all(capabilities\n            .filter(list => list.length)\n            .map(async (capList) => await this._negotiateCapabilities(capList)));\n    }\n    async _negotiateCapabilities(capList) {\n        const mappedCapList = arrayToObject(capList, cap => ({\n            [cap.name]: cap\n        }));\n        const messages = await this.sendMessageAndCaptureReply(CapabilityNegotiation, {\n            subCommand: 'REQ',\n            capabilities: capList.map(cap => cap.name).join(' ')\n        });\n        const capReply = messages.shift();\n        if (!capReply) {\n            throw new Error('capability negotiation failed unexpectedly without any reply');\n        }\n        if (!(capReply instanceof CapabilityNegotiation)) {\n            throw new Error(`capability negotiation failed unexpectedly with \"${capReply.command}\" command`);\n        }\n        const negotiatedCapNames = capReply.capabilities.split(' ').filter(c => c);\n        if (capReply.subCommand === 'ACK') {\n            // filter is necessary because some networks seem to add trailing spaces...\n            this._logger.debug(`Successfully negotiated capabilities: ${negotiatedCapNames.join(', ')}`);\n            const newNegotiatedCaps = negotiatedCapNames.map(capName => mappedCapList[capName]);\n            for (const newCap of newNegotiatedCaps) {\n                const mergedCap = this._clientCapabilities.get(newCap.name);\n                mergedCap.param = newCap.param;\n                this._negotiatedCapabilities.set(mergedCap.name, mergedCap);\n            }\n            return newNegotiatedCaps;\n        }\n        else {\n            this._logger.warn(`Failed to negotiate capabilities: ${negotiatedCapNames.join(', ')}`);\n            return new Error('capabilities failed to negotiate');\n        }\n    }\n    _setupConnection() {\n        if (this._initialConnectionSetupDone) {\n            return;\n        }\n        this._connection.onConnect(async () => {\n            var _a, _b;\n            this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`);\n            this.emit(this.onConnect);\n            this._logger.debug('Determining connection password');\n            try {\n                const [password] = await Promise.all([\n                    resolveConfigValue(this._options.credentials.password),\n                    this.sendMessageAndCaptureReply(CapabilityNegotiation, {\n                        subCommand: 'LS',\n                        version: '302'\n                    })\n                        .then((capReply) => {\n                        if (!capReply.length || !(capReply[0] instanceof CapabilityNegotiation)) {\n                            this._logger.debug('Server does not support capabilities');\n                            return [];\n                        }\n                        this._supportsCapabilities = true;\n                        const capLists = capReply.map(line => arrayToObject(line.capabilities.split(' '), (part) => {\n                            if (!part) {\n                                return {};\n                            }\n                            const [cap, param] = splitWithLimit(part, '=', 2);\n                            return {\n                                [cap]: {\n                                    name: cap,\n                                    param: param || true\n                                }\n                            };\n                        }));\n                        this._serverCapabilities = new Map(Object.entries(Object.assign({}, ...capLists)));\n                        this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(', ')}`);\n                        const capabilitiesToNegotiate = capLists.map(list => {\n                            const capNames = Object.keys(list);\n                            return Array.from(this._clientCapabilities.entries())\n                                .filter(([name]) => capNames.includes(name))\n                                .map(([, cap]) => cap);\n                        });\n                        return this._negotiateCapabilityBatch(capabilitiesToNegotiate);\n                    })\n                        .then(() => {\n                        this.sendMessage(CapabilityNegotiation, { subCommand: 'END' });\n                    })\n                ]);\n                if (password) {\n                    this.sendMessage(Password, { password });\n                }\n                this.sendMessage(NickChange, { nick: this._desiredNick });\n                this.sendMessage(UserRegistration, {\n                    user: (_a = this._userName) !== null && _a !== void 0 ? _a : this._desiredNick,\n                    mode: '8',\n                    unused: '*',\n                    realName: (_b = this._realName) !== null && _b !== void 0 ? _b : this._desiredNick\n                });\n            }\n            catch (e) {\n                this.emit(this.onPasswordError, e);\n                this.quit();\n            }\n        });\n        this._initialConnectionSetupDone = true;\n        this._connection.onReceive((line) => {\n            this.receiveLine(line);\n        });\n        this._connection.onDisconnect((manually, reason) => {\n            var _a;\n            this._registered = false;\n            if (this._pingCheckTimer) {\n                clearTimeout(this._pingCheckTimer);\n            }\n            if (this._pingTimeoutTimer) {\n                clearTimeout(this._pingTimeoutTimer);\n            }\n            if (manually) {\n                this._logger.info('Disconnected');\n            }\n            else {\n                const willReconnect = (_a = this._options.connection.reconnect) !== null && _a !== void 0 ? _a : true;\n                const message = reason ? `Disconnected unexpectedly: ${reason.message}` : 'Disconnected unexpectedly';\n                if (willReconnect) {\n                    this._logger.warn(`${message}; trying to reconnect`);\n                }\n                else {\n                    this._logger.error(message);\n                }\n            }\n            this.emit(this.onDisconnect, manually, reason);\n        });\n        this._connection.onEnd(manually => {\n            if (!manually) {\n                this._logger.warn('No further retries will be made');\n            }\n        });\n    }\n    _handleReceivedClientNick(me) {\n        if (this._currentNick !== me) {\n            if (this._currentNick !== '') {\n                this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${me}`);\n            }\n            this._currentNick = me;\n        }\n    }\n    // event helper\n    _handleEvents(message) {\n        this._collectors.some(collector => collector.collect(message));\n        const handlers = this._events.get(message.constructor.COMMAND);\n        if (!handlers) {\n            return;\n        }\n        for (const handler of handlers.values()) {\n            handler(message);\n        }\n    }\n    _startPingCheckTimer() {\n        if (this._pingCheckTimer) {\n            clearTimeout(this._pingCheckTimer);\n        }\n        if (this._connection.isConnected) {\n            this._pingCheckTimer = setTimeout(() => this.pingCheck(), this._pingOnInactivity * 1000);\n        }\n        else {\n            this._pingCheckTimer = undefined;\n        }\n    }\n}\n__decorate([\n    Enumerable(false)\n], IrcClient.prototype, \"_options\", void 0);\n","export class MessageError extends Error {\n    constructor(msg) {\n        var _a;\n        super(`Received error from IRC server: ${(_a = msg.rawLine) !== null && _a !== void 0 ? _a : '[message internally built]'}`);\n        this.ircMessage = msg;\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n    }\n    get name() {\n        return this.constructor.name;\n    }\n}\n","import { Message } from 'ircv3';\nclass ClearChat extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            user: { trailing: true, optional: true }\n        });\n    }\n    get date() {\n        const timestamp = this._tags.get('tmi-sent-ts');\n        return new Date(Number(timestamp));\n    }\n    get channelId() {\n        return this._tags.get('room-id');\n    }\n    get targetUserId() {\n        var _a;\n        return (_a = this._tags.get('target-user-id')) !== null && _a !== void 0 ? _a : null;\n    }\n}\nClearChat.COMMAND = 'CLEARCHAT';\nexport { ClearChat };\n","import { Message } from 'ircv3';\n/** @private */\nclass Reconnect extends Message {\n}\nReconnect.COMMAND = 'RECONNECT';\nexport { Reconnect };\n","import { Message } from 'ircv3';\nclass RoomState extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' }\n        });\n    }\n}\nRoomState.COMMAND = 'ROOMSTATE';\nexport { RoomState };\n","function createSingleCacheKey(param) {\n    // noinspection FallThroughInSwitchStatementJS\n    switch (typeof param) {\n        case 'undefined': {\n            return '';\n        }\n        case 'object': {\n            if (param === null) {\n                return '';\n            }\n            if ('cacheKey' in param) {\n                return param.cacheKey;\n            }\n            const objKey = JSON.stringify(param);\n            if (objKey !== '{}') {\n                return objKey;\n            }\n        }\n        // fallthrough\n        default: {\n            return param.toString();\n        }\n    }\n}\nexport function createCacheKey(propName, params, prefix) {\n    return [propName, ...params.map(createSingleCacheKey)].join('/') + (prefix ? '/' : '');\n}\n","import { createCacheKey } from \"../utils/createCacheKey.mjs\";\nexport function CachedGetter(timeInSeconds = Infinity) {\n    return function (target, propName, descriptor) {\n        if (descriptor.get) {\n            // eslint-disable-next-line @typescript-eslint/unbound-method\n            const origFn = descriptor.get;\n            descriptor.get = function () {\n                const cacheKey = createCacheKey(propName, []);\n                const cachedValue = this.getFromCache(cacheKey);\n                if (cachedValue) {\n                    return cachedValue;\n                }\n                const result = origFn.call(this);\n                this.setCache(cacheKey, result, timeInSeconds);\n                return result;\n            };\n        }\n        return descriptor;\n    };\n}\n","var ChatUser_1;\nimport { __decorate } from \"tslib\";\nimport { Cacheable, CachedGetter } from '@d-fischer/cache-decorators';\nimport { Enumerable } from '@d-fischer/shared-utils';\nimport { rtfm } from '@twurple/common';\n/**\n * A user in chat.\n */\nlet ChatUser = ChatUser_1 = class ChatUser {\n    /** @internal */\n    constructor(userName, userData) {\n        this._userName = userName.toLowerCase();\n        this._userData = userData ? new Map(userData) : new Map();\n    }\n    static _parseBadgesLike(badgesLikeStr) {\n        if (!badgesLikeStr) {\n            return new Map();\n        }\n        return new Map(badgesLikeStr.split(',').map(badge => {\n            const slashIndex = badge.indexOf('/');\n            if (slashIndex === -1) {\n                return [badge, ''];\n            }\n            return [badge.slice(0, slashIndex), badge.slice(slashIndex + 1)];\n        }));\n    }\n    /**\n     * The name of the user.\n     */\n    get userName() {\n        return this._userName;\n    }\n    /**\n     * The display name of the user.\n     */\n    get displayName() {\n        var _a;\n        return (_a = this._userData.get('display-name')) !== null && _a !== void 0 ? _a : this._userName;\n    }\n    /**\n     * The color the user chose to display in chat.\n     *\n     * Returns undefined if the user didn't choose a color.\n     * In this case, you should generate your own color for this user and stick to it at least for one runtime.\n     */\n    get color() {\n        return this._userData.get('color');\n    }\n    /**\n     * The badges of the user. Returned as a map that maps the badge category to the detail.\n     */\n    get badges() {\n        const badgesStr = this._userData.get('badges');\n        return ChatUser_1._parseBadgesLike(badgesStr);\n    }\n    /**\n     * The badge info of the user. Returned as a map that maps the badge category to the detail.\n     */\n    get badgeInfo() {\n        const badgeInfoStr = this._userData.get('badge-info');\n        return ChatUser_1._parseBadgesLike(badgeInfoStr);\n    }\n    /**\n     * The ID of the user.\n     */\n    get userId() {\n        return this._userData.get('user-id');\n    }\n    /**\n     * The type of the user.\n     * Possible values are undefined, 'mod', 'global_mod', 'admin' and 'staff'.\n     */\n    get userType() {\n        return this._userData.get('user-type');\n    }\n    /**\n     * Whether the user is the broadcaster.\n     */\n    get isBroadcaster() {\n        return this.badges.has('broadcaster');\n    }\n    /**\n     * Whether the user is subscribed to the channel.\n     */\n    get isSubscriber() {\n        return this.badges.has('subscriber') || this.isFounder;\n    }\n    /**\n     * Whether the user is a Founder of the channel.\n     */\n    get isFounder() {\n        return this.badges.has('founder');\n    }\n    /**\n     * Whether the user is a moderator of the channel.\n     */\n    get isMod() {\n        return this.badges.has('moderator');\n    }\n    /**\n     * Whether the user is a VIP in the channel.\n     */\n    get isVip() {\n        return this._userData.has('vip');\n    }\n    /**\n     * Whether the user is an artist of the channel.\n     */\n    get isArtist() {\n        return this.badges.has('artist-badge');\n    }\n};\n__decorate([\n    Enumerable(false)\n], ChatUser.prototype, \"_userData\", void 0);\n__decorate([\n    CachedGetter()\n], ChatUser.prototype, \"badges\", null);\n__decorate([\n    CachedGetter()\n], ChatUser.prototype, \"badgeInfo\", null);\nChatUser = ChatUser_1 = __decorate([\n    Cacheable,\n    rtfm('chat', 'ChatUser', 'userId')\n], ChatUser);\nexport { ChatUser };\n","/**\n * Parses an emote offset string into a map that maps emote IDs to their position ranges.\n *\n * @param emotes The emote offset string.\n */\nexport function parseEmoteOffsets(emotes) {\n    if (!emotes) {\n        return new Map();\n    }\n    return new Map(emotes\n        .split('/')\n        .map(emote => {\n        const [emoteId, placements] = emote.split(':', 2);\n        if (!placements) {\n            return null;\n        }\n        return [emoteId, placements.split(',')];\n    })\n        .filter((e) => e !== null));\n}\n","import { createCacheKey } from \"../utils/createCacheKey.mjs\";\nexport function Cacheable(cls) {\n    return class extends cls {\n        constructor() {\n            super(...arguments);\n            this.cache = new Map();\n        }\n        getFromCache(cacheKey) {\n            this._cleanCache();\n            if (this.cache.has(cacheKey)) {\n                const entry = this.cache.get(cacheKey);\n                if (entry) {\n                    return entry.value;\n                }\n            }\n            return undefined;\n        }\n        setCache(cacheKey, value, timeInSeconds) {\n            this.cache.set(cacheKey, {\n                value,\n                expires: Date.now() + timeInSeconds * 1000\n            });\n        }\n        removeFromCache(cacheKey, prefix) {\n            const internalCacheKey = this._getInternalCacheKey(cacheKey, prefix);\n            if (prefix) {\n                this.cache.forEach((val, key) => {\n                    if (key.startsWith(internalCacheKey)) {\n                        this.cache.delete(key);\n                    }\n                });\n            }\n            else {\n                this.cache.delete(internalCacheKey);\n            }\n        }\n        _cleanCache() {\n            const now = Date.now();\n            this.cache.forEach((val, key) => {\n                if (val.expires < now) {\n                    this.cache.delete(key);\n                }\n            });\n        }\n        _getInternalCacheKey(cacheKey, prefix) {\n            if (typeof cacheKey === 'string') {\n                let internalCacheKey = cacheKey;\n                if (!internalCacheKey.endsWith('/')) {\n                    internalCacheKey += '/';\n                }\n                return internalCacheKey;\n            }\n            else {\n                const propName = cacheKey.shift();\n                return createCacheKey(propName, cacheKey, prefix);\n            }\n        }\n    };\n}\n","import { Message } from 'ircv3';\nimport { ChatUser } from \"../../../ChatUser.mjs\";\nimport { parseEmoteOffsets } from \"../../../utils/emoteUtil.mjs\";\nclass UserNotice extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            text: { trailing: true, optional: true }\n        });\n    }\n    get id() {\n        return this._tags.get('id');\n    }\n    get date() {\n        const timestamp = this._tags.get('tmi-sent-ts');\n        return new Date(Number(timestamp));\n    }\n    get userInfo() {\n        return new ChatUser(this._tags.get('login'), this._tags);\n    }\n    get channelId() {\n        var _a;\n        return (_a = this._tags.get('room-id')) !== null && _a !== void 0 ? _a : null;\n    }\n    get emoteOffsets() {\n        return parseEmoteOffsets(this._tags.get('emotes'));\n    }\n}\nUserNotice.COMMAND = 'USERNOTICE';\nexport { UserNotice };\n","import { Message } from 'ircv3';\n/** @private */\nclass UserState extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' }\n        });\n    }\n}\nUserState.COMMAND = 'USERSTATE';\nexport { UserState };\n","import { Message } from 'ircv3';\nimport { ChatUser } from \"../../../ChatUser.mjs\";\nimport { parseEmoteOffsets } from \"../../../utils/emoteUtil.mjs\";\n/** @private */\nclass Whisper extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            target: {},\n            text: { trailing: true }\n        });\n    }\n    get userInfo() {\n        return new ChatUser(this._prefix.nick, this._tags);\n    }\n    get emoteOffsets() {\n        return parseEmoteOffsets(this._tags.get('emotes'));\n    }\n}\nWhisper.COMMAND = 'WHISPER';\nexport { Whisper };\n","import { ClearChat } from \"./messageTypes/ClearChat.mjs\";\nimport { Reconnect } from \"./messageTypes/Reconnect.mjs\";\nimport { RoomState } from \"./messageTypes/RoomState.mjs\";\nimport { UserNotice } from \"./messageTypes/UserNotice.mjs\";\nimport { UserState } from \"./messageTypes/UserState.mjs\";\nimport { Whisper } from \"./messageTypes/Whisper.mjs\";\n/** @internal */\nexport const TwitchCommandsCapability = {\n    name: 'twitch.tv/commands',\n    messageTypes: [ClearChat, Reconnect, RoomState, UserNotice, UserState, Whisper]\n};\n","/**\n * This capability just enables standard IRC commands that Twitch chose to disable by default.\n * It has no message types on its own.\n *\n * @internal\n */\nexport const TwitchMembershipCapability = {\n    name: 'twitch.tv/membership'\n};\n","import { Message } from 'ircv3';\nclass ClearMsg extends Message {\n    constructor(command, contents, config) {\n        super(command, contents, config, {\n            channel: { type: 'channel' },\n            text: { trailing: true }\n        });\n    }\n    get date() {\n        const timestamp = this._tags.get('tmi-sent-ts');\n        return new Date(Number(timestamp));\n    }\n    get userName() {\n        return this._tags.get('login');\n    }\n    get channelId() {\n        return this._tags.get('room-id');\n    }\n    get targetMessageId() {\n        return this._tags.get('target-msg-id');\n    }\n}\nClearMsg.COMMAND = 'CLEARMSG';\nexport { ClearMsg };\n","import { Message } from 'ircv3';\n/**\n * This command has no parameters, all information is in tags.\n *\n * @private\n */\nclass GlobalUserState extends Message {\n}\nGlobalUserState.COMMAND = 'GLOBALUSERSTATE';\nexport { GlobalUserState };\n","import { ClearMsg } from \"./messageTypes/ClearMsg.mjs\";\nimport { GlobalUserState } from \"./messageTypes/GlobalUserState.mjs\";\n/**\n * This capability mostly just adds tags to existing commands.\n *\n * @internal\n */\nexport const TwitchTagsCapability = {\n    name: 'twitch.tv/tags',\n    messageTypes: [GlobalUserState, ClearMsg]\n};\n","import { __decorate } from \"tslib\";\nimport { rtfm } from '@twurple/common';\nimport { MessageTypes } from 'ircv3';\nimport { ChatUser } from \"../ChatUser.mjs\";\nimport { parseEmoteOffsets } from \"../utils/emoteUtil.mjs\";\n/**\n * A regular chat message.\n */\nlet ChatMessage = class ChatMessage extends MessageTypes.Commands.PrivateMessage {\n    /**\n     * The ID of the message.\n     */\n    get id() {\n        return this._tags.get('id');\n    }\n    /**\n     * The date the message was sent at.\n     */\n    get date() {\n        const timestamp = this._tags.get('tmi-sent-ts');\n        return new Date(Number(timestamp));\n    }\n    /**\n     * Info about the user that send the message, like their user ID and their status in the current channel.\n     */\n    get userInfo() {\n        return new ChatUser(this._prefix.nick, this._tags);\n    }\n    /**\n     * The ID of the channel the message is in.\n     */\n    get channelId() {\n        var _a;\n        return (_a = this._tags.get('room-id')) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * Whether the message is a cheer.\n     */\n    get isCheer() {\n        return this._tags.has('bits');\n    }\n    /**\n     * Whether the message represents a redemption of a custom channel points reward.\n     */\n    get isRedemption() {\n        return Boolean(this._tags.get('custom-reward-id'));\n    }\n    /**\n     * The ID of the redeemed reward, or `null` if the message does not represent a redemption.\n     */\n    get rewardId() {\n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n        return this._tags.get('custom-reward-id') || null;\n    }\n    /**\n     * Whether the message is the first message of the chatter who sent it.\n     */\n    get isFirst() {\n        return this._tags.get('first-msg') === '1';\n    }\n    /**\n     * Whether the message is sent by a returning chatter.\n     *\n     * Twitch defines this as a new viewer who has chatted at least twice in the last 30 days.\n     */\n    get isReturningChatter() {\n        return this._tags.get('returning-chatter') === '1';\n    }\n    /**\n     * Whether the message is highlighted by using channel points.\n     */\n    get isHighlight() {\n        return this._tags.get('msg-id') === 'highlighted-message';\n    }\n    /**\n     * Whether the message is a reply to another message.\n     */\n    get isReply() {\n        return this._tags.has('reply-parent-msg-id');\n    }\n    /**\n     * The ID of the message that this message is a reply to, or `null` if it's not a reply.\n     */\n    get parentMessageId() {\n        var _a;\n        return (_a = this._tags.get('reply-parent-msg-id')) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The text of the message that this message is a reply to, or `null` if it's not a reply.\n     */\n    get parentMessageText() {\n        var _a;\n        return (_a = this._tags.get('reply-parent-msg-body')) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The ID of the user that wrote the message that this message is a reply to, or `null` if it's not a reply.\n     */\n    get parentMessageUserId() {\n        var _a;\n        return (_a = this._tags.get('reply-parent-user-id')) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The name of the user that wrote the message that this message is a reply to, or `null` if it's not a reply.\n     */\n    get parentMessageUserName() {\n        var _a;\n        return (_a = this._tags.get('reply-parent-user-login')) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The display name of the user that wrote the message that this message is a reply to, or `null` if it's not a reply.\n     */\n    get parentMessageUserDisplayName() {\n        var _a;\n        return (_a = this._tags.get('reply-parent-display-name')) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * The number of bits cheered with the message.\n     */\n    get bits() {\n        var _a;\n        return Number((_a = this._tags.get('bits')) !== null && _a !== void 0 ? _a : 0);\n    }\n    /**\n     * The offsets of emote usages in the message.\n     */\n    get emoteOffsets() {\n        return parseEmoteOffsets(this._tags.get('emotes'));\n    }\n};\nChatMessage = __decorate([\n    rtfm('chat', 'ChatMessage', 'id')\n], ChatMessage);\nexport { ChatMessage };\n","import { decodeCtcp, MessageTypes, parseMessage } from 'ircv3';\nimport { ClearChat } from \"../caps/twitchCommands/messageTypes/ClearChat.mjs\";\nimport { Reconnect } from \"../caps/twitchCommands/messageTypes/Reconnect.mjs\";\nimport { RoomState } from \"../caps/twitchCommands/messageTypes/RoomState.mjs\";\nimport { UserNotice } from \"../caps/twitchCommands/messageTypes/UserNotice.mjs\";\nimport { UserState } from \"../caps/twitchCommands/messageTypes/UserState.mjs\";\nimport { Whisper } from \"../caps/twitchCommands/messageTypes/Whisper.mjs\";\nimport { ClearMsg } from \"../caps/twitchTags/messageTypes/ClearMsg.mjs\";\nimport { GlobalUserState } from \"../caps/twitchTags/messageTypes/GlobalUserState.mjs\";\nimport { ChatMessage } from \"../commands/ChatMessage.mjs\";\nlet twitchMessageTypesCache = null;\nfunction getTwitchMessageTypes() {\n    return (twitchMessageTypesCache !== null && twitchMessageTypesCache !== void 0 ? twitchMessageTypesCache : (twitchMessageTypesCache = new Map([\n        // standard types used by Twitch\n        ['PRIVMSG', ChatMessage],\n        ['NOTICE', MessageTypes.Commands.Notice],\n        ['PING', MessageTypes.Commands.Ping],\n        ['PONG', MessageTypes.Commands.Pong],\n        ['JOIN', MessageTypes.Commands.ChannelJoin],\n        ['PART', MessageTypes.Commands.ChannelPart],\n        ['NICK', MessageTypes.Commands.NickChange],\n        ['PASS', MessageTypes.Commands.Password],\n        ['CAP', MessageTypes.Commands.CapabilityNegotiation],\n        ['001', MessageTypes.Numerics.Reply001Welcome],\n        ['002', MessageTypes.Numerics.Reply002YourHost],\n        ['003', MessageTypes.Numerics.Reply003Created],\n        // 004 intentionally left out because not standards-conforming\n        ['353', MessageTypes.Numerics.Reply353NamesReply],\n        ['366', MessageTypes.Numerics.Reply366EndOfNames],\n        ['372', MessageTypes.Numerics.Reply372Motd],\n        ['375', MessageTypes.Numerics.Reply375MotdStart],\n        ['376', MessageTypes.Numerics.Reply376EndOfMotd],\n        // Twitch extensions\n        ['CLEARCHAT', ClearChat],\n        ['USERSTATE', UserState],\n        ['GLOBALUSERSTATE', GlobalUserState],\n        ['WHISPER', Whisper],\n        ['ROOMSTATE', RoomState],\n        ['RECONNECT', Reconnect],\n        ['USERNOTICE', UserNotice],\n        ['CLEARMSG', ClearMsg]\n    ])));\n}\n/**\n * Parses a raw message from Twitch into a message object.\n *\n * @param rawLine The raw message line.\n */\nexport function parseTwitchMessage(rawLine) {\n    return parseMessage(rawLine, undefined, getTwitchMessageTypes(), true);\n}\nexport function splitOnSpaces(text, maxMsgLength) {\n    if (text.length <= maxMsgLength) {\n        return [text];\n    }\n    text = text.trim();\n    const res = [];\n    let startIndex = 0;\n    let endIndex = maxMsgLength;\n    while (startIndex < text.length) {\n        let spaceIndex = text.lastIndexOf(' ', endIndex);\n        if (spaceIndex === -1 || spaceIndex <= startIndex || text.length - startIndex + 1 <= maxMsgLength) {\n            spaceIndex = startIndex + maxMsgLength;\n        }\n        const textSlice = text.slice(startIndex, spaceIndex).trim();\n        if (textSlice.length) {\n            res.push(textSlice);\n        }\n        startIndex = spaceIndex + (text[spaceIndex] === ' ' ? 1 : 0); // to skip the space\n        endIndex = startIndex + maxMsgLength;\n    }\n    return res;\n}\n/**\n * Extracts the text to show from a message parameter.\n *\n * @param message The message parameter to extract the text from.\n *\n * You would usually get this using `msg.params.message` on a message object.\n */\nexport function extractMessageText(message) {\n    const ctcp = decodeCtcp(message);\n    if (ctcp && ctcp.command === 'ACTION') {\n        return ctcp.params;\n    }\n    return message;\n}\n","// valid names must be alphanumberic or underscores between 1 and 25 characters (cannot start with underscore)\nconst validNames = /^[a-z0-9][a-z0-9_]{0,24}$/;\n/**\n * Converts a chat-compatible channel name to an API-compatible username.\n *\n * @param channel The name of the channel.\n */\nexport function toUserName(channel) {\n    // it's okay if this is already a username, we only remove the first character if it's a pound\n    const name = channel.replace(/^#/, '').toLowerCase();\n    if (!validNames.test(name)) {\n        throw new Error(`\"${name}\" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);\n    }\n    return name;\n}\n/**\n * Converts an API-compatible username to a chat-compatible channel name.\n *\n * @param user The name of the user.\n */\nexport function toChannelName(user) {\n    // remove leading pound first - in case it already is a channel name\n    return `#${toUserName(user)}`;\n}\n","var ChatClient_1;\nimport { __decorate } from \"tslib\";\nimport { createLogger, LogLevel } from '@d-fischer/logger';\nimport { PartitionedTimeBasedRateLimiter, TimeBasedRateLimiter, TimedPassthruRateLimiter } from '@d-fischer/rate-limiter';\nimport { delay, Enumerable, fibWithLimit, promiseWithResolvers, resolveConfigValue } from '@d-fischer/shared-utils';\nimport { EventEmitter } from '@d-fischer/typed-event-emitter';\nimport { accessTokenIsExpired, getTokenInfo, InvalidTokenError, InvalidTokenTypeError, RefreshingAuthProvider } from '@twurple/auth';\nimport { rtfm } from '@twurple/common';\nimport { IrcClient, MessageTypes } from 'ircv3';\nimport { TwitchCommandsCapability } from \"./caps/twitchCommands/index.mjs\";\nimport { ClearChat } from \"./caps/twitchCommands/messageTypes/ClearChat.mjs\";\nimport { RoomState } from \"./caps/twitchCommands/messageTypes/RoomState.mjs\";\nimport { UserNotice } from \"./caps/twitchCommands/messageTypes/UserNotice.mjs\";\nimport { Whisper } from \"./caps/twitchCommands/messageTypes/Whisper.mjs\";\nimport { TwitchMembershipCapability } from \"./caps/TwitchMembershipCapability.mjs\";\nimport { TwitchTagsCapability } from \"./caps/twitchTags/index.mjs\";\nimport { ClearMsg } from \"./caps/twitchTags/messageTypes/ClearMsg.mjs\";\nimport { extractMessageId } from \"./ChatMessageAttributes.mjs\";\nimport { ChatMessage } from \"./commands/ChatMessage.mjs\";\nimport { splitOnSpaces } from \"./utils/messageUtil.mjs\";\nimport { toChannelName, toUserName } from \"./utils/userUtil.mjs\";\n/**\n * An interface to Twitch chat.\n */\nlet ChatClient = ChatClient_1 = class ChatClient extends EventEmitter {\n    /**\n     * Creates a new Twitch chat client.\n     *\n     * @expandParams\n     *\n     * @param config\n     */\n    constructor(config = {}) {\n        var _a, _b, _c, _d, _e;\n        if (config.authProvider && !config.authProvider.getAccessTokenForIntent) {\n            throw new InvalidTokenTypeError('You can not connect to chat using an AuthProvider that does not support intents.\\n' +\n                \"To get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\\n\" +\n                'To get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.');\n        }\n        super();\n        this._authVerified = false;\n        this._authRetryCount = 0;\n        /**\n         * Fires when the client successfully connects to the chat server.\n         *\n         * @eventListener\n         */\n        this.onConnect = this.registerEvent();\n        /**\n         * Fires when the client disconnects from the chat server.\n         *\n         * @eventListener\n         * @param manually Whether the disconnect was requested by the user.\n         * @param reason The error that caused the disconnect, or `undefined` if there was no error.\n         */\n        this.onDisconnect = this.registerEvent();\n        /**\n         * Fires when a user is timed out from a channel.\n         *\n         * @eventListener\n         * @param channel The channel the user is timed out from.\n         * @param user The timed out user.\n         * @param duration The duration of the timeout, in seconds.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onTimeout = this.registerEvent();\n        /**\n         * Fires when a user is permanently banned from a channel.\n         *\n         * @eventListener\n         * @param channel The channel the user is banned from.\n         * @param user The banned user.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onBan = this.registerEvent();\n        /**\n         * Fires when a user upgrades their bits badge in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where the bits badge was upgraded.\n         * @param user The user that has upgraded their bits badge.\n         * @param ritualInfo Additional information about the upgrade.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onBitsBadgeUpgrade = this.registerEvent();\n        /**\n         * Fires when the chat of a channel is cleared.\n         *\n         * @eventListener\n         * @param channel The channel whose chat is cleared.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onChatClear = this.registerEvent();\n        /**\n         * Fires when emote-only mode is toggled in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where emote-only mode is being toggled.\n         * @param enabled Whether emote-only mode is being enabled. If false, it's being disabled.\n         */\n        this.onEmoteOnly = this.registerEvent();\n        /**\n         * Fires when followers-only mode is toggled in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where followers-only mode is being toggled.\n         * @param enabled Whether followers-only mode is being enabled. If false, it's being disabled.\n         * @param delay The time (in minutes) a user needs to follow the channel to be able to talk. Only available when `enabled === true`.\n         */\n        this.onFollowersOnly = this.registerEvent();\n        /**\n         * Fires when a user joins a channel.\n         *\n         * The join/part events are cached by the Twitch chat server and will be batched and sent every 30-60 seconds.\n         *\n         * Please note that unless you enabled the `requestMembershipEvents` option, this will only react to your own joins.\n         *\n         * @eventListener\n         * @param channel The channel that is being joined.\n         * @param user The user that joined.\n         */\n        this.onJoin = this.registerEvent();\n        /**\n         * Fires when you fail to join a channel.\n         *\n         * @eventListener\n         * @param channel The channel that you tried to join.\n         * @param reason The reason for the failure.\n         */\n        this.onJoinFailure = this.registerEvent();\n        /**\n         * Fires when a user leaves (\"parts\") a channel.\n         *\n         * The join/part events are cached by the Twitch chat server and will be batched and sent every 30-60 seconds.\n         *\n         * Please note that unless you enabled the `requestMembershipEvents` option, this will only react to your own parts.\n         *\n         * @eventListener\n         * @param channel The channel that is being left.\n         * @param user The user that left.\n         */\n        this.onPart = this.registerEvent();\n        /**\n         * Fires when a single message is removed from a channel.\n         *\n         * @eventListener\n         * @param channel The channel where the message was removed.\n         * @param messageId The ID of the message that was removed.\n         * @param msg The full message object containing all message and user information.\n         *\n         * This is *not* the message that was removed. The text of the message is available using `msg.params.message` though.\n         */\n        this.onMessageRemove = this.registerEvent();\n        /**\n         * Fires when unique chat mode is toggled in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where unique chat mode is being toggled.\n         * @param enabled Whether unique chat mode is being enabled. If false, it's being disabled.\n         */\n        this.onUniqueChat = this.registerEvent();\n        /**\n         * Fires when a user raids a channel.\n         *\n         * @eventListener\n         * @param channel The channel that was raided.\n         * @param user The user that has raided the channel.\n         * @param raidInfo Additional information about the raid.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onRaid = this.registerEvent();\n        /**\n         * Fires when a user cancels a raid.\n         *\n         * @eventListener\n         * @param channel The channel where the raid was cancelled.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onRaidCancel = this.registerEvent();\n        /**\n         * Fires when a user performs a \"ritual\" in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where the ritual was performed.\n         * @param user The user that has performed the ritual.\n         * @param ritualInfo Additional information about the ritual.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onRitual = this.registerEvent();\n        /**\n         * Fires when slow mode is toggled in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where slow mode is being toggled.\n         * @param enabled Whether slow mode is being enabled. If false, it's being disabled.\n         * @param delay The time (in seconds) a user has to wait between sending messages. Only set when enabling slow mode.\n         */\n        this.onSlow = this.registerEvent();\n        /**\n         * Fires when sub only mode is toggled in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where sub only mode is being toggled.\n         * @param enabled Whether sub only mode is being enabled. If false, it's being disabled.\n         */\n        this.onSubsOnly = this.registerEvent();\n        /**\n         * Fires when a user subscribes to a channel.\n         *\n         * @eventListener\n         * @param channel The channel that was subscribed to.\n         * @param user The subscribing user.\n         * @param subInfo Additional information about the subscription.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onSub = this.registerEvent();\n        /**\n         * Fires when a user resubscribes to a channel.\n         *\n         * @eventListener\n         * @param channel The channel that was resubscribed to.\n         * @param user The resubscribing user.\n         * @param subInfo Additional information about the resubscription.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onResub = this.registerEvent();\n        /**\n         * Fires when a user gifts a subscription to a channel to another user.\n         *\n         * Community subs also fire multiple `onSubGift` events.\n         * To prevent alert spam, check [Sub gift spam](/docs/examples/chat/sub-gift-spam).\n         *\n         * @eventListener\n         * @param channel The channel that was subscribed to.\n         * @param user The user that the subscription was gifted to. The gifting user is defined in `subInfo.gifter`.\n         * @param subInfo Additional information about the subscription.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onSubGift = this.registerEvent();\n        /**\n         * Fires when a user gifts random subscriptions to the community of a channel.\n         *\n         * Community subs also fire multiple `onSubGift` events.\n         * To prevent alert spam, check [Sub gift spam](/docs/examples/chat/sub-gift-spam).\n         *\n         * @eventListener\n         * @param channel The channel that was subscribed to.\n         * @param user The gifting user.\n         * @param subInfo Additional information about the community subscription.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onCommunitySub = this.registerEvent();\n        /**\n         * Fires when a user extends their subscription using a Sub Token.\n         *\n         * @eventListener\n         * @param channel The channel where the subscription was extended.\n         * @param user The user that extended their subscription.\n         * @param subInfo Additional information about the subscription extension.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onSubExtend = this.registerEvent();\n        /**\n         * Fires when a user gifts rewards during a special event.\n         *\n         * @eventListener\n         * @param channel The channel where the rewards were gifted.\n         * @param user The user that gifted the rewards.\n         * @param rewardGiftInfo Additional information about the reward gift.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onRewardGift = this.registerEvent();\n        /**\n         * Fires when a user upgrades their Prime subscription to a paid subscription in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where the subscription was upgraded.\n         * @param user The user that upgraded their subscription.\n         * @param subInfo Additional information about the subscription upgrade.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onPrimePaidUpgrade = this.registerEvent();\n        /**\n         * Fires when a user upgrades their gift subscription to a paid subscription in a channel.\n         *\n         * @eventListener\n         * @param channel The channel where the subscription was upgraded.\n         * @param user The user that upgraded their subscription.\n         * @param subInfo Additional information about the subscription upgrade.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onGiftPaidUpgrade = this.registerEvent();\n        /**\n         * Fires when a user gifts a Twitch Prime benefit to the channel.\n         *\n         * @eventListener\n         * @param channel The channel where the benefit was gifted.\n         * @param user The user that received the gift.\n         *\n         * **WARNING:** This is a *display name* and thus will not work as an identifier for the API (login) in some cases.\n         * @param subInfo Additional information about the gift.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onPrimeCommunityGift = this.registerEvent();\n        /**\n         * Fires when a user pays forward a subscription that was gifted to them to a specific user.\n         *\n         * @eventListener\n         * @param channel The channel where the gift was forwarded.\n         * @param user The user that forwarded the gift.\n         * @param forwardInfo Additional information about the gift.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onStandardPayForward = this.registerEvent();\n        /**\n         * Fires when a user pays forward a subscription that was gifted to them to the community.\n         *\n         * @eventListener\n         * @param channel The channel where the gift was forwarded.\n         * @param user The user that forwarded the gift.\n         * @param forwardInfo Additional information about the gift.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onCommunityPayForward = this.registerEvent();\n        /**\n         * Fires when a user sends an announcement (/announce) to a channel.\n         *\n         * @eventListener\n         * @param channel The channel the announcement was sent to.\n         * @param user The user that sent the announcement.\n         * @param announcementInfo Additional information about the announcement.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onAnnouncement = this.registerEvent();\n        /**\n         * Fires when receiving a whisper from another user.\n         *\n         * @eventListener\n         * @param user The user that sent the whisper.\n         * @param text The message text.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onWhisper = this.registerEvent();\n        /**\n         * Fires when you tried to execute a command you don't have sufficient permission for.\n         *\n         * @eventListener\n         * @param channel The channel that a command without sufficient permissions was executed on.\n         * @param text The message text.\n         */\n        this.onNoPermission = this.registerEvent();\n        /**\n         * Fires when a message you tried to send gets rejected by the ratelimiter.\n         *\n         * @eventListener\n         * @param channel The channel that was attempted to send to.\n         * @param text The message text.\n         */\n        this.onMessageRatelimit = this.registerEvent();\n        /**\n         * Fires when authentication succeeds.\n         *\n         * @eventListener\n         */\n        this.onAuthenticationSuccess = this.registerEvent();\n        /**\n         * Fires when authentication fails.\n         *\n         * @eventListener\n         * @param text The message text.\n         * @param retryCount The number of authentication attempts, including this one, that failed in the current attempt to connect.\n         *\n         * Resets when authentication succeeds.\n         */\n        this.onAuthenticationFailure = this.registerEvent();\n        /**\n         * Fires when fetching a token fails.\n         *\n         * @eventListener\n         * @param error The error that was thrown.\n         */\n        this.onTokenFetchFailure = this.registerEvent();\n        /**\n         * Fires when sending a message fails.\n         *\n         * @eventListener\n         * @param channel The channel that rejected the message.\n         * @param reason The reason for the failure, e.g. you're banned (msg_banned)\n         */\n        this.onMessageFailed = this.registerEvent();\n        /**\n         * Fires when a user sends a message to a channel.\n         *\n         * @eventListener\n         * @param channel The channel the message was sent to.\n         * @param user The user that sent the message.\n         * @param text The message text.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onMessage = this.registerEvent();\n        /**\n         * Fires when a user sends an action (/me) to a channel.\n         *\n         * @eventListener\n         * @param channel The channel the action was sent to.\n         * @param user The user that sent the action.\n         * @param text The action text.\n         * @param msg The full message object containing all message and user information.\n         */\n        this.onAction = this.registerEvent();\n        // internal events to resolve promises and stuff\n        this._onJoinResult = this.registerInternalEvent();\n        this._ircClient = new IrcClient({\n            connection: {\n                hostName: (_a = config.hostName) !== null && _a !== void 0 ? _a : (((_b = config.webSocket) !== null && _b !== void 0 ? _b : true) ? 'irc-ws.chat.twitch.tv' : 'irc.chat.twitch.tv'),\n                secure: (_c = config.ssl) !== null && _c !== void 0 ? _c : true\n            },\n            credentials: {\n                nick: '',\n                password: async () => await this._getAuthToken()\n            },\n            webSocket: (_d = config.webSocket) !== null && _d !== void 0 ? _d : true,\n            connectionOptions: config.connectionOptions,\n            logger: {\n                name: 'twurple:chat:irc',\n                ...config.logger\n            },\n            nonConformingCommands: ['004'],\n            manuallyAcknowledgeJoins: true,\n            rejoinChannelsOnReconnect: config.rejoinChannelsOnReconnect\n        });\n        this._ircClient.onDisconnect((manually, reason) => {\n            this._messageRateLimiter.clear();\n            this._messageRateLimiter.pause();\n            this._joinRateLimiter.clear();\n            this._joinRateLimiter.pause();\n            this.emit(this.onDisconnect, manually, reason);\n        });\n        this._ircClient.registerMessageType(ChatMessage);\n        this._chatLogger = createLogger({\n            name: 'twurple:chat:twitch',\n            ...config.logger\n        });\n        this._authProvider = config.authProvider;\n        this._useLegacyScopes = !!config.legacyScopes;\n        this._readOnly = !!config.readOnly;\n        this._authIntents = [...((_e = config.authIntents) !== null && _e !== void 0 ? _e : []), 'chat'];\n        const executeChatMessageRequest = async ({ type, text, channel, tags }) => {\n            if (type === 'say') {\n                this._ircClient.say(channel, text, tags);\n            }\n            else {\n                this._ircClient.action(channel, text);\n            }\n        };\n        const executeJoinRequest = async (channel) => {\n            const { promise, resolve, reject } = promiseWithResolvers();\n            // eslint-disable-next-line @typescript-eslint/init-declarations\n            let timer;\n            const e = this.addInternalListener(this._onJoinResult, (chan, state, error) => {\n                if (chan === channel) {\n                    clearTimeout(timer);\n                    if (error) {\n                        // TODO\n                        reject(error);\n                    }\n                    else {\n                        resolve();\n                    }\n                    this.removeListener(e);\n                }\n            });\n            timer = setTimeout(() => {\n                this.removeListener(e);\n                this.emit(this._onJoinResult, channel, undefined, 'twurple_timeout');\n                reject(new Error(`Did not receive a reply to join ${channel} in time; assuming that the join failed`));\n            }, 10000);\n            this._ircClient.join(channel);\n            await promise;\n        };\n        if (config.isAlwaysMod) {\n            this._messageRateLimiter = new TimeBasedRateLimiter({\n                bucketSize: config.botLevel === 'verified' ? 7500 : 100,\n                timeFrame: 32000,\n                doRequest: executeChatMessageRequest\n            });\n        }\n        else {\n            let bucketSize = 20;\n            if (config.botLevel === 'verified') {\n                bucketSize = 7500;\n            }\n            else if (config.botLevel === 'known') {\n                bucketSize = 50;\n            }\n            this._messageRateLimiter = new TimedPassthruRateLimiter(new PartitionedTimeBasedRateLimiter({\n                bucketSize: 1,\n                timeFrame: 1200,\n                logger: { minLevel: LogLevel.ERROR },\n                doRequest: executeChatMessageRequest,\n                getPartitionKey: ({ channel }) => channel\n            }), { bucketSize, timeFrame: 32000 });\n        }\n        this._joinRateLimiter = new TimeBasedRateLimiter({\n            bucketSize: config.botLevel === 'verified' ? 2000 : 20,\n            timeFrame: 11000,\n            doRequest: executeJoinRequest\n        });\n        this._messageRateLimiter.pause();\n        this._joinRateLimiter.pause();\n        this._ircClient.addCapability(TwitchTagsCapability);\n        this._ircClient.addCapability(TwitchCommandsCapability);\n        if (config.requestMembershipEvents) {\n            this._ircClient.addCapability(TwitchMembershipCapability);\n        }\n        this._ircClient.onConnect(() => {\n            this.emit(this.onConnect);\n        });\n        this._ircClient.onRegister(async () => {\n            this._messageRateLimiter.resume();\n            this._joinRateLimiter.resume();\n            this._authVerified = true;\n            this._authRetryTimer = undefined;\n            this._authRetryCount = 0;\n            this.emit(this.onAuthenticationSuccess);\n            const resolvedChannels = await resolveConfigValue(config.channels);\n            if (resolvedChannels) {\n                await Promise.all(resolvedChannels.map(async (channel) => {\n                    var _a;\n                    try {\n                        await this.join(channel);\n                    }\n                    catch (e) {\n                        this._chatLogger.warn(\n                        // TODO this error should always throw an Error instance,\n                        //  currently it sometimes rejects with a string\n                        `Failed to join configured channel ${channel}; original message: ${(_a = e === null || e === void 0 ? void 0 : e.message) !== null && _a !== void 0 ? _a : e}`);\n                    }\n                }));\n            }\n        });\n        this._ircClient.onPasswordError(e => {\n            this._chatLogger.error(`Error fetching a token for connecting to the server: ${e.message}`);\n            this.emit(this.onTokenFetchFailure, e);\n        });\n        this._ircClient.onPrivmsg((channel, user, text, msg) => {\n            if (user !== 'jtv') {\n                this.emit(this.onMessage, toUserName(channel), user, text, msg);\n            }\n        });\n        this._ircClient.onAction((channel, user, text, msg) => {\n            this.emit(this.onAction, toUserName(channel), user, text, msg);\n        });\n        this.addInternalListener(this._onJoinResult, (channel, _, error) => {\n            if (error) {\n                this.emit(this.onJoinFailure, toUserName(channel), error);\n            }\n            else {\n                this._ircClient.acknowledgeJoin(channel);\n            }\n        });\n        this._ircClient.onTypedMessage(ClearChat, msg => {\n            const { channel, user, tags } = msg;\n            const broadcasterName = toUserName(channel);\n            if (user) {\n                const duration = tags.get('ban-duration');\n                if (duration === undefined) {\n                    // ban\n                    this.emit(this.onBan, broadcasterName, user, msg);\n                }\n                else {\n                    // timeout\n                    this.emit(this.onTimeout, broadcasterName, user, Number(duration), msg);\n                }\n            }\n            else {\n                // full chat clear\n                this.emit(this.onChatClear, broadcasterName, msg);\n            }\n        });\n        this._ircClient.onTypedMessage(ClearMsg, msg => {\n            const { channel, targetMessageId } = msg;\n            this.emit(this.onMessageRemove, toUserName(channel), targetMessageId, msg);\n        });\n        this._ircClient.onTypedMessage(MessageTypes.Commands.ChannelJoin, ({ prefix, channel }) => {\n            this.emit(this.onJoin, toUserName(channel), prefix.nick);\n        });\n        this._ircClient.onTypedMessage(MessageTypes.Commands.ChannelPart, ({ prefix, channel }) => {\n            this.emit(this.onPart, toUserName(channel), prefix.nick);\n        });\n        this._ircClient.onTypedMessage(RoomState, ({ channel, tags }) => {\n            let isInitial = false;\n            if (tags.has('subs-only') && tags.has('slow')) {\n                // this is the full state - so we just successfully joined\n                this.emit(this._onJoinResult, channel, tags);\n                isInitial = true;\n            }\n            if (!isInitial) {\n                const broadcasterName = toUserName(channel);\n                if (tags.has('slow')) {\n                    const slowDelay = Number(tags.get('slow'));\n                    if (slowDelay) {\n                        this.emit(this.onSlow, broadcasterName, true, slowDelay);\n                    }\n                    else {\n                        this.emit(this.onSlow, broadcasterName, false);\n                    }\n                }\n                if (tags.has('followers-only')) {\n                    const followDelay = Number(tags.get('followers-only'));\n                    if (followDelay === -1) {\n                        this.emit(this.onFollowersOnly, broadcasterName, false);\n                    }\n                    else {\n                        this.emit(this.onFollowersOnly, broadcasterName, true, followDelay);\n                    }\n                }\n            }\n        });\n        this._ircClient.onTypedMessage(UserNotice, userNotice => {\n            const { channel, text: message, tags } = userNotice;\n            const messageType = tags.get('msg-id');\n            const broadcasterName = toUserName(channel);\n            switch (messageType) {\n                case 'sub':\n                case 'resub': {\n                    const event = messageType === 'sub' ? this.onSub : this.onResub;\n                    const plan = tags.get('msg-param-sub-plan');\n                    const streakMonths = tags.get('msg-param-streak-months');\n                    const subInfo = {\n                        userId: tags.get('user-id'),\n                        displayName: tags.get('display-name'),\n                        plan,\n                        planName: tags.get('msg-param-sub-plan-name'),\n                        isPrime: plan === 'Prime',\n                        months: Number(tags.get('msg-param-cumulative-months')),\n                        streak: streakMonths ? Number(streakMonths) : undefined,\n                        message\n                    };\n                    const wasGifted = tags.get('msg-param-was-gifted') === 'true';\n                    if (wasGifted) {\n                        const wasAnonGift = tags.get('msg-param-anon-gift') === 'true';\n                        const duration = Number(tags.get('msg-param-gift-months'));\n                        const redeemedMonth = Number(tags.get('msg-param-gift-month-being-redeemed'));\n                        if (wasAnonGift) {\n                            subInfo.originalGiftInfo = {\n                                anonymous: true,\n                                duration,\n                                redeemedMonth\n                            };\n                        }\n                        else {\n                            subInfo.originalGiftInfo = {\n                                anonymous: false,\n                                duration,\n                                redeemedMonth,\n                                userId: tags.get('msg-param-gifter-id'),\n                                userName: tags.get('msg-param-gifter-login'),\n                                userDisplayName: tags.get('msg-param-gifter-name')\n                            };\n                        }\n                    }\n                    this.emit(event, broadcasterName, tags.get('login'), subInfo, userNotice);\n                    break;\n                }\n                case 'subgift': {\n                    const plan = tags.get('msg-param-sub-plan');\n                    const gifter = tags.get('login');\n                    const isAnon = gifter === 'ananonymousgifter';\n                    const subInfo = {\n                        userId: tags.get('msg-param-recipient-id'),\n                        displayName: tags.get('msg-param-recipient-display-name'),\n                        gifter: isAnon ? undefined : gifter,\n                        gifterUserId: isAnon ? undefined : tags.get('user-id'),\n                        gifterDisplayName: isAnon ? undefined : tags.get('display-name'),\n                        gifterGiftCount: isAnon ? undefined : Number(tags.get('msg-param-sender-count')),\n                        giftDuration: Number(tags.get('msg-param-gift-months')),\n                        plan,\n                        planName: tags.get('msg-param-sub-plan-name'),\n                        isPrime: plan === 'Prime',\n                        months: Number(tags.get('msg-param-months'))\n                    };\n                    this.emit(this.onSubGift, broadcasterName, tags.get('msg-param-recipient-user-name'), subInfo, userNotice);\n                    break;\n                }\n                case 'submysterygift': {\n                    const gifter = tags.get('login');\n                    const isAnon = gifter === 'ananonymousgifter';\n                    const communitySubInfo = {\n                        gifter: isAnon ? undefined : gifter,\n                        gifterUserId: isAnon ? undefined : tags.get('user-id'),\n                        gifterDisplayName: isAnon ? undefined : tags.get('display-name'),\n                        gifterGiftCount: isAnon ? undefined : Number(tags.get('msg-param-sender-count')),\n                        count: Number(tags.get('msg-param-mass-gift-count')),\n                        plan: tags.get('msg-param-sub-plan')\n                    };\n                    this.emit(this.onCommunitySub, broadcasterName, tags.get('login'), communitySubInfo, userNotice);\n                    break;\n                }\n                case 'primepaidupgrade': {\n                    const upgradeInfo = {\n                        userId: tags.get('user-id'),\n                        displayName: tags.get('display-name'),\n                        plan: tags.get('msg-param-sub-plan')\n                    };\n                    this.emit(this.onPrimePaidUpgrade, broadcasterName, tags.get('login'), upgradeInfo, userNotice);\n                    break;\n                }\n                case 'giftpaidupgrade': {\n                    const upgradeInfo = {\n                        userId: tags.get('user-id'),\n                        displayName: tags.get('display-name'),\n                        gifter: tags.get('msg-param-sender-login'),\n                        gifterDisplayName: tags.get('msg-param-sender-name')\n                    };\n                    this.emit(this.onGiftPaidUpgrade, broadcasterName, tags.get('login'), upgradeInfo, userNotice);\n                    break;\n                }\n                case 'standardpayforward': {\n                    const wasAnon = tags.get('msg-param-prior-gifter-anonymous') === 'true';\n                    const forwardInfo = {\n                        userId: tags.get('user-id'),\n                        displayName: tags.get('display-name'),\n                        originalGifterUserId: wasAnon ? undefined : tags.get('msg-param-prior-gifter-id'),\n                        originalGifterDisplayName: wasAnon\n                            ? undefined\n                            : tags.get('msg-param-prior-gifter-display-name'),\n                        recipientUserId: tags.get('msg-param-recipient-id'),\n                        recipientDisplayName: tags.get('msg-param-recipient-display-name')\n                    };\n                    this.emit(this.onStandardPayForward, broadcasterName, tags.get('login'), forwardInfo, userNotice);\n                    break;\n                }\n                case 'communitypayforward': {\n                    const wasAnon = tags.get('msg-param-prior-gifter-anonymous') === 'true';\n                    const forwardInfo = {\n                        userId: tags.get('user-id'),\n                        displayName: tags.get('display-name'),\n                        originalGifterUserId: wasAnon ? undefined : tags.get('msg-param-prior-gifter-id'),\n                        originalGifterDisplayName: wasAnon\n                            ? undefined\n                            : tags.get('msg-param-prior-gifter-display-name')\n                    };\n                    this.emit(this.onCommunityPayForward, broadcasterName, tags.get('login'), forwardInfo, userNotice);\n                    break;\n                }\n                case 'primecommunitygiftreceived': {\n                    const giftInfo = {\n                        name: tags.get('msg-param-gift-name'),\n                        gifter: tags.get('login'),\n                        gifterDisplayName: tags.get('display-name')\n                    };\n                    this.emit(this.onPrimeCommunityGift, broadcasterName, tags.get('msg-param-recipient'), giftInfo, userNotice);\n                    break;\n                }\n                case 'raid': {\n                    const raidInfo = {\n                        displayName: tags.get('msg-param-displayName'),\n                        viewerCount: Number(tags.get('msg-param-viewerCount'))\n                    };\n                    this.emit(this.onRaid, broadcasterName, tags.get('login'), raidInfo, userNotice);\n                    break;\n                }\n                case 'unraid': {\n                    this.emit(this.onRaidCancel, broadcasterName, userNotice);\n                    break;\n                }\n                case 'ritual': {\n                    const ritualInfo = {\n                        ritualName: tags.get('msg-param-ritual-name'),\n                        message\n                    };\n                    this.emit(this.onRitual, broadcasterName, tags.get('login'), ritualInfo, userNotice);\n                    break;\n                }\n                case 'bitsbadgetier': {\n                    const badgeUpgradeInfo = {\n                        displayName: tags.get('display-name'),\n                        threshold: Number(tags.get('msg-param-threshold'))\n                    };\n                    this.emit(this.onBitsBadgeUpgrade, broadcasterName, tags.get('login'), badgeUpgradeInfo, userNotice);\n                    break;\n                }\n                case 'extendsub': {\n                    const extendInfo = {\n                        userId: tags.get('user-id'),\n                        displayName: tags.get('display-name'),\n                        plan: tags.get('msg-param-sub-plan'),\n                        months: Number(tags.get('msg-param-cumulative-months')),\n                        endMonth: Number(tags.get('msg-param-sub-benefit-end-month'))\n                    };\n                    this.emit(this.onSubExtend, broadcasterName, tags.get('login'), extendInfo, userNotice);\n                    break;\n                }\n                case 'rewardgift': {\n                    const rewardGiftInfo = {\n                        domain: tags.get('msg-param-domain'),\n                        gifterId: tags.get('user-id'),\n                        gifterDisplayName: tags.get('display-name'),\n                        count: Number(tags.get('msg-param-selected-count')),\n                        gifterGiftCount: Number(tags.get('msg-param-total-reward-count')),\n                        triggerType: tags.get('msg-param-trigger-type')\n                    };\n                    this.emit(this.onRewardGift, broadcasterName, tags.get('login'), rewardGiftInfo, userNotice);\n                    break;\n                }\n                case 'announcement': {\n                    const announcementInfo = {\n                        color: tags.get('msg-param-color')\n                    };\n                    this.emit(this.onAnnouncement, broadcasterName, tags.get('login'), announcementInfo, userNotice);\n                    break;\n                }\n                default: {\n                    this._chatLogger.warn(`Unrecognized usernotice ID: ${messageType}`);\n                }\n            }\n        });\n        this._ircClient.onTypedMessage(Whisper, whisper => {\n            this.emit(this.onWhisper, whisper.prefix.nick, whisper.text, whisper);\n        });\n        this._ircClient.onTypedMessage(MessageTypes.Commands.Notice, async ({ target: channel, text, tags }) => {\n            const messageType = tags.get('msg-id');\n            switch (messageType) {\n                // emote only\n                case 'emote_only_on': {\n                    this.emit(this.onEmoteOnly, toUserName(channel), true);\n                    break;\n                }\n                case 'emote_only_off': {\n                    this.emit(this.onEmoteOnly, toUserName(channel), false);\n                    break;\n                }\n                // join (success is handled when ROOMSTATE comes in)\n                case 'msg_channel_suspended':\n                case 'msg_banned': {\n                    this.emit(this._onJoinResult, channel, undefined, messageType);\n                    break;\n                }\n                // unique chat\n                case 'r9k_on': {\n                    this.emit(this.onUniqueChat, toUserName(channel), true);\n                    break;\n                }\n                case 'r9k_off': {\n                    this.emit(this.onUniqueChat, toUserName(channel), false);\n                    break;\n                }\n                // subs only\n                case 'subs_on': {\n                    this.emit(this.onSubsOnly, toUserName(channel), true);\n                    break;\n                }\n                case 'subs_off': {\n                    this.emit(this.onSubsOnly, toUserName(channel), false);\n                    break;\n                }\n                case 'cmds_available': {\n                    // do we really care?\n                    break;\n                }\n                // there's other messages that show us the following things...\n                // ...like ROOMSTATE...\n                case 'followers_on':\n                case 'followers_on_zero':\n                case 'followers_off':\n                case 'slow_on':\n                case 'slow_off': {\n                    break;\n                }\n                // ...and CLEARCHAT...\n                case 'timeout_success': {\n                    break;\n                }\n                case 'unrecognized_cmd': {\n                    break;\n                }\n                case 'no_permission': {\n                    this.emit(this.onNoPermission, toUserName(channel), text);\n                    break;\n                }\n                case 'msg_ratelimit': {\n                    this.emit(this.onMessageRatelimit, toUserName(channel), text);\n                    break;\n                }\n                case 'msg_duplicate':\n                case 'msg_emoteonly':\n                case 'msg_followersonly':\n                case 'msg_followersonly_followed':\n                case 'msg_followersonly_zero':\n                case 'msg_subsonly':\n                case 'msg_slowmode':\n                case 'msg_r9k':\n                case 'msg_verified_email':\n                case 'msg_timedout':\n                case 'msg_rejected_mandatory':\n                case 'msg_channel_blocked': {\n                    this.emit(this.onMessageFailed, toUserName(channel), messageType);\n                    break;\n                }\n                case undefined: {\n                    // this might be one of these weird authentication error notices that don't have a msg-id...\n                    if (text === 'Login authentication failed' ||\n                        text === 'Improperly formatted AUTH' ||\n                        text === 'Invalid NICK') {\n                        this._authVerified = false;\n                        if (!this._authRetryTimer) {\n                            this._authRetryTimer = fibWithLimit(120);\n                            this._authRetryCount = 0;\n                        }\n                        const secs = this._authRetryTimer.next().value;\n                        const authRetries = ++this._authRetryCount;\n                        this.emit(this.onAuthenticationFailure, text, authRetries);\n                        if (secs !== 0) {\n                            this._chatLogger.info(`Retrying authentication in ${secs} seconds`);\n                        }\n                        await delay(secs * 1000);\n                        this._ircClient.reconnect();\n                    }\n                    break;\n                }\n                default: {\n                    if (!messageType.startsWith('usage_')) {\n                        this._chatLogger.warn(`Unrecognized notice ID: '${messageType}'`);\n                    }\n                }\n            }\n        });\n    }\n    /**\n     * Connects to the chat server.\n     */\n    connect() {\n        if (!this._authProvider) {\n            this._ircClient.changeNick(ChatClient_1._generateJustinfanNick());\n        }\n        this._ircClient.connect();\n    }\n    /**\n     * The underlying IRC client. Use sparingly.\n     */\n    get irc() {\n        return this._ircClient;\n    }\n    /**\n     * Whether the chat client is currently connected.\n     */\n    get isConnected() {\n        return this._ircClient.isConnected;\n    }\n    /**\n     * Whether the chat client is currently connecting.\n     */\n    get isConnecting() {\n        return this._ircClient.isConnecting;\n    }\n    /**\n     * The channels the client is currently in.\n     */\n    get currentChannels() {\n        return this._ircClient.currentChannels;\n    }\n    /**\n     * Sends a regular chat message to a channel.\n     *\n     * @param channel The channel to send the message to.\n     * @param text The message to send.\n     * @param attributes The attributes to add to the message.\n     * @param rateLimiterOptions Options to pass to the rate limiter.\n     */\n    async say(channel, text, attributes = {}, rateLimiterOptions) {\n        const tags = {};\n        if (attributes.replyTo) {\n            tags['reply-parent-msg-id'] = extractMessageId(attributes.replyTo);\n        }\n        const texts = splitOnSpaces(text, 500);\n        await Promise.all(texts.map(async (msg) => await this._messageRateLimiter.request({\n            type: 'say',\n            channel: toChannelName(channel),\n            text: msg,\n            tags\n        }, rateLimiterOptions)));\n    }\n    /**\n     * Sends an action message (/me) to a channel.\n     *\n     * @param channel The channel to send the message to.\n     * @param text The message to send.\n     * @param rateLimiterOptions Options to pass to the rate limiter.\n     */\n    async action(channel, text, rateLimiterOptions) {\n        const texts = splitOnSpaces(text, 490);\n        await Promise.all(texts.map(async (msg) => await this._messageRateLimiter.request({\n            type: 'action',\n            channel: toChannelName(channel),\n            text: msg\n        }, rateLimiterOptions)));\n    }\n    /**\n     * Joins a channel.\n     *\n     * @param channel The channel to join.\n     */\n    async join(channel) {\n        await this._joinRateLimiter.request(toChannelName(channel));\n    }\n    /**\n     * Leaves a channel (\"part\" in IRC terms).\n     *\n     * @param channel The channel to leave.\n     */\n    part(channel) {\n        this._ircClient.part(toChannelName(channel));\n    }\n    /**\n     * Disconnects from the chat server.\n     */\n    quit() {\n        this._ircClient.quitAbruptly();\n    }\n    /**\n     * Reconnects to the chat server.\n     */\n    reconnect() {\n        this.quit();\n        this.connect();\n    }\n    async _getAuthToken() {\n        var _a, _b;\n        if (!this._authProvider) {\n            this._chatLogger.debug('No authProvider given; connecting anonymously');\n            return undefined;\n        }\n        if (this._authToken && !accessTokenIsExpired(this._authToken) && this._authVerified) {\n            this._chatLogger.debug('AccessToken assumed to be correct from last connection');\n            return `oauth:${this._authToken.accessToken}`;\n        }\n        const scopes = this._getNecessaryScopes();\n        let lastTokenError = undefined;\n        let foundSomeIntent = false;\n        for (const intent of this._authIntents) {\n            try {\n                this._authToken = await this._authProvider.getAccessTokenForIntent(intent, scopes);\n                if (!this._authToken) {\n                    continue;\n                }\n                foundSomeIntent = true;\n                const token = await getTokenInfo(this._authToken.accessToken);\n                if (!token.userName) {\n                    throw new InvalidTokenTypeError('Could not determine a user name for your token; you might be trying to disguise an app token as a user token.');\n                }\n                this._ircClient.changeNick(token.userName);\n                return `oauth:${this._authToken.accessToken}`;\n            }\n            catch (e) {\n                if (e instanceof InvalidTokenError) {\n                    lastTokenError = e;\n                }\n                else {\n                    this._chatLogger.error(`Retrieving an access token failed: ${e.message}`);\n                }\n            }\n            this._chatLogger.warn('No valid token available; trying to refresh');\n            try {\n                this._authToken = await ((_b = (_a = this._authProvider).refreshAccessTokenForIntent) === null || _b === void 0 ? void 0 : _b.call(_a, 'chat'));\n                if (this._authToken) {\n                    const token = await getTokenInfo(this._authToken.accessToken);\n                    if (!token.userName) {\n                        throw new InvalidTokenTypeError('Could not determine a user name for your token; you might be trying to disguise an app token as a user token.');\n                    }\n                    this._ircClient.changeNick(token.userName);\n                    return `oauth:${this._authToken.accessToken}`;\n                }\n            }\n            catch (e) {\n                if (e instanceof InvalidTokenError) {\n                    lastTokenError = e;\n                }\n                else {\n                    this._chatLogger.error(`Refreshing the access token failed: ${e.message}`);\n                }\n            }\n        }\n        this._authVerified = false;\n        throw (lastTokenError !== null && lastTokenError !== void 0 ? lastTokenError : new Error(foundSomeIntent\n            ? 'Could not retrieve a valid token'\n            : `None of the queried intents (${this._authIntents.join(', ')}) are known by the auth provider${this._authProvider instanceof RefreshingAuthProvider\n                ? '.\\nPlease add one of these to the user you want to connect with using the ' +\n                    '`addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.'\n                : ''}`));\n    }\n    _getNecessaryScopes() {\n        if (this._useLegacyScopes) {\n            return ['chat_login'];\n        }\n        if (this._readOnly) {\n            return ['chat:read'];\n        }\n        return ['chat:read', 'chat:edit'];\n    }\n    static _generateJustinfanNick() {\n        const randomSuffix = Math.floor(Math.random() * 100000)\n            .toString()\n            .padStart(5, '0');\n        return `justinfan${randomSuffix}`;\n    }\n};\n__decorate([\n    Enumerable(false)\n], ChatClient.prototype, \"_authProvider\", void 0);\nChatClient = ChatClient_1 = __decorate([\n    rtfm('chat', 'ChatClient')\n], ChatClient);\nexport { ChatClient };\n","import { __awaiter, __generator } from \"tslib\";\nexport function delay(ms) {\n    return __awaiter(this, void 0, Promise, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, new Promise(function (resolve) { return setTimeout(resolve, ms); })];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\n","import { ChatMessage } from \"./commands/ChatMessage.mjs\";\n/** @private */\nexport function extractMessageId(message) {\n    return message instanceof ChatMessage ? message.tags.get('id') : message;\n}\n","/** @private */\nexport class CustomError extends Error {\n    constructor(message, options) {\n        var _a;\n        super(message, options);\n        // restore prototype chain\n        Object.setPrototypeOf(this, new.target.prototype);\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        (_a = Error.captureStackTrace) === null || _a === void 0 ? void 0 : _a.call(Error, this, new.target.constructor);\n    }\n    get name() {\n        return this.constructor.name;\n    }\n}\n","import { CustomError } from \"./CustomError.mjs\";\n/**\n * These are the kind of errors that should never happen.\n *\n * If you see one thrown, please file a bug in the GitHub issue tracker.\n */\nexport class HellFreezesOverError extends CustomError {\n    constructor(message) {\n        super(`${message} - this should never happen, please file a bug in the GitHub issue tracker`);\n    }\n}\n","/** @private */\nexport function rtfm(pkg, name, idKey) {\n    return clazz => {\n        const fn = idKey\n            ? function () {\n                // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n                return `[${name}#${this[idKey]} - please check https://twurple.js.org/reference/${pkg}/classes/${name}.html for available properties]`;\n            }\n            : function () {\n                return `[${name} - please check https://twurple.js.org/reference/${pkg}/classes/${name}.html for available properties]`;\n            };\n        Object.defineProperty(clazz.prototype, Symbol.for('nodejs.util.inspect.custom'), {\n            value: fn,\n            enumerable: false\n        });\n    };\n}\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","var BasicPubSubClient_1;\nimport { __decorate } from \"tslib\";\nimport { PersistentConnection, WebSocketConnection } from '@d-fischer/connection';\nimport { createLogger } from '@d-fischer/logger';\nimport { Enumerable, promiseWithResolvers } from '@d-fischer/shared-utils';\nimport { EventEmitter } from '@d-fischer/typed-event-emitter';\nimport { getValidTokenFromProviderForUser } from '@twurple/auth';\nimport { HellFreezesOverError, rtfm } from '@twurple/common';\nimport { createListenPacket } from \"./PubSubPacket.external.mjs\";\n/**\n * A client for the Twitch PubSub interface.\n */\nlet BasicPubSubClient = BasicPubSubClient_1 = class BasicPubSubClient extends EventEmitter {\n    /**\n     * Creates a new PubSub client.\n     *\n     * @param options\n     *\n     * @expandParams\n     */\n    constructor(options) {\n        super();\n        // topic => token\n        /** @internal */ this._topics = new Map();\n        this._pingOnActivity = 240;\n        this._pingOnInactivity = 60;\n        this._pingTimeout = 10;\n        this._onPong = this.registerInternalEvent();\n        this._onResponse = this.registerInternalEvent();\n        /**\n         * Fires when a message that matches your listening topics is received.\n         *\n         * @eventListener\n         *\n         * @param topic The name of the topic.\n         * @param message The message data.\n         */\n        this.onMessage = this.registerEvent();\n        /**\n         * Fires when listening to a topic fails.\n         *\n         * @eventListener\n         *\n         * @param topic The name of the topic.\n         * @param error The error.\n         * @param userInitiated Whether the listen was directly initiated by a user.\n         *\n         * The other case would happen in cases like re-sending listen packets after a reconnect.\n         */\n        this.onListenError = this.registerEvent();\n        /**\n         * Fires when the client finishes establishing a connection to the PubSub server.\n         *\n         * @eventListener\n         */\n        this.onConnect = this.registerEvent();\n        /**\n         * Fires when the client closes its connection to the PubSub server.\n         *\n         * @eventListener\n         * @param isError Whether the cause of the disconnection was an error. A reconnect will be attempted if this is true.\n         * @param reason The error object.\n         */\n        this.onDisconnect = this.registerEvent();\n        /**\n         * Fires when the client receives a pong message from the PubSub server.\n         *\n         * @eventListener\n         * @param latency The current latency to the server, in milliseconds.\n         * @param requestTimestampe The time the ping request was sent to the PubSub server.\n         */\n        this.onPong = this.registerEvent();\n        this._logger = createLogger({\n            name: 'twurple:pubsub:basic',\n            ...options === null || options === void 0 ? void 0 : options.logger\n        });\n        this._connection = new PersistentConnection(WebSocketConnection, { hostName: 'pubsub-edge.twitch.tv', port: 443, secure: true }, { logger: this._logger, additionalOptions: { wsOptions: options === null || options === void 0 ? void 0 : options.wsOptions } });\n        this._connection.onConnect(async () => {\n            this._logger.info('Connection established');\n            this._pingCheck();\n            this._startActivityPingCheckTimer();\n            this._startInactivityPingCheckTimer();\n            this._resendListens();\n            if (this._topics.size) {\n                this._logger.info('Listened to previously registered topics');\n                this._logger.debug(`Previously registered topics: ${Array.from(this._topics.keys()).join(', ')}`);\n            }\n            this.emit(this.onConnect);\n        });\n        this._connection.onReceive((line) => {\n            this._receiveMessage(line.trim());\n            this._startInactivityPingCheckTimer();\n        });\n        this._connection.onDisconnect((manually, reason) => {\n            clearInterval(this._activityPingCheckTimer);\n            clearInterval(this._inactivityPingCheckTimer);\n            clearTimeout(this._pingTimeoutTimer);\n            this.removeInternalListener();\n            if (manually) {\n                this._logger.info('Disconnected');\n            }\n            else {\n                if (reason) {\n                    this._logger.error(`Disconnected unexpectedly: ${reason.message}`);\n                }\n                else {\n                    this._logger.error('Disconnected unexpectedly');\n                }\n            }\n            this.emit(this.onDisconnect, manually, reason);\n        });\n    }\n    /**\n     * Listens to one or more topics.\n     *\n     * @param topics A topic or a list of topics to listen to.\n     * @param tokenResolvable An access token, an AuthProvider or a function that returns a token.\n     */\n    listen(topics, tokenResolvable) {\n        const topicsArray = typeof topics === 'string' ? [topics] : topics;\n        const wrapped = BasicPubSubClient_1._wrapResolvable(tokenResolvable);\n        for (const topic of topicsArray) {\n            this._topics.set(topic, wrapped);\n        }\n        if (this.isConnected) {\n            this._resolveToken(wrapped)\n                .then(async (token) => await this._sendListen(topicsArray, token))\n                .catch(e => {\n                for (const topic of topicsArray) {\n                    this.emit(this.onListenError, topic, e, true);\n                }\n            });\n        }\n    }\n    /**\n     * Removes one or more topics from the listener.\n     *\n     * @param topics A topic or a list of topics to not listen to anymore.\n     */\n    unlisten(topics) {\n        const topicsArray = typeof topics === 'string' ? [topics] : topics;\n        for (const topic of topics) {\n            this._topics.delete(topic);\n        }\n        if (this.isConnected) {\n            this._sendUnlisten(topicsArray).catch(e => {\n                var _a;\n                this._logger.error(`Error during unlisten of topics ${topicsArray.join(', ')}: ${(_a = e === null || e === void 0 ? void 0 : e.message) !== null && _a !== void 0 ? _a : e}`);\n            });\n        }\n    }\n    /**\n     * Connects to the PubSub interface.\n     */\n    connect() {\n        if (!this._connection.isConnected && !this._connection.isConnecting) {\n            this._logger.info('Connecting...');\n            this._connection.connect();\n        }\n    }\n    /**\n     * Disconnects from the PubSub interface.\n     */\n    disconnect() {\n        this._logger.info('Disconnecting...');\n        this._connection.disconnect();\n    }\n    /**\n     * Reconnects to the PubSub interface.\n     */\n    reconnect() {\n        this.disconnect();\n        this.connect();\n    }\n    /**\n     * Checks whether the client is currently connecting to the server.\n     */\n    get isConnecting() {\n        return this._connection.isConnecting;\n    }\n    /**\n     * Checks whether the client is currently connected to the server.\n     */\n    get isConnected() {\n        return this._connection.isConnected;\n    }\n    /** @private */\n    get hasAnyTopics() {\n        return this._topics.size > 0;\n    }\n    async _sendListen(topics, accessToken) {\n        await this._sendNonced(createListenPacket(topics, accessToken));\n    }\n    async _sendUnlisten(topics) {\n        await this._sendNonced({\n            type: 'UNLISTEN',\n            data: {\n                topics\n            }\n        });\n    }\n    static _wrapResolvable(resolvable) {\n        switch (typeof resolvable) {\n            case 'object': {\n                return resolvable;\n            }\n            case 'string': {\n                return {\n                    type: 'static',\n                    token: resolvable\n                };\n            }\n            case 'function': {\n                return {\n                    type: 'function',\n                    function: resolvable\n                };\n            }\n            default: {\n                throw new HellFreezesOverError(`Passed unknown type to wrapResolvable: ${typeof resolvable}`);\n            }\n        }\n    }\n    async _resolveToken(resolvable) {\n        switch (resolvable.type) {\n            case 'provider': {\n                const { provider, scopes, userId } = resolvable;\n                const { accessToken } = await getValidTokenFromProviderForUser(provider, userId, scopes, this._logger);\n                return accessToken.accessToken;\n            }\n            case 'function': {\n                return await resolvable.function();\n            }\n            case 'static': {\n                return resolvable.token;\n            }\n            default: {\n                throw new HellFreezesOverError(`Passed unknown type to resolveToken: ${resolvable.type}`);\n            }\n        }\n    }\n    _resendListens() {\n        const topicsByTokenResolvable = new Map();\n        for (const [topic, tokenResolvable] of this._topics) {\n            if (topicsByTokenResolvable.has(tokenResolvable)) {\n                topicsByTokenResolvable.get(tokenResolvable).push(topic);\n            }\n            else {\n                topicsByTokenResolvable.set(tokenResolvable, [topic]);\n            }\n        }\n        void Array.from(topicsByTokenResolvable)\n            .reduce(\n        // eslint-disable-next-line @typescript-eslint/promise-function-async\n        (chain, [tokenResolvable, topics]) => \n        // eslint-disable-next-line @typescript-eslint/return-await\n        chain.then(async (topicsByToken) => {\n            const token = await this._resolveToken(tokenResolvable);\n            if (topicsByToken.has(token)) {\n                topicsByToken.get(token).push(...topics);\n            }\n            else {\n                topicsByToken.set(token, topics);\n            }\n            return topicsByToken;\n        }), Promise.resolve(new Map()))\n            .then(topicsByToken => {\n            for (const [token, topics] of topicsByToken) {\n                this._sendListen(topics, token).catch(e => {\n                    for (const topic of topics) {\n                        this.emit(this.onListenError, topic, e, false);\n                    }\n                });\n            }\n        });\n    }\n    async _sendNonced(packet) {\n        const { promise, resolve, reject } = promiseWithResolvers();\n        const nonce = Math.random().toString(16).slice(2);\n        const responseListener = this._onResponse((recvNonce, error) => {\n            if (recvNonce === nonce) {\n                if (error) {\n                    reject(new Error(`Error sending nonced ${packet.type} packet: ${error}`));\n                }\n                else {\n                    resolve();\n                }\n                responseListener.unbind();\n            }\n        });\n        packet.nonce = nonce;\n        this._sendPacket(packet);\n        await promise;\n    }\n    _receiveMessage(dataStr) {\n        this._logger.debug(`Received message: ${dataStr}`);\n        const data = JSON.parse(dataStr);\n        switch (data.type) {\n            case 'PONG': {\n                this.emit(this._onPong);\n                break;\n            }\n            case 'RECONNECT': {\n                this.reconnect();\n                break;\n            }\n            case 'RESPONSE': {\n                this.emit(this._onResponse, data.nonce, data.error);\n                break;\n            }\n            case 'MESSAGE': {\n                this.emit(this.onMessage, data.data.topic, JSON.parse(data.data.message));\n                break;\n            }\n            default: {\n                this._logger.warn(`PubSub connection received unexpected message type: ${data.type}`);\n            }\n        }\n    }\n    _sendPacket(data) {\n        const dataStr = JSON.stringify(data);\n        this._logger.debug(`Sending message: ${dataStr}`);\n        this._connection.sendLine(dataStr);\n    }\n    _pingCheck() {\n        const pingTime = Date.now();\n        this._onPong(() => {\n            const latency = Date.now() - pingTime;\n            this.emit(this.onPong, latency, pingTime);\n            this._logger.info(`Current latency: ${latency}ms`);\n            if (this._pingTimeoutTimer) {\n                clearTimeout(this._pingTimeoutTimer);\n            }\n            this.removeInternalListener(this._onPong);\n        });\n        this._pingTimeoutTimer = setTimeout(async () => {\n            this._logger.error('Ping timeout');\n            this.removeInternalListener(this._onPong);\n            this._connection.assumeExternalDisconnect();\n        }, this._pingTimeout * 1000);\n        this._sendPacket({ type: 'PING' });\n    }\n    _startActivityPingCheckTimer() {\n        clearInterval(this._activityPingCheckTimer);\n        if (this._connection.isConnected) {\n            this._activityPingCheckTimer = setInterval(() => {\n                this._startInactivityPingCheckTimer();\n                this._pingCheck();\n            }, this._pingOnActivity * 1000);\n        }\n        else {\n            this._activityPingCheckTimer = undefined;\n        }\n    }\n    _startInactivityPingCheckTimer() {\n        clearInterval(this._inactivityPingCheckTimer);\n        if (this._connection.isConnected) {\n            this._inactivityPingCheckTimer = setInterval(() => {\n                this._startActivityPingCheckTimer();\n                this._pingCheck();\n            }, this._pingOnInactivity * 1000);\n        }\n        else {\n            this._inactivityPingCheckTimer = undefined;\n        }\n    }\n};\n__decorate([\n    Enumerable(false)\n], BasicPubSubClient.prototype, \"_logger\", void 0);\n__decorate([\n    Enumerable(false)\n], BasicPubSubClient.prototype, \"_topics\", void 0);\nBasicPubSubClient = BasicPubSubClient_1 = __decorate([\n    rtfm('pubsub', 'BasicPubSubClient')\n], BasicPubSubClient);\nexport { BasicPubSubClient };\n","/** @internal */\nexport function createListenPacket(topics, accessToken) {\n    return {\n        type: 'LISTEN',\n        data: {\n            topics,\n            auth_token: accessToken\n        }\n    };\n}\n"],"names":["module","exports","string","TypeError","replace","String","prototype","percentTwenties","util","require","Format","RFC1738","RFC3986","assign","formatters","value","call","utils","has","Object","hasOwnProperty","isArray","Array","defaults","allowDots","allowPrototypes","arrayLimit","charset","charsetSentinel","comma","decoder","decode","delimiter","depth","ignoreQueryPrefix","interpretNumericEntities","parameterLimit","parseArrays","plainObjects","strictNullHandling","str","$0","numberStr","fromCharCode","parseInt","parseArrayValue","val","options","indexOf","split","maybeMap","fn","mapped","i","length","push","parseKeys","givenKey","valuesParsed","key","child","segment","exec","parent","slice","index","keys","chain","leaf","obj","root","concat","create","cleanRoot","charAt","isNaN","parseObject","opts","undefined","isRegExp","normalizeParseOptions","tempObj","cleanStr","limit","Infinity","parts","skipIndex","part","bracketEqualsPos","pos","encodedVal","combine","parseValues","newObj","merge","compact","formats","arrayPrefixGenerators","brackets","prefix","indices","repeat","pushToArray","arr","valueOrArray","apply","toISO","Date","toISOString","defaultFormat","addQueryPrefix","encode","encoder","encodeValuesOnly","format","formatter","serializeDate","date","skipNulls","stringify","object","generateArrayPrefix","filter","sort","v","join","isBuffer","objKeys","values","normalizeStringifyOptions","arrayFormat","joined","hexTable","array","toString","toUpperCase","arrayToObject","source","target","reduce","acc","a","b","queue","o","prop","refs","item","j","pop","compacted","compactQueue","strWithoutPlus","unescape","decodeURIComponent","e","defaultEncoder","Symbol","escape","out","c","charCodeAt","constructor","mergeTarget","forEach","targetItem","globalObject","self","window","global","Error","getGlobal","fetch","bind","Headers","Request","Response","PersistentConnection","EventEmitter","_type","_target","_config","arguments","_a","super","this","_retryLimit","_initialRetryLimit","_connecting","_connectionRetryCount","onReceive","registerEvent","onConnect","onDisconnect","onEnd","retryLimit","_logger","logger","isConnected","_b","_currentConnection","isConnecting","hasSocket","sendLine","line","connect","_tryConnect","disconnect","trace","Boolean","lastConnection","assumeExternalDisconnect","reconnect","_reconnect","acknowledgeSuccessfulReconnect","_previousConnection","_startTryingToConnect","userGenerated","_retryTimerGenerator","fibWithLimit","newConnection","resolveConfigValueSync","emit","manually","reason","_c","debug","message","secs","next","info","setTimeout","overlapManualReconnect","ws","WebSocket","MozWebSocket","AbstractConnection","lineBased","additionalOptions","_currentLine","_connected","_lineBased","_additionalOptions","sendRaw","clearSocket","receiveRaw","data","receivedLines","shift","WebSocketConnection","_socket","_closingOnDemand","hostName","port","_url","secure","url","send","wsOptions","onopen","onmessage","_ref","onerror","onclose","wasConnected","wasConnecting","wasClean","err","code","close","LogLevel","resolveLogLevel","level","eligibleLevels","map","k","Math","max","WARNING","strLevel","debugFunction","isNode","console","log","LogLevelToConsoleFunction","CRITICAL","error","ERROR","warn","INFO","DEBUG","TRACE","extendStatics","d","setPrototypeOf","__proto__","p","__extends","__","SuppressedError","process","LOGGING","namespace","_d","defaultIndex","findIndex","defaultLevel","isPrefix","every","getMinLogLevelFromEnv","name","nameSplit","_i","data_1","nsParts","splice","BaseLogger","_e","minLevel","emoji","colors","timestamps","_name","_minLevel","mapOptional","lv","_emoji","_colors","_timestamps","crit","BrowserLogger","_super","logFn","formattedMessage","CustomLoggerWrapper","custom","_override","_shouldLog","LogLevelToEmoji","black","red","green","yellow","blue","magenta","cyan","white","blackBright","redBright","greenBright","yellowBright","blueBright","magentaBright","cyanBright","whiteBright","bgColors","bgBlack","bgRed","bgGreen","bgYellow","bgBlue","bgMagenta","bgCyan","bgWhite","bgBlackBright","bgRedBright","bgGreenBright","bgYellowBright","bgBlueBright","bgMagentaBright","bgCyanBright","bgWhiteBright","createGenericWrapper","color","ending","inner","createColorWrapper","createBgWrapper","fgWrapper","LogLevelToColor","LogLevelToBackgroundColor","NodeLogger","builtMessage","stdout","isTTY","toLowerCase","createLogger","Enumerable","enumerable","defineProperty","get","set","writable","resolveConfigValue","__awaiter","Promise","__generator","label","sent","current","__read","isNullish","mapNullable","cb","promiseWithResolvers","resolve","reject","promise","_resolve","_reject","thisArg","_arguments","P","generator","fulfilled","step","rejected","result","done","then","body","f","y","t","g","_","trys","ops","verb","iterator","n","op","m","r","ar","__spreadArray","to","from","pack","l","Listener","owner","event","listener","_internal","unbind","removeListener","_eventListeners","Map","_internalEventListeners","on","_addListener","addListener","idOrEvent","_removeListener","eventBinder","handler","_len","args","_key","registerInternalEvent","addInternalListener","removeInternalListener","internal","listenerMap","id","listeners","idx","delete","clear","InvalidTokenError","CustomError","realFetch","nodeFetch","test","HttpStatusCodeError","_statusCode","statusText","_method","_body","isJson","statusCode","method","async","handleTwitchApiResponseError","response","ok","headers","text","JSON","json","params","query","fullUrl","status","transformTwitchApiResponse","parse","getTwitchApiUrl","type","callTwitchApiRaw","clientId","accessToken","authorizationType","fetchOptions","Accept","jsonBody","append","requestOptions","callTwitchApi","createExchangeCodeQuery","clientSecret","redirectUri","grant_type","client_id","client_secret","redirect_uri","createGetAppTokenQuery","createRefreshTokenQuery","refreshToken","refresh_token","rawDataSymbol","DataObject","TokenInfo","_obtainmentDate","userId","user_id","userName","login","scopes","expiryDate","expires_in","getTime","createAccessTokenFromData","access_token","scope","expiresIn","obtainmentTimestamp","now","exchangeCode","getAppToken","refreshUserToken","getTokenInfo","cause","getValidTokenFromProviderForUser","provider","lastTokenError","foundUser","getAccessTokenForUser","tokenInfo","refreshAccessTokenForUser","newToken","__decorate","rtfm","scopeEquivalencies","compareScopes","scopesToCompare","requestedScopes","Set","flatMap","scopesStr","compareScopeSets","requestedScopeSets","loadAndCompareTokenInfo","token","loadedScopes","userInfo","decorators","desc","getOwnPropertyDescriptor","Reflect","decorate","__assign","s","__values","_newTarget","_this","captureStackTrace","configurable","RateLimitReachedError","TimeBasedRateLimiter","bucketSize","timeFrame","doRequest","_queue","_usedFromBucket","_paused","_bucketSize","_timeFrame","_callback","request","req","reqSpec","limitReachedBehavior","_runRequest","pause","resume","_runNextRequest","e_1","TimedPassthruRateLimiter","config","PartitionedTimeBasedRateLimiter","getPartitionKey","_partitionedQueue","_partitionKeyCallback","partitionKey","usedFromBucket","_getPartitionedQueue","e_1_1","return","newQueue","e_2","newUsed","InvalidTokenTypeError","getExpiryMillis","accessTokenIsExpired","extractUserId","user","CachedRefreshFailureError","IntermediateUserRemovalError","UnknownIntentError","intent","TokenFetcher","executor","_newTokenScopeSets","_newTokenPromise","_queuedScopeSets","_queueExecutor","_queuePromise","_executor","scopeSets","filteredScopeSets","RefreshingAuthProvider","refreshConfig","_userAccessTokens","_userTokenFetchers","_intentToUserId","_userIdToIntents","_cachedRefreshFailures","onRefresh","onRefreshFailure","_clientId","_clientSecret","_redirectUri","_appImpliedScopes","appImpliedScopes","_appTokenFetcher","_fetchAppToken","addUser","initialToken","intents","_fetchUserToken","addIntentsToUser","tokenWithInfo","refreshedToken","tokenToAdd","addUserForToken","hasUser","removeUser","add","getIntentsForUser","removeIntents","previousTokenData","tokenData","_refreshUserTokenWithCallback","_checkIntermediateUserRemoval","getCurrentScopesForUser","fetcher","_len2","_key2","HellFreezesOverError","getAppAccessToken","_appAccessToken","previousToken","includes","_refreshAppToken","DirectConnection","splitWithLimit","delim","count","padLeft","padding","paddingStr","forEachObjectEntry","entries","klona","tmp","AwayNotifyCapability","NotEnoughParametersError","_command","_expectedParams","_actualParams","command","expectedParams","actualParams","ParameterRequirementMismatchError","_paramName","_paramSpec","_givenValue","paramName","paramSpec","givenValue","defaultServerProperties","channelTypes","supportedUserModes","supportedChannelModes","list","alwaysWithParam","paramWhenSet","noParam","prefixes","modeChar","isChannel","validTypes","re","RegExp","escapeRegexString","ctcpEscapeMap","decodeCtcp","startsWith","substring","endsWith","escapedChar","tagEscapeMap","Message","static","param","spec","serverProperties","chan","match","tags","rawLine","isServer","shouldParseParams","_params","_serverProperties","_tags","_prefix","_raw","parseParams","getMinParamCount","noServer","noClient","optional","paramCount","prefixToString","nick","host","tagsToString","includePrefix","_buildCommandFromRawParams","_buildCommandFromNamedParams","unshift","_initPrefixAndTags","requiredParamsLeft","paramSpecList","parsedParams","rest","restParams","trailing","checkParam","_parsedParams","rawParamValues","isResponseTo","originalMessage","endsResponseTo","_acceptsInReplyCollection","specKeys","COMMAND","SUPPORTS_CAPTURE","Batch","contents","reference","additionalParams","BatchCapability","messageTypes","usesTags","CapNotifyCapability","ChgHost","newUser","newHost","ChgHostCapability","InviteNotifyCapability","Acknowledgement","LabeledResponseCapability","MessageTagsCapability","MultiPrefixCapability","MessageCollector","_client","_originalMessage","_messages","_endEventHandlers","types","_types","untilEvent","eventType","_cleanEndEventHandler","end","_promise","_promiseResolve","collect","stopCollect","_cleanEndEventHandlers","Password","password","NickChange","UserRegistration","mode","unused","realName","OperLogin","ClientQuit","ServerQuit","server","ChannelJoin","channel","ChannelPart","UnknownChannelModeCharError","_char","char","Mode","modes","separate","modeRestParam","modeParams","currentModeAction","ch","thisModeAction","requiresParam","known","action","letter","Topic","newTopic","Names","ChannelList","ChannelInvite","ChannelKick","Time","PrivateMessage","Notice","WhoQuery","mask","flags","extendedMask","WhoIsQuery","nickMask","WhoWasQuery","Kill","Ping","Pong","ErrorMessage","Away","Rehash","Restart","WallopsMessage","UserHostQuery","nicks","IsOnQuery","CapabilityNegotiation","subCommand","version","continued","capabilities","trim","TagMessage","Reply001Welcome","me","welcomeText","Reply002YourHost","yourHost","Reply003Created","createdText","Reply004ServerInfo","serverName","userModes","channelModes","channelModesWithParam","Reply005Isupport","supports","suffix","Reply221UmodeIs","Reply301Away","Reply302UserHost","hosts","Reply305UnAway","Reply306NowAway","Reply311WhoisUser","username","_unused","realname","Reply315EndOfWho","Reply318EndOfWhois","Reply319WhoisChannels","channels","Reply322List","memberCount","topic","Reply323ListEnd","Reply324ChannelModeIs","Reply331NoTopic","Reply332Topic","Reply333TopicWhoTime","who","ts","Reply341Inviting","Reply348ExceptList","creatorName","timestamp","Reply349EndOfExceptList","Reply352WhoReply","hopsAndRealName","isAway","isOper","isBot","Reply353NamesReply","channelType","names","Reply366EndOfNames","Reply367BanList","Reply368EndOfBanList","Reply372Motd","Reply375MotdStart","Reply376EndOfMotd","Reply381YoureOper","Reply391Time","Error401NoSuchNick","Error402NoSuchServer","Error403NoSuchChannel","Error404CanNotSendToChan","Error405TooManyChannels","Error410InvalidCapCmd","Error421UnknownCommand","originalCommand","Error422NoMotd","Error431NoNickNameGiven","Error432ErroneusNickname","Error433NickNameInUse","Error436NickCollision","Error441UserNotInChannel","Error442NotOnChannel","Error443UserOnChannel","Error451NotRegistered","Error461NeedMoreParams","Error462AlreadyRegistered","Error471ChannelIsFull","Error472UnknownMode","Error473InviteOnlyChan","Error474BannedFromChan","Error475BadChannelKey","Error479BadChanName","Error481NoPrivileges","Error482ChanOpPrivsNeeded","Error491NoOperHost","Error501UmodeUnknownFlag","Error502UsersDontMatch","all","Commands","Numerics","cmd","parsePrefix","raw","tagUnescapeMap","parseTags","tagStrings","tagString","tagName","tagValue","IrcClient","_registered","_supportsCapabilities","_events","_registeredMessageTypes","onRegister","onPrivmsg","onAction","onNotice","onNickChange","onCtcp","onCtcpReply","onPasswordError","onAnyMessage","_supportedFeatures","_collectors","_clientCapabilities","_serverCapabilities","_negotiatedCapabilities","_currentChannels","_hasRegisteredBefore","_channelsFromLastRegister","_initialConnectionSetupDone","connection","credentials","webSocket","_options","pingOnInactivity","pingTimeout","_pingOnInactivity","_pingTimeout","_currentNick","registerCoreMessageTypes","connectionTarget","connectionOptions","ConnectionType","_connection","cap","CoreCapabilities","addCapability","hasRegisteredBefore","channelsFromLastRegister","resolvedChannels","rejoinChannelsOnReconnect","onTypedMessage","caps","capList","capNames","_negotiateCapabilities","_ref2","_ref3","_ref4","sendMessage","_ref5","_handleReceivedClientNick","_ref6","_ref7","newFeatures","support","_ref8","_ref9","_ref10","msg","ctcpMessage","newNick","oldNick","manuallyAcknowledgeJoins","_ref11","acknowledgeJoin","_startPingCheckTimer","_desiredNick","_userName","_realName","receiveLine","parsedMessage","knownCommands","coreMessageTypes","nonConformingCommands","splitLine","messageClass","parseMessage","stack","_handleEvents","pingCheck","nowStr","_pingTimeoutTimer","clearTimeout","removeMessageListener","quit","registerMessageType","cls","knowsCommand","getCommandClass","_setupConnection","messageType","onNamedMessage","commandName","handlerName","handlerList","random","createMessage","isRegistered","currentNick","currentChannels","collector","quitAbruptly","say","sendCtcp","changeNick","MessageTypes","mappedCapList","capReply","sendMessageAndCaptureReply","negotiatedCapNames","newNegotiatedCaps","capName","newCap","mergedCap","capLists","capabilitiesToNegotiate","_ref12","_ref13","_negotiateCapabilityBatch","_pingCheckTimer","willReconnect","some","handlers","MessageError","ircMessage","ClearChat","Number","channelId","targetUserId","Reconnect","RoomState","createSingleCacheKey","cacheKey","objKey","createCacheKey","propName","CachedGetter","timeInSeconds","descriptor","origFn","cachedValue","getFromCache","setCache","ChatUser_1","ChatUser","userData","_userData","badgesLikeStr","badge","slashIndex","displayName","badges","badgesStr","_parseBadgesLike","badgeInfo","badgeInfoStr","userType","isBroadcaster","isSubscriber","isFounder","isMod","isVip","isArtist","parseEmoteOffsets","emotes","emote","emoteId","placements","cache","_cleanCache","entry","expires","removeFromCache","internalCacheKey","_getInternalCacheKey","UserNotice","emoteOffsets","UserState","Whisper","TwitchCommandsCapability","TwitchMembershipCapability","ClearMsg","targetMessageId","GlobalUserState","TwitchTagsCapability","ChatMessage","isCheer","isRedemption","rewardId","isFirst","isReturningChatter","isHighlight","isReply","parentMessageId","parentMessageText","parentMessageUserId","parentMessageUserName","parentMessageUserDisplayName","bits","splitOnSpaces","maxMsgLength","res","startIndex","endIndex","spaceIndex","lastIndexOf","textSlice","validNames","toUserName","toChannelName","ChatClient_1","ChatClient","authProvider","getAccessTokenForIntent","_authVerified","_authRetryCount","onTimeout","onBan","onBitsBadgeUpgrade","onChatClear","onEmoteOnly","onFollowersOnly","onJoin","onJoinFailure","onPart","onMessageRemove","onUniqueChat","onRaid","onRaidCancel","onRitual","onSlow","onSubsOnly","onSub","onResub","onSubGift","onCommunitySub","onSubExtend","onRewardGift","onPrimePaidUpgrade","onGiftPaidUpgrade","onPrimeCommunityGift","onStandardPayForward","onCommunityPayForward","onAnnouncement","onWhisper","onNoPermission","onMessageRatelimit","onAuthenticationSuccess","onAuthenticationFailure","onTokenFetchFailure","onMessageFailed","onMessage","_onJoinResult","_ircClient","ssl","_getAuthToken","_messageRateLimiter","_joinRateLimiter","_chatLogger","_authProvider","_useLegacyScopes","legacyScopes","_readOnly","readOnly","_authIntents","authIntents","executeChatMessageRequest","isAlwaysMod","botLevel","timer","state","requestMembershipEvents","_authRetryTimer","broadcasterName","duration","isInitial","slowDelay","followDelay","userNotice","plan","streakMonths","subInfo","planName","isPrime","months","streak","wasAnonGift","redeemedMonth","originalGiftInfo","anonymous","userDisplayName","gifter","isAnon","gifterUserId","gifterDisplayName","gifterGiftCount","giftDuration","communitySubInfo","upgradeInfo","wasAnon","forwardInfo","originalGifterUserId","originalGifterDisplayName","recipientUserId","recipientDisplayName","giftInfo","raidInfo","viewerCount","ritualInfo","ritualName","badgeUpgradeInfo","threshold","extendInfo","endMonth","rewardGiftInfo","domain","gifterId","triggerType","announcementInfo","whisper","authRetries","ms","delay","_generateJustinfanNick","irc","attributes","rateLimiterOptions","replyTo","texts","_authToken","_getNecessaryScopes","foundSomeIntent","refreshAccessTokenForIntent","floor","padStart","pkg","idKey","clazz","for","BasicPubSubClient_1","BasicPubSubClient","_topics","_pingOnActivity","_onPong","_onResponse","onListenError","onPong","_pingCheck","_startActivityPingCheckTimer","_startInactivityPingCheckTimer","_resendListens","size","_receiveMessage","clearInterval","_activityPingCheckTimer","_inactivityPingCheckTimer","listen","topics","tokenResolvable","topicsArray","wrapped","_wrapResolvable","_resolveToken","_sendListen","catch","unlisten","_sendUnlisten","hasAnyTopics","_sendNonced","auth_token","createListenPacket","resolvable","function","topicsByTokenResolvable","topicsByToken","packet","nonce","responseListener","recvNonce","_sendPacket","dataStr","pingTime","latency","setInterval"],"sourceRoot":""}