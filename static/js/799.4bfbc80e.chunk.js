(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[799],{5523:function(e){e.exports.U=!1},1424:function(e){"use strict";e.exports=e=>{if("string"!==typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},e.exports.default=e.exports},8497:function(e,t,n){"use strict";var r=String.prototype.replace,s=/%20/g,i=n(734),o={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=i.assign({default:o.RFC3986,formatters:{RFC1738:function(e){return r.call(e,s,"+")},RFC3986:function(e){return String(e)}}},o)},5680:function(e,t,n){"use strict";var r=n(734),s=Object.prototype.hasOwnProperty,i=Array.isArray,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},u=function(e,t){if(i(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},l=function(e,t,n,r){if(e){var i=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(i),u=a?i.slice(0,a.index):i,l=[];if(u){if(!n.plainObjects&&s.call(Object.prototype,u)&&!n.allowPrototypes)return;l.push(u)}for(var h=0;n.depth>0&&null!==(a=o.exec(i))&&h<n.depth;){if(h+=1,!n.plainObjects&&s.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+i.slice(a.index)+"]"),function(e,t,n,r){for(var s=r?t:c(t,n),i=e.length-1;i>=0;--i){var o,a=e[i];if("[]"===a&&n.parseArrays)o=[].concat(s);else{o=n.plainObjects?Object.create(null):{};var u="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(u,10);n.parseArrays||""!==u?!isNaN(l)&&a!==u&&String(l)===u&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(o=[])[l]=s:o[u]=s:o={0:s}}s=o}return s}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?o.charset:e.charset;return{allowDots:"undefined"===typeof e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:o.comma,decoder:"function"===typeof e.decoder?e.decoder:o.decoder,delimiter:"string"===typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?Object.create(null):{};for(var h="string"===typeof e?function(e,t){var n,l={},h=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,p=h.split(t.delimiter,d),g=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<p.length;++n)0===p[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[n]?f="utf-8":"utf8=%26%2310003%3B"===p[n]&&(f="iso-8859-1"),g=n,n=p.length);for(n=0;n<p.length;++n)if(n!==g){var m,_,v=p[n],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(m=t.decoder(v,o.decoder,f,"key"),_=t.strictNullHandling?null:""):(m=t.decoder(v.slice(0,b),o.decoder,f,"key"),_=u(c(v.slice(b+1),t),(function(e){return t.decoder(e,o.decoder,f,"value")}))),_&&t.interpretNumericEntities&&"iso-8859-1"===f&&(_=a(_)),v.indexOf("[]=")>-1&&(_=i(_)?[_]:_),s.call(l,m)?l[m]=r.combine(l[m],_):l[m]=_}return l}(e,n):e,d=n.plainObjects?Object.create(null):{},p=Object.keys(h),g=0;g<p.length;++g){var f=p[g],m=l(f,h[f],n,"string"===typeof e);d=r.merge(d,m,n)}return r.compact(d)}},9467:function(e,t,n){"use strict";var r=n(734),s=n(8497),i=Object.prototype.hasOwnProperty,o={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,a(t)?t:[t])},l=Date.prototype.toISOString,h=s.default,d={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:h,formatter:s.formatters[h],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,n,s,i,o,c,l,h,p,g,f,m,_){var v,y=t;if("function"===typeof l?y=l(n,y):y instanceof Date?y=g(y):"comma"===s&&a(y)&&(y=y.join(",")),null===y){if(i)return c&&!m?c(n,d.encoder,_,"key"):n;y=""}if("string"===typeof(v=y)||"number"===typeof v||"boolean"===typeof v||"symbol"===typeof v||"bigint"===typeof v||r.isBuffer(y))return c?[f(m?n:c(n,d.encoder,_,"key"))+"="+f(c(y,d.encoder,_,"value"))]:[f(n)+"="+f(String(y))];var b,w=[];if("undefined"===typeof y)return w;if(a(l))b=l;else{var C=Object.keys(y);b=h?C.sort(h):C}for(var k=0;k<b.length;++k){var T=b[k];o&&null===y[T]||(a(y)?u(w,e(y[T],"function"===typeof s?s(n,T):n,s,i,o,c,l,h,p,g,f,m,_)):u(w,e(y[T],n+(p?"."+T:"["+T+"]"),s,i,o,c,l,h,p,g,f,m,_)))}return w};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return d;if(null!==e.encoder&&void 0!==e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||d.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s.default;if("undefined"!==typeof e.format){if(!i.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=s.formatters[n],o=d.filter;return("function"===typeof e.filter||a(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:d.addQueryPrefix,allowDots:"undefined"===typeof e.allowDots?d.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:d.charsetSentinel,delimiter:"undefined"===typeof e.delimiter?d.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:d.encode,encoder:"function"===typeof e.encoder?e.encoder:d.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:d.encodeValuesOnly,filter:o,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:d.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:d.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:d.strictNullHandling}}(t);"function"===typeof c.filter?r=(0,c.filter)("",r):a(c.filter)&&(n=c.filter);var l,h=[];if("object"!==typeof r||null===r)return"";l=t&&t.arrayFormat in o?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var g=o[l];n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var f=0;f<n.length;++f){var m=n[f];c.skipNulls&&null===r[m]||u(h,p(r[m],m,g,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var _=h.join(c.delimiter),v=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),_.length>0?v+_:""}},734:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n=Array.isArray,r=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)"undefined"!==typeof e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],s=0;s<t.length;++s)for(var i=t[s],o=i.obj[i.prop],a=Object.keys(o),c=0;c<a.length;++c){var u=a[c],l=o[u];"object"===typeof l&&null!==l&&-1===r.indexOf(l)&&(t.push({obj:o,prop:u}),r.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(n(r)){for(var s=[],i=0;i<r.length;++i)"undefined"!==typeof r[i]&&s.push(r[i]);t.obj[t.prop]=s}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(s){return r}},encode:function(e,t,n){if(0===e.length)return e;var s=e;if("symbol"===typeof e?s=Symbol.prototype.toString.call(e):"string"!==typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var i="",o=0;o<s.length;++o){var a=s.charCodeAt(o);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?i+=s.charAt(o):a<128?i+=r[a]:a<2048?i+=r[192|a>>6]+r[128|63&a]:a<55296||a>=57344?i+=r[224|a>>12]+r[128|a>>6&63]+r[128|63&a]:(o+=1,a=65536+((1023&a)<<10|1023&s.charCodeAt(o)),i+=r[240|a>>18]+r[128|a>>12&63]+r[128|a>>6&63]+r[128|63&a])}return i},isBuffer:function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(r,i,o){if(!i)return r;if("object"!==typeof i){if(n(r))r.push(i);else{if(!r||"object"!==typeof r)return[r,i];(o&&(o.plainObjects||o.allowPrototypes)||!t.call(Object.prototype,i))&&(r[i]=!0)}return r}if(!r||"object"!==typeof r)return[r].concat(i);var a=r;return n(r)&&!n(i)&&(a=s(r,o)),n(r)&&n(i)?(i.forEach((function(n,s){if(t.call(r,s)){var i=r[s];i&&"object"===typeof i&&n&&"object"===typeof n?r[s]=e(i,n,o):r.push(n)}else r[s]=n})),r):Object.keys(i).reduce((function(n,r){var s=i[r];return t.call(n,r)?n[r]=e(n[r],s,o):n[r]=s,n}),a)}}},5359:function(e,t,n){"use strict";var r=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,r.fetch&&(t.default=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},4768:function(e,t,n){"use strict";n.d(t,{U:function(){return o}});var r=n(2510),s=n(679),i=n(3578);class o extends i.v{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r;super(),this._type=e,this._target=t,this._config=n,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=null!==(r=n.retryLimit)&&void 0!==r?r:1/0,this._logger=n.logger}get isConnected(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.isConnected)&&void 0!==t&&t}get isConnecting(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.isConnecting)&&void 0!==t?t:this._connecting}get hasSocket(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.hasSocket)&&void 0!==t&&t}sendLine(e){var t;null===(t=this._currentConnection)||void 0===t||t.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if(null===(e=this._logger)||void 0===e||e.trace(`PersistentConnection disconnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const e=this._currentConnection;this._currentConnection=void 0,e.disconnect()}}assumeExternalDisconnect(){var e,t;null===(e=this._logger)||void 0===e||e.trace("PersistentConnection assumeExternalDisconnect"),null===(t=this._currentConnection)||void 0===t||t.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t,n;null===(t=this._logger)||void 0===t||t.trace(`PersistentConnection tryConnect currentConnectionExists:${Boolean(this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;null!==(n=this._retryTimerGenerator)&&void 0!==n||(this._retryTimerGenerator=(0,r.j)(120));const o=this._currentConnection=new this._type((0,s.$)(this._target),this._config);o.onReceive((e=>this.emit(this.onReceive,e))),o.onConnect((()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0})),o.onDisconnect(((t,n)=>{var r,s,a;if(this.emit(this.onDisconnect,t,n),t)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,o.disconnect(),this._currentConnection===o&&(this._currentConnection=void 0),this._previousConnection===o&&(this._previousConnection=void 0);else if(this._connecting){if(null===(r=this._logger)||void 0===r||r.debug(`Connection error caught: ${null!==(s=null===n||void 0===n?void 0:n.message)&&void 0!==s?s:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const t=this._retryTimerGenerator.next().value;0!==t&&(null===(a=this._logger)||void 0===a||a.info(`Retrying in ${t} seconds`)),setTimeout((()=>{var t;this._connecting&&(null===(t=this._logger)||void 0===t||t.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())}),1e3*t)}else this._reconnect()})),o.connect()}_reconnect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}},2805:function(e,t,n){"use strict";n.d(t,{C:function(){return o}});var r=null;"undefined"!==typeof WebSocket?r=WebSocket:"undefined"!==typeof MozWebSocket?r=MozWebSocket:"undefined"!==typeof global?r=global.WebSocket||global.MozWebSocket:"undefined"!==typeof window?r=window.WebSocket||window.MozWebSocket:"undefined"!==typeof self&&(r=self.WebSocket||self.MozWebSocket);var s=n(3578);class i extends s.v{constructor(){let{lineBased:e,logger:t,additionalOptions:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=null!==e&&void 0!==e&&e,this._logger=t,this._additionalOptions=n}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r\n`))}assumeExternalDisconnect(){var e;null===(e=this._logger)||void 0===e||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var t,n;if(!this._lineBased)return void this.emit(this.onReceive,e);const r=e.split("\r\n");if(this._currentLine+=null!==(t=r.shift())&&void 0!==t?t:"",r.length){this.emit(this.onReceive,this._currentLine),this._currentLine=null!==(n=r.pop())&&void 0!==n?n:"";for(const e of r)this.emit(this.onReceive,e)}}}class o extends i{constructor(e,t){if(super(t),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else{if(!e.url)throw new Error("WebSocketConnection requires either hostName & port or url to be set");this._url=e.url}}get hasSocket(){return!!this._socket}sendRaw(e){var t;null===(t=this._socket)||void 0===t||t.send(e)}connect(){var e,t;null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new r(this._url,null===(t=this._additionalOptions)||void 0===t?void 0:t.wsOptions),this._socket.onopen=()=>{var e;null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this.emit(this.onConnect)},this._socket.onmessage=e=>{let{data:t}=e;this.receiveRaw(t.toString())},this._socket.onerror=e=>{var t;null===(t=this._logger)||void 0===t||t.trace(`WebSocketConnection onError message:${e.message}`)},this._socket.onclose=e=>{var t;const n=this._connected,r=this._connecting;if(null===(t=this._logger)||void 0===t||t.trace(`WebSocketConnection onClose wasConnected:${n.toString()} wasConnecting:${r.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${e.wasClean.toString()}`),this._connected=!1,this._connecting=!1,e.wasClean||this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const t=new Error(`[${e.code}] ${e.reason}`);this.emit(this.onDisconnect,!1,t),this.emit(this.onEnd,!1,t)}this.clearSocket()}}disconnect(){var e,t;null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,null===(t=this._socket)||void 0===t||t.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}},3746:function(e,t,n){"use strict";n.d(t,{bc:function(){return o},in:function(){return s},mG:function(){return c}});var r,s,i=n(5523);function o(e){if("number"===typeof e){if(Object.prototype.hasOwnProperty.call(s,e))return e;var t=Object.keys(s).map((function(e){return parseInt(e,10)})).filter((function(t){return!isNaN(t)&&t<e}));return t.length?Math.max.apply(Math,t):s.WARNING}var n=e.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(s,n))throw new Error("Unknown log level string: ".concat(e));return s[n]}!function(e){e[e.CRITICAL=0]="CRITICAL",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=7]="TRACE"}(s||(s={}));var a=i.U?console.log.bind(console):console.debug.bind(console),c=((r={})[s.CRITICAL]=console.error.bind(console),r[s.ERROR]=console.error.bind(console),r[s.WARNING]=console.warn.bind(console),r[s.INFO]=console.info.bind(console),r[s.DEBUG]=a.bind(console),r[s.TRACE]=console.trace.bind(console),r)},7:function(e,t,n){"use strict";n.d(t,{h:function(){return E}});var r=n(5523),s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)};function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var o,a,c=n(3746),u=n(6126),l="undefined"===typeof process?[]:null!==(a=null===(o={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"v2.0.3"}.LOGGING)||void 0===o?void 0:o.split(";").map((function(e){var t=e.split("=",2),n=t[0],r=t[1];return r?["default"===n?void 0:n.split(":"),(0,c.bc)(r)]:null})).filter((function(e){return!!e})).sort((function(e,t){var n,r,s=e[0],i=t[0];return(null!==(n=null===i||void 0===i?void 0:i.length)&&void 0!==n?n:0)-(null!==(r=null===s||void 0===s?void 0:s.length)&&void 0!==r?r:0)})))&&void 0!==a?a:[],h=l.findIndex((function(e){return!e[0]})),d=void 0;function p(e,t){return t.length<=e.length&&t.every((function(t,n){return t===e[n]}))}function g(e){for(var t=e.split(":"),n=0,r=l;n<r.length;n++){var s=r[n],i=s[0],o=s[1];if(p(t,i))return o}return d}-1!==h&&(d=l[h][1],l.splice(h));var f,m,_,v=function(){function e(e){var t,n,s=e.name,i=e.minLevel,o=e.emoji,a=void 0!==o&&o,l=e.colors,h=e.timestamps,d=void 0===h?r.U:h;this._name=s,this._minLevel=null!==(n=null!==(t=(0,u.yH)(i,(function(e){return(0,c.bc)(e)})))&&void 0!==t?t:g(s))&&void 0!==n?n:c.in.WARNING,this._emoji=a,this._colors=l,this._timestamps=d}return e.prototype.crit=function(e){this.log(c.in.CRITICAL,e)},e.prototype.error=function(e){this.log(c.in.ERROR,e)},e.prototype.warn=function(e){this.log(c.in.WARNING,e)},e.prototype.info=function(e){this.log(c.in.INFO,e)},e.prototype.debug=function(e){this.log(c.in.DEBUG,e)},e.prototype.trace=function(e){this.log(c.in.TRACE,e)},e}(),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.log=function(e,t){if(!(e>this._minLevel)){var n=c.mG[e],r="[".concat(this._name,"] ").concat(t);this._timestamps&&(r="[".concat((new Date).toISOString(),"] ").concat(t)),n(r)}},t}(v),b=function(){function e(e){var t,n=e.name,r=e.minLevel,s=e.custom;this._minLevel=null!==(t=(0,u.yH)(r,(function(e){return(0,c.bc)(e)})))&&void 0!==t?t:g(n),this._override="function"===typeof s?{log:s}:s}return e.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},e.prototype.crit=function(e){this._override.crit?this._shouldLog(c.in.CRITICAL)&&this._override.crit(e):this.log(c.in.CRITICAL,e)},e.prototype.error=function(e){this._override.error?this._shouldLog(c.in.ERROR)&&this._override.error(e):this.log(c.in.ERROR,e)},e.prototype.warn=function(e){this._override.warn?this._shouldLog(c.in.WARNING)&&this._override.warn(e):this.log(c.in.WARNING,e)},e.prototype.info=function(e){this._override.info?this._shouldLog(c.in.INFO)&&this._override.info(e):this.log(c.in.INFO,e)},e.prototype.debug=function(e){this._override.debug?this._shouldLog(c.in.DEBUG)&&this._override.debug(e):this.log(c.in.DEBUG,e)},e.prototype.trace=function(e){this._override.trace?this._shouldLog(c.in.TRACE)&&this._override.trace(e):this.log(c.in.TRACE,e)},e.prototype._shouldLog=function(e){return void 0===this._minLevel||this._minLevel>=e},e}(),w=((f={})[c.in.CRITICAL]="\ud83d\uded1",f[c.in.ERROR]="\u274c",f[c.in.WARNING]="\u26a0\ufe0f ",f[c.in.INFO]="\u2139\ufe0f ",f[c.in.DEBUG]="\ud83d\udc1e",f[c.in.TRACE]="\ud83d\udc3e",f),C={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},k={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function T(e,t,n){return function(r){return"\x1b[".concat(e,"m").concat(n?n(r):r,"\x1b[").concat(t,"m")}}function M(e){return T(C[e],39)}function N(e,t){return T(k[e],49,t)}var R=((m={})[c.in.CRITICAL]=M("red"),m[c.in.ERROR]=M("redBright"),m[c.in.WARNING]=M("yellow"),m[c.in.INFO]=M("blue"),m[c.in.DEBUG]=M("magenta"),m[c.in.TRACE]=T(0,0),m),O=((_={})[c.in.CRITICAL]=N("bgRed",M("white")),_[c.in.ERROR]=N("bgRedBright",M("white")),_[c.in.WARNING]=N("bgYellow",M("black")),_[c.in.INFO]=N("bgBlue",M("white")),_[c.in.DEBUG]=N("bgMagenta",M("black")),_[c.in.TRACE]=T(7,27),_),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.log=function(e,t){var n,r,s;if(!(e>this._minLevel)){var i=c.mG[e],o="";if(this._timestamps&&(o+="[".concat((new Date).toISOString(),"] ")),this._emoji){var a=w[e];o+="".concat(a," ")}i(o+=null===(s=null!==(n=this._colors)&&void 0!==n?n:null===(r=process.stdout)||void 0===r?void 0:r.isTTY)||void 0===s||s?"".concat(O[e](this._name)," ").concat(O[e](c.in[e])," ").concat(R[e](t)):"[".concat(this._name,":").concat(c.in[e].toLowerCase(),"] ").concat(t))}},t}(v);function E(e){return e.custom?new b(e):r.U?new x(e):new y(e)}},4936:function(e,t,n){"use strict";function r(e){return void 0===e&&(e=!0),function(t,n){Object.defineProperty(t,n,{get:function(){},set:function(t){Object.defineProperty(this,n,{value:t,writable:!0,enumerable:e})},enumerable:e})}}n.d(t,{_:function(){return r}})},679:function(e,t,n){"use strict";n.d(t,{$:function(){return i},R:function(){return s}});var r=n(9818);function s(e){return(0,r.mG)(this,void 0,Promise,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return"function"!==typeof e?[3,2]:[4,e()];case 1:return[2,t.sent()];case 2:return[2,e]}}))}))}function i(e){return"function"===typeof e?e():e}},2510:function(e,t,n){"use strict";n.d(t,{j:function(){return s}});var r=n(9818);function s(e){var t,n,s;return(0,r.Jh)(this,(function(i){switch(i.label){case 0:t=0,n=1,i.label=1;case 1:return t<e?[4,t]:[3,3];case 2:return i.sent(),s=(0,r.CR)([n,t+n],2),t=s[0],n=s[1],[3,1];case 3:return[4,e];case 4:return i.sent(),[3,3];case 5:return[2]}}))}},6126:function(e,t,n){"use strict";function r(e){return null==e}function s(e,t){return r(e)?null:t(e)}function i(e,t){return r(e)?void 0:t(e)}n.d(t,{Ge:function(){return s},yH:function(){return i}})},876:function(e,t,n){"use strict";function r(){var e,t;return{promise:new Promise((function(n,r){e=n,t=r})),resolve:e,reject:t}}n.d(t,{B:function(){return r}})},9818:function(e,t,n){"use strict";n.d(t,{CR:function(){return i},Jh:function(){return s},ev:function(){return o},mG:function(){return r}});function r(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(s=2&a[0]?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;switch(r=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],r=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function i(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}function o(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError},3578:function(e,t,n){"use strict";n.d(t,{v:function(){return s}});class r{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.owner=e,this.event=t,this.listener=n,this._internal=r}unbind(){this.owner.removeListener(this)}}class s{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,t){return this._addListener(!1,e,t)}addListener(e,t){return this._addListener(!1,e,t)}removeListener(e,t){this._removeListener(!1,e,t)}registerEvent(){const e=t=>this.addListener(e,t);return e}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this._eventListeners.has(e))for(const s of this._eventListeners.get(e))s(...n);if(this._internalEventListeners.has(e))for(const s of this._internalEventListeners.get(e))s(...n)}registerInternalEvent(){const e=t=>this.addInternalListener(e,t);return e}addInternalListener(e,t){return this._addListener(!0,e,t)}removeInternalListener(e,t){this._removeListener(!0,e,t)}_addListener(e,t,n){const s=e?this._eventListeners:this._internalEventListeners;return s.has(t)?s.get(t).push(n):s.set(t,[n]),new r(this,t,n,e)}_removeListener(e,t,n){const r=e?this._eventListeners:this._internalEventListeners;if(t)if("object"===typeof t){const e=t;this._removeListener(e._internal,e.event,e.listener)}else{const e=t;if(r.has(e))if(n){const t=r.get(e);let s=0;for(;-1!==(s=t.indexOf(n));)t.splice(s,1)}else r.delete(e)}else r.clear()}}},8637:function(e,t,n){"use strict";n.d(t,{_:function(){return s}});var r=n(7805);class s extends r.s{constructor(e){super("Invalid token supplied",e)}}},6002:function(e,t,n){"use strict";n.d(t,{LI:function(){return I},ZI:function(){return N},vx:function(){return R},z3:function(){return x},B0:function(){return E},zJ:function(){return P},I0:function(){return O}});var r=n(5359),s=r.default||r,i=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),s.call(this,e,t)};const o=r.Headers;r.Request,r.Response;var a=n(9467),c=(n(5680),n(8497),n(7805));class u extends c.s{constructor(e,t,n,r,s,i){super(`Encountered HTTP status code ${e}: ${t}\n\nURL: ${n}\nMethod: ${r}\nBody:\n${!i&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=n,this._method=r,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function l(e,t){var n;if(!e.ok){const r="application/json"===e.headers.get("Content-Type"),s=r?JSON.stringify(await e.json(),null,2):await e.text(),i=a(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${t.url}${i}`;throw new u(e.status,e.statusText,o,null!==(n=t.method)&&void 0!==n?n:"GET",s,r)}}async function h(e){if(204===e.status)return;const t=await e.text();return t?JSON.parse(t):void 0}function d(e,t){switch(t){case"helix":return`https://api.twitch.tv/helix/${e.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${e.replace(/^\//,"")}`;default:return e}}async function p(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};var c,u;const l=null!==(c=e.type)&&void 0!==c?c:"helix",h=d(e.url,l),p=a(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),g=new o({Accept:"application/json"});let f;e.jsonBody&&(f=JSON.stringify(e.jsonBody),g.append("Content-Type","application/json")),t&&"auth"!==l&&g.append("Client-ID",t),n&&g.append("Authorization",`${"helix"===l?null!==r&&void 0!==r?r:"Bearer":"OAuth"} ${n}`);const m={...s,method:null!==(u=e.method)&&void 0!==u?u:"GET",headers:g,body:f};return await i(`${h}${p}`,m)}async function g(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await p(e,t,n,r,s);return await l(i,e),await h(i)}var f=n(8637);function m(e,t,n,r){return{grant_type:"authorization_code",client_id:e,client_secret:t,code:n,redirect_uri:r}}function _(e,t){return{grant_type:"client_credentials",client_id:e,client_secret:t}}function v(e,t,n){return{grant_type:"refresh_token",client_id:e,client_secret:t,refresh_token:n}}var y=n(8404),b=n(6126);const w=Symbol("twurpleRawData");class C{constructor(e){this[w]=e}}var k=n(2330);let T=class extends C{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[w].client_id}get userId(){var e;return null!==(e=this[w].user_id)&&void 0!==e?e:null}get userName(){var e;return null!==(e=this[w].login)&&void 0!==e?e:null}get scopes(){return this[w].scopes}get expiryDate(){return(0,b.Ge)(this[w].expires_in,(e=>new Date(this._obtainmentDate.getTime()+1e3*e)))}};function M(e){var t,n;return{accessToken:e.access_token,refreshToken:e.refresh_token||null,scope:null!==(t=e.scope)&&void 0!==t?t:[],expiresIn:null!==(n=e.expires_in)&&void 0!==n?n:null,obtainmentTimestamp:Date.now()}}async function N(e,t,n,r){return M(await g({type:"auth",url:"token",method:"POST",query:m(e,t,n,r)}))}async function R(e,t){return M(await g({type:"auth",url:"token",method:"POST",query:_(e,t)}))}async function O(e,t,n){return M(await g({type:"auth",url:"token",method:"POST",query:v(e,t,n)}))}async function x(e,t){try{const n=await g({type:"auth",url:"validate"},t,e);return new T(n)}catch(n){if(n instanceof u&&401===n.statusCode)throw new f._({cause:n});throw n}}async function E(e,t,n,r){let s=null,i=!1;try{const r=await e.getAccessTokenForUser(t,n);if(r){i=!0;return{accessToken:r,tokenInfo:await x(r.accessToken)}}}catch(o){o instanceof f._?s=o:null===r||void 0===r||r.error(`Retrieving an access token failed: ${o.message}`)}if(i&&(null===r||void 0===r||r.warn("No valid token available; trying to refresh"),e.refreshAccessTokenForUser))try{const n=await e.refreshAccessTokenForUser(t);return{accessToken:n,tokenInfo:await x(n.accessToken)}}catch(o){o instanceof f._?s=o:null===r||void 0===r||r.error(`Refreshing the access token failed: ${o.message}`)}throw null!==s&&void 0!==s?s:new Error("Could not retrieve a valid token")}T=(0,y.gn)([(0,k.P)("auth","TokenInfo","clientId")],T);const A=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function S(e,t){if(null===t||void 0===t?void 0:t.length){const n=new Set(e.flatMap((e=>{var t;return[e,...null!==(t=A.get(e))&&void 0!==t?t:[]]})));if(t.every((e=>!n.has(e)))){const e=t.join(", ");throw new Error(`This token does not have any of the requested scopes (${e}) and can not be upgraded.\nIf you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:\n\n\thttps://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function I(e,t){for(const n of t)S(e,n)}async function P(e,t,n,r,s){if((null===s||void 0===s?void 0:s.length)||!n){const n=await x(t,e);if(!n.userId)throw new Error("Trying to use an app access token as a user access token");const i=null!==r&&void 0!==r?r:n.scopes;return s&&I(i,s.filter((e=>Boolean(e)))),[i,n.userId]}return[r,n]}},8404:function(e,t,n){"use strict";n.d(t,{gn:function(){return r}});function r(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError},6787:function(e,t,n){"use strict";n.d(t,{A:function(){return Ln}});var r={};n.r(r),n.d(r,{AwayNotify:function(){return X},Batch:function(){return le},CapNotify:function(){return he},ChgHost:function(){return pe},InviteNotify:function(){return ge},LabeledResponse:function(){return me},MessageTags:function(){return _e},MultiPrefix:function(){return ve}});var s={};n.r(s),n.d(s,{Away:function(){return ze},CapabilityNegotiation:function(){return Ye},ChannelInvite:function(){return Ie},ChannelJoin:function(){return Ne},ChannelKick:function(){return Pe},ChannelList:function(){return Se},ChannelPart:function(){return Re},ClientQuit:function(){return Te},ErrorMessage:function(){return We},IsOnQuery:function(){return Ve},Kill:function(){return qe},Mode:function(){return xe},Names:function(){return Ae},NickChange:function(){return we},Notice:function(){return Le},OperLogin:function(){return ke},Password:function(){return be},Ping:function(){return Be},Pong:function(){return Ge},PrivateMessage:function(){return je},Rehash:function(){return He},Restart:function(){return Qe},ServerQuit:function(){return Me},TagMessage:function(){return Ze},Time:function(){return De},Topic:function(){return Ee},UserHostQuery:function(){return Ke},UserRegistration:function(){return Ce},Wallops:function(){return Je},WhoIsQuery:function(){return $e},WhoQuery:function(){return Ue},WhoWasQuery:function(){return Fe}});var i={};n.r(i),n.d(i,{Error401NoSuchNick:function(){return St},Error402NoSuchServer:function(){return It},Error403NoSuchChannel:function(){return Pt},Error404CanNotSendToChan:function(){return Dt},Error405TooManyChannels:function(){return jt},Error410InvalidCapCmd:function(){return Lt},Error421UnknownCommand:function(){return Ut},Error422NoMotd:function(){return $t},Error431NoNickNameGiven:function(){return Ft},Error432ErroneusNickname:function(){return qt},Error433NickNameInUse:function(){return Bt},Error436NickCollision:function(){return Gt},Error441UserNotInChannel:function(){return Wt},Error442NotOnChannel:function(){return zt},Error443UserOnChannel:function(){return Ht},Error451NotRegistered:function(){return Qt},Error461NeedMoreParams:function(){return Jt},Error462AlreadyRegistered:function(){return Kt},Error471ChannelIsFull:function(){return Vt},Error472UnknownMode:function(){return Yt},Error473InviteOnlyChan:function(){return Zt},Error474BannedFromChan:function(){return Xt},Error475BadChannelKey:function(){return en},Error479BadChanName:function(){return tn},Error481NoPrivileges:function(){return nn},Error482ChanOpPrivsNeeded:function(){return rn},Error491NoOperHost:function(){return sn},Error501UmodeUnknownFlag:function(){return on},Error502UsersDontMatch:function(){return an},Reply001Welcome:function(){return Xe},Reply002YourHost:function(){return et},Reply003Created:function(){return tt},Reply004ServerInfo:function(){return nt},Reply005Isupport:function(){return rt},Reply221UmodeIs:function(){return st},Reply301Away:function(){return it},Reply302UserHost:function(){return ot},Reply305UnAway:function(){return at},Reply306NowAway:function(){return ct},Reply311WhoisUser:function(){return ut},Reply315EndOfWho:function(){return lt},Reply318EndOfWhois:function(){return ht},Reply319WhoisChannels:function(){return dt},Reply322List:function(){return pt},Reply323ListEnd:function(){return gt},Reply324ChannelModeIs:function(){return ft},Reply331NoTopic:function(){return mt},Reply332Topic:function(){return _t},Reply333TopicWhoTime:function(){return vt},Reply341Inviting:function(){return yt},Reply348ExceptList:function(){return bt},Reply349EndOfExceptList:function(){return wt},Reply352WhoReply:function(){return Ct},Reply353NamesReply:function(){return kt},Reply366EndOfNames:function(){return Tt},Reply367BanList:function(){return Mt},Reply368EndOfBanList:function(){return Nt},Reply372Motd:function(){return Rt},Reply375MotdStart:function(){return Ot},Reply376EndOfMotd:function(){return xt},Reply381YoureOper:function(){return Et},Reply391Time:function(){return At}});function o(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var a=n(7),c=n(3746),u=function(e,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},u(e,t)};function l(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var h=function(){return h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},h.apply(this,arguments)};function d(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function p(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(s=2&a[0]?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;switch(r=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],r=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function g(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}function m(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError;var _=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,s=this.constructor,i=this;return i=e.apply(this,m([],f(t),!1))||this,Object.setPrototypeOf(i,s.prototype),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,i,s.constructor),i}return l(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),t}(Error),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(_),y=function(){function e(e){var t=e.logger,n=e.bucketSize,r=e.timeFrame,s=e.doRequest;this._queue=[],this._usedFromBucket=0,this._paused=!1,this._logger=(0,a.h)(h({name:"rate-limiter",emoji:!0},t)),this._bucketSize=n,this._timeFrame=r,this._callback=s}return e.prototype.request=function(e,t){return d(this,void 0,Promise,(function(){var n=this;return p(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r,s){var i,o={req:e,resolve:r,reject:s,limitReachedBehavior:null!==(i=null===t||void 0===t?void 0:t.limitReachedBehavior)&&void 0!==i?i:"enqueue"};if(n._usedFromBucket>=n._bucketSize||n._paused)switch(o.limitReachedBehavior){case"enqueue":n._queue.push(o),n._usedFromBucket+n._queue.length>=n._bucketSize?n._logger.warn("Rate limit of ".concat(n._bucketSize," was reached, waiting for ").concat(n._paused?"the limiter to be unpaused":"a free bucket entry","; queue size is ").concat(n._queue.length)):n._logger.info("Enqueueing request because the rate limiter is paused; queue size is ".concat(n._queue.length));break;case"null":o.resolve(null),n._logger.warn("Rate limit of ".concat(n._bucketSize," was reached, dropping request and returning null")),n._paused?n._logger.info("Returning null for request because the rate limiter is paused"):n._logger.warn("Rate limit of ".concat(n._bucketSize," was reached, dropping request and returning null"));break;case"throw":o.reject(new v("Request dropped because ".concat(n._paused?"the rate limiter is paused":"the rate limit was reached")));break;default:throw new Error("this should never happen")}else n._runRequest(o)}))];case 1:return[2,r.sent()]}}))}))},e.prototype.clear=function(){this._queue=[]},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1,this._runNextRequest()},e.prototype._runRequest=function(e){return d(this,void 0,void 0,(function(){var t,n,r,s,i,o=this;return p(this,(function(a){switch(a.label){case 0:this._logger.debug("doing a request, new queue length is ".concat(this._queue.length)),this._usedFromBucket+=1,t=e.req,n=e.resolve,r=e.reject,a.label=1;case 1:return a.trys.push([1,3,4,5]),s=n,[4,this._callback(t)];case 2:return s.apply(void 0,[a.sent()]),[3,5];case 3:return i=a.sent(),r(i),[3,5];case 4:return setTimeout((function(){o._usedFromBucket-=1,o._queue.length&&o._usedFromBucket<o._bucketSize&&o._runNextRequest()}),this._timeFrame),[7];case 5:return[2]}}))}))},e.prototype._runNextRequest=function(){if(!this._paused){var e=this._queue.shift();e&&this._runRequest(e)}},e}(),b=function(e){function t(t,n){return e.call(this,h(h({},n),{doRequest:function(e,n){return d(this,void 0,Promise,(function(){return p(this,(function(r){switch(r.label){case 0:return[4,t.request(e,n)];case 1:return[2,r.sent()]}}))}))}}))||this}return l(t,e),t}(y),w=function(){function e(e){var t=e.logger,n=e.bucketSize,r=e.timeFrame,s=e.doRequest,i=e.getPartitionKey;this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._paused=!1,this._logger=(0,a.h)(h({name:"rate-limiter",emoji:!0},t)),this._bucketSize=n,this._timeFrame=r,this._callback=s,this._partitionKeyCallback=i}return e.prototype.request=function(e,t){return d(this,void 0,Promise,(function(){var n=this;return p(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r,s){var i,o,a={req:e,resolve:r,reject:s,limitReachedBehavior:null!==(i=null===t||void 0===t?void 0:t.limitReachedBehavior)&&void 0!==i?i:"enqueue"},c=n._partitionKeyCallback(e),u=null!==(o=n._usedFromBucket.get(c))&&void 0!==o?o:0;if(u>=n._bucketSize||n._paused)switch(a.limitReachedBehavior){case"enqueue":var l=n._getPartitionedQueue(c);l.push(a),u+l.length>=n._bucketSize?n._logger.warn("Rate limit of ".concat(n._bucketSize," for ").concat(c?"partition ".concat(c):"default partition"," was reached, waiting for ").concat(n._paused?"the limiter to be unpaused":"a free bucket entry","; queue size is ").concat(l.length)):n._logger.info("Enqueueing request for ".concat(c?"partition ".concat(c):"default partition"," because the rate limiter is paused; queue size is ").concat(l.length));break;case"null":a.resolve(null),n._paused?n._logger.info("Returning null for request for ".concat(c?"partition ".concat(c):"default partition"," because the rate limiter is paused")):n._logger.warn("Rate limit of ".concat(n._bucketSize," for ").concat(c?"partition ".concat(c):"default partition"," was reached, dropping request and returning null"));break;case"throw":a.reject(new v("Request dropped because ".concat(n._paused?"the rate limiter is paused":"the rate limit for ".concat(c?"partition ".concat(c):"default partition"," was reached"))));break;default:throw new Error("this should never happen")}else n._runRequest(a,c)}))];case 1:return[2,r.sent()]}}))}))},e.prototype.clear=function(){this._partitionedQueue.clear()},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){var e,t;this._paused=!1;try{for(var n=g(this._partitionedQueue.keys()),r=n.next();!r.done;r=n.next()){var s=r.value;this._runNextRequest(s)}}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype._getPartitionedQueue=function(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);var t=[];return this._partitionedQueue.set(e,t),t},e.prototype._runRequest=function(e,t){var n;return d(this,void 0,void 0,(function(){var r,s,i,o,a,c,u=this;return p(this,(function(l){switch(l.label){case 0:r=this._getPartitionedQueue(t),this._logger.debug("doing a request for ".concat(t?"partition ".concat(t):"default partition",", new queue length is ").concat(r.length)),this._usedFromBucket.set(t,(null!==(n=this._usedFromBucket.get(t))&&void 0!==n?n:0)+1),s=e.req,i=e.resolve,o=e.reject,l.label=1;case 1:return l.trys.push([1,3,4,5]),a=i,[4,this._callback(s)];case 2:return a.apply(void 0,[l.sent()]),[3,5];case 3:return c=l.sent(),o(c),[3,5];case 4:return setTimeout((function(){var e=u._usedFromBucket.get(t)-1;u._usedFromBucket.set(t,e),r.length&&e<u._bucketSize&&u._runNextRequest(t)}),this._timeFrame),[7];case 5:return[2]}}))}))},e.prototype._runNextRequest=function(e){if(!this._paused){var t=this._getPartitionedQueue(e).shift();t&&this._runRequest(t,e)}},e}(),C=n(876),k=n(679),T=n(2510),M=n(9818);var N=n(4936),R=n(3578),O=n(7805);class x extends O.s{}var E=n(6126);function A(e){return(0,E.Ge)(e.expiresIn,(t=>e.obtainmentTimestamp+1e3*t-6e4))}function S(e){var t;return null!==(t=(0,E.Ge)(A(e),(e=>Date.now()>e)))&&void 0!==t&&t}var I=n(6002),P=n(8637),D=n(8404);function j(e){return"string"===typeof e?e:"number"===typeof e?e.toString(10):e.id}var L=n(4408),U=n(2330);class $ extends O.s{constructor(e){super(`The user context for the user ${e} has been disabled.\nThis happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).\n\nUse .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class F extends O.s{constructor(e){super(`User ${e} was removed while trying to fetch a token.\n\nMake sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class q extends O.s{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}class B{constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];const s=n.filter((e=>Boolean(e)));if(this._newTokenPromise){if(!s.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...s):this._queuedScopeSets=[...s],!this._queuePromise){const{promise:e,resolve:t,reject:n}=(0,C.B)();this._queuePromise=e,this._queueExecutor=async()=>{var e;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{t(await this._executor(this._newTokenScopeSets))}catch(r){n(r)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],null===(e=this._queueExecutor)||void 0===e||e.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...s];const{promise:i,resolve:o,reject:a}=(0,C.B)();this._newTokenPromise=i;try{o(await this._executor(this._newTokenScopeSets))}catch(c){a(c)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],null===(e=this._queueExecutor)||void 0===e||e.call(this)}return await i}}let G=class extends R.v{constructor(e){var t;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=null!==(t=e.appImpliedScopes)&&void 0!==t?t:[],this._appTokenFetcher=new B((async e=>await this._fetchAppToken(e)))}addUser(e,t,n){const r=j(e);if(!t.refreshToken)throw new Error(`Trying to add user ${r} without refresh token`);this._cachedRefreshFailures.delete(r),this._userAccessTokens.set(r,{...t,userId:r}),this._userTokenFetchers.has(r)||this._userTokenFetchers.set(r,new B((async e=>await this._fetchUserToken(r,e)))),n&&this.addIntentsToUser(e,n)}async addUserForToken(e,t){let n=null;if(e.accessToken&&!S(e))try{n=[e,await(0,I.z3)(e.accessToken)]}catch(o){if(!(o instanceof P._))throw o}if(!n){if(!e.refreshToken)throw new P._;const t=await(0,I.I0)(this._clientId,this._clientSecret,e.refreshToken),r=await(0,I.z3)(t.accessToken);this.emit(this.onRefresh,r.userId,t),n=[t,r]}const[r,s]=n;if(!s.userId)throw new x("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const i=r.scope?r:{...r,scope:s.scopes};return this.addUser(s.userId,i,t),s.userId}async addUserForCode(e,t){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const n=await(0,I.ZI)(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(n,t)}hasUser(e){return this._userTokenFetchers.has(j(e))}removeUser(e){const t=j(e);if(this._userIdToIntents.has(t)){const e=this._userIdToIntents.get(t);for(const t of e)this._intentToUserId.delete(t);this._userIdToIntents.delete(t)}this._userAccessTokens.delete(t),this._userTokenFetchers.delete(t),this._cachedRefreshFailures.delete(t)}addIntentsToUser(e,t){const n=j(e);if(!this._userAccessTokens.has(n))throw new Error("Trying to add intents to a user that was not added to this provider");for(const r of t)this._intentToUserId.has(r)&&this._userIdToIntents.get(this._intentToUserId.get(r)).delete(r),this._intentToUserId.set(r,n),this._userIdToIntents.has(n)?this._userIdToIntents.get(n).add(r):this._userIdToIntents.set(n,new Set([r]))}getIntentsForUser(e){const t=j(e);return this._userIdToIntents.has(t)?Array.from(this._userIdToIntents.get(t)):[]}removeIntents(e){var t;for(const n of e)if(this._intentToUserId.has(n)){const e=this._intentToUserId.get(n);null===(t=this._userIdToIntents.get(e))||void 0===t||t.delete(n),this._intentToUserId.delete(n)}}async refreshAccessTokenForUser(e){const t=j(e);if(this._cachedRefreshFailures.has(t))throw new $(t);const n=this._userAccessTokens.get(t);if(!n)throw new Error("Trying to refresh token for user that was not added to the provider");const r=await this._refreshUserTokenWithCallback(t,n.refreshToken);return this._checkIntermediateUserRemoval(t),this._userAccessTokens.set(t,{...r,userId:t}),this.emit(this.onRefresh,t,r),{...r,userId:t}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new q(e);const t=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(t)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var t;const n=this._userAccessTokens.get(j(e));if(!n)throw new Error("Trying to get scopes for user that was not added to the provider");return null!==(t=n.scope)&&void 0!==t?t:[]}async getAccessTokenForUser(e){const t=j(e),n=this._userTokenFetchers.get(t);if(!n)return null;if(this._cachedRefreshFailures.has(t))throw new $(t);for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];return await n.fetch(...s)}async getAccessTokenForIntent(e){if(!this._intentToUserId.has(e))return null;const t=this._intentToUserId.get(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];const i=await this.getAccessTokenForUser(t,...r);if(!i)throw new L.v(`Found intent ${e} corresponding to user ID ${t} but no token was found`);return{...i,userId:t}}async getAnyAccessToken(e){if(e){const t=j(e);if(this._userAccessTokens.has(t)){const e=await this.getAccessTokenForUser(t);if(!e)throw new L.v(`Token for user ID ${t} exists but nothing was returned by getAccessTokenForUser`);return{...e,userId:t}}}return await this.getAppAccessToken()}async getAppAccessToken(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map((e=>[e])))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new F(e)}async _fetchUserToken(e,t){const n=this._userAccessTokens.get(e);if(!n)throw new Error("Trying to get token for user that was not added to the provider");if(n.accessToken&&!S(n))try{if(n.scope)return(0,I.LI)(n.scope,t),n;const[r=[]]=await(0,I.zJ)(this._clientId,n.accessToken,e,n.scope,t),s={...n,scope:r};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,s),s}catch(s){if(!(s instanceof P._))throw s}this._checkIntermediateUserRemoval(e);const r=await this.refreshAccessTokenForUser(e);return(0,I.LI)(r.scope,t),r}async _refreshUserTokenWithCallback(e,t){try{return await(0,I.I0)(this.clientId,this._clientSecret,t)}catch(n){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e),n}}async _fetchAppToken(e){if(e.length>0)for(const t of e){if(!this._appImpliedScopes.length)throw new Error(`One of the scopes ${t.join(", ")} requested but the client credentials flow does not support scopes`);if(t.every((e=>!this._appImpliedScopes.includes(e))))throw new Error(`One of the scopes ${t.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}return!this._appAccessToken||S(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await(0,I.vx)(this._clientId,this._clientSecret)}};(0,D.gn)([(0,N._)(!1)],G.prototype,"_clientSecret",void 0),(0,D.gn)([(0,N._)(!1)],G.prototype,"_userAccessTokens",void 0),(0,D.gn)([(0,N._)(!1)],G.prototype,"_userTokenFetchers",void 0),(0,D.gn)([(0,N._)(!1)],G.prototype,"_appAccessToken",void 0),(0,D.gn)([(0,N._)(!1)],G.prototype,"_appTokenFetcher",void 0),G=(0,D.gn)([(0,U.P)("auth","RefreshingAuthProvider","clientId")],G);function W(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var z=n(2805);class H{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}var Q=n(4768);function J(e,t){return Object.assign.apply(Object,(0,M.ev)([{}],(0,M.CR)(e.map(t)),!1))}function K(e,t,n){var r=e.split(t);return r.length<=n?r:(0,M.ev)((0,M.ev)([],(0,M.CR)(r.slice(0,n-1)),!1),[r.slice(n-1).join(t)],!1)}function V(e,t,n){if("number"===typeof e&&(e=e.toString()),(t-=e.length)<=0)return e;void 0===n&&(n=" ");var r="";do{1===(1&t)&&(r+=n),(t>>=1)&&(n+=n)}while(t);return r+e}function Y(e,t){Object.entries(e).forEach((function(e){var n=(0,M.CR)(e,2),r=n[0],s=n[1];return t(s,r)}))}function Z(e){var t,n,r;if(Array.isArray(e)){for(n=Array(t=e.length);t--;)n[t]=(r=e[t])&&"object"===typeof r?Z(r):r;return n}if("[object Object]"===Object.prototype.toString.call(e)){for(t in n={},e)"__proto__"===t?Object.defineProperty(n,t,{value:Z(e[t]),configurable:!0,enumerable:!0,writable:!0}):n[t]=(r=e[t])&&"object"===typeof r?Z(r):r;return n}return e}const X={name:"away-notify"};class ee extends Error{constructor(e,t,n){super(`command "${e}" expected ${t} or more parameters, got ${n}`),this._command=e,this._expectedParams=t,this._actualParams=n,Object.setPrototypeOf(this,ee.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ee)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class te extends Error{constructor(e,t,n,r){var s;super(`required parameter "${t}" did not validate against ${null!==(s=n.type)&&void 0!==s?s:"regex"} validation: "${r}"`),this._command=e,this._paramName=t,this._paramSpec=n,this._givenValue=r,Object.setPrototypeOf(this,te.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,te)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const ne={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var re=n(1424);function se(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#&";const n=new RegExp(`^[${re(t)}][^ \b\0\n\r,]+$`);return n.test(e)}const ie={0:"\0",n:"\n",r:"\r","\x10":"\x10"};function oe(e){if(!e.startsWith("\x01"))return!1;if((e=e.substring(1)).endsWith("\x01")&&(e=e.slice(0,-1)),!e)return!1;e=e.replace(/\x10(.)/,((e,t)=>t in ie?ie[t]:""));let[t,n=""]=K(e," ",2);return t=t?t.toUpperCase():"",{command:t,params:n}}const ae={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};class ce{static checkParam(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ne;if("channel"===t.type&&!se(e,n.channelTypes))return!1;if("channelList"===t.type){if(!e.split(",").every((e=>se(e,n.channelTypes))))return!1}return!(t.match&&!t.match.test(e))}constructor(e){let{params:t,tags:n,prefix:r,rawLine:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{serverProperties:i=ne,isServer:o=!1,shouldParseParams:a=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3?arguments[3]:void 0;this._params=[],this._serverProperties=ne,this._paramSpec=c,this._command=e,this._params=t,this._tags=null!==n&&void 0!==n?n:new Map,this._prefix=r,this._serverProperties=i,this._raw=s,a&&this.parseParams(o)}getMinParamCount(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._paramSpec?Object.values(this._paramSpec).filter((t=>(!t.noServer||!e)&&(!(t.noClient&&!e)&&!t.optional))).length:0}get paramCount(){var e,t;return null!==(t=null===(e=this._params)||void 0===e?void 0:e.length)&&void 0!==t?t:0}prefixToString(){return this._prefix?function(e){let t=`${e.nick}`;return e.user&&(t+=`!${e.user}`),e.host&&(t+=`@${e.host}`),t}(this._prefix):""}tagsToString(){return[...this._tags.entries()].map((e=>{let[t,n]=e;return n?`${t}=${r=n,r.replace(/[\\;\n\r ]/g,(e=>`\\${ae[e]}`))}`:t;var r})).join(";")}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=[arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const e=this.prefixToString();e&&t.unshift(`:${e}`)}const n=this.tagsToString();return n&&t.unshift(`@${n}`),t.join(" ")}_initPrefixAndTags(e,t){this._prefix=e,t&&(this._tags=t)}parseParams(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._params){let t=this.getMinParamCount(e);if(t>this._params.length)throw new ee(this._command,t,this._params.length);const n=this._paramSpec;if(!n)return;let r=0;const s={};for(const[i,o]of Object.entries(n)){if(o.noServer&&e)continue;if(o.noClient&&!e)continue;if(this._params.length-r<=t){if(o.optional)continue;if(this._params.length-r!==t)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let n=this._params[r];if(!n){if(o.optional)break;throw new Error("unexpected parameter underflow")}if(o.rest){const e=[];for(;this._params[r]&&!this._params[r].trailing;)e.push(this._params[r].value),++r;if(!e.length){if(o.optional)continue;throw new Error(`no parameters left for required rest parameter "${i}"`)}n={value:e.join(" "),trailing:!1}}if(ce.checkParam(n.value,o))s[i]={...n},o.optional||--t,o.rest||++r;else if(!o.optional)throw new te(this._command,i,o,n.value);if(o.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const e of Object.keys(this._paramSpec))Object.defineProperty(this,e,{get(){var t,n;return null===(n=null===(t=this._parsedParams)||void 0===t?void 0:t[e])||void 0===n?void 0:n.value}})}}get rawParamValues(){var e,t;return null!==(t=null===(e=this._params)||void 0===e?void 0:e.map((e=>e.value)))&&void 0!==t?t:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map((e=>{var t;const n=null===(t=this._parsedParams)||void 0===t?void 0:t[e];if(n)return(n.trailing?":":"")+n.value})).filter((e=>void 0!==e))].join(" ")}_buildCommandFromRawParams(){var e,t;return[this._command,...null!==(t=null===(e=this._params)||void 0===e?void 0:e.map((e=>`${e.trailing?":":""}${e.value}`)))&&void 0!==t?t:[]].join(" ")}}ce.COMMAND="",ce.SUPPORTS_CAPTURE=!1;class ue extends ce{constructor(e,t,n){super(e,t,n,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}ue.COMMAND="BATCH";const le={name:"batch",messageTypes:[ue],usesTags:!0},he={name:"cap-notify"};class de extends ce{constructor(e,t,n){super(e,t,n,{newUser:{},newHost:{}})}}de.COMMAND="CHGHOST";const pe={name:"chghost",messageTypes:[de]},ge={name:"invite-notify"};class fe extends ce{}fe.COMMAND="ACK";const me={name:"labeled-response",messageTypes:[fe],usesTags:!0},_e={name:"message-tags",usesTags:!0},ve={name:"multi-prefix"};class ye{constructor(e,t){this._client=e,this._originalMessage=t,this._messages=[],this._endEventHandlers=new Map;for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const t=this._client.on(e,(()=>this.end()));this._endEventHandlers.set(e,t)}async promise(){return this._promise||(this._promise=new Promise((e=>this._promiseResolve=e))),await this._promise}collect(e){return!!this._originalMessage._acceptsInReplyCollection(e)&&(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0)}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach((e=>this._client.removeListener(e))),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class be extends ce{constructor(e,t,n){super(e,t,n,{password:{}})}}be.COMMAND="PASS";class we extends ce{constructor(e,t,n){super(e,t,n,{nick:{}})}}we.COMMAND="NICK";class Ce extends ce{constructor(e,t,n){super(e,t,n,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}Ce.COMMAND="USER";class ke extends ce{constructor(e,t,n){super(e,t,n,{name:{},password:{}})}}ke.COMMAND="OPER";class Te extends ce{constructor(e,t,n){super(e,t,n,{text:{trailing:!0,optional:!0}})}}Te.COMMAND="QUIT";class Me extends ce{constructor(e,t,n){super(e,t,n,{server:{},reason:{trailing:!0}})}}Me.COMMAND="SQUIT";class Ne extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},key:{optional:!0}})}}Ne.COMMAND="JOIN";class Re extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}Re.COMMAND="PART";class Oe extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,Oe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Oe)}get char(){return this._char}}class xe extends ce{constructor(e,t,n){super(e,t,n,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return se(this.target,this._serverProperties.channelTypes)}separate(){const e=[],t=this.modes;if(!t)throw new Error("can't separate a channel mode request, just set actions");const n=t.split(" "),r=n.shift();let s="add";for(const i of r){let t=s;switch(i){case"+":s="add";break;case"-":s="remove";break;default:{let r=!1,o=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(i)||this._serverProperties.supportedChannelModes.prefix.includes(i))r=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(i))"add"===s&&(r=!0);else if(this._serverProperties.supportedChannelModes.list.includes(i))n.length?r=!0:t="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(i))throw new Oe(i)}else o=this._serverProperties.supportedUserModes.includes(i);if(r&&!n.length)continue;e.push({prefix:this._prefix,action:t,letter:i,param:r?n.shift():void 0,known:o})}}}return e}}xe.COMMAND="MODE";class Ee extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}Ee.COMMAND="TOPIC";class Ae extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channelList",optional:!0}})}}Ae.COMMAND="NAMES",Ae.SUPPORTS_CAPTURE=!0;class Se extends ce{constructor(e,t,n){super(e,t,n,{channel:{optional:!0},server:{optional:!0}})}}Se.COMMAND="LIST";class Ie extends ce{constructor(e,t,n){super(e,t,n,{target:{},channel:{type:"channel"}})}}Ie.COMMAND="INVITE";class Pe extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}Pe.COMMAND="KICK";class De extends ce{constructor(e,t,n){super(e,t,n,{server:{optional:!0}})}}De.COMMAND="TIME";class je extends ce{constructor(e,t,n){super(e,t,n,{target:{},text:{trailing:!0}})}}je.COMMAND="PRIVMSG";class Le extends ce{constructor(e,t,n){super(e,t,n,{target:{},text:{trailing:!0}})}}Le.COMMAND="NOTICE";class Ue extends ce{constructor(e,t,n){super(e,t,n,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}Ue.COMMAND="WHO";class $e extends ce{constructor(e,t,n){super(e,t,n,{server:{optional:!0},nickMask:{}})}}$e.COMMAND="WHOIS";class Fe extends ce{constructor(e,t,n){super(e,t,n,{nick:{},count:{optional:!0},server:{optional:!0}})}}Fe.COMMAND="WHOWAS";class qe extends ce{constructor(e,t,n){super(e,t,n,{target:{},reason:{trailing:!0,optional:!0}})}}qe.COMMAND="KILL";class Be extends ce{constructor(e,t,n){super(e,t,n,{text:{trailing:!0}})}}Be.COMMAND="PING";class Ge extends ce{constructor(e,t,n){super(e,t,n,{server:{noClient:!0},text:{trailing:!0}})}}Ge.COMMAND="PONG";class We extends ce{constructor(e,t,n){super(e,t,n,{text:{trailing:!0}})}}We.COMMAND="ERROR";class ze extends ce{constructor(e,t,n){super(e,t,n,{text:{trailing:!0,optional:!0}})}}ze.COMMAND="AWAY";class He extends ce{}He.COMMAND="REHASH";class Qe extends ce{}Qe.COMMAND="RESTART";class Je extends ce{constructor(e,t,n){super(e,t,n,{text:{trailing:!0}})}}Je.COMMAND="WALLOPS";class Ke extends ce{constructor(e,t,n){super(e,t,n,{nicks:{rest:!0}})}}Ke.COMMAND="USERHOST";class Ve extends ce{constructor(e,t,n){super(e,t,n,{nicks:{rest:!0}})}}Ve.COMMAND="ISON";class Ye extends ce{constructor(e,t,n){super(e,t,n,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof Ye))return!1;switch(this.subCommand){case"ACK":case"NAK":return"REQ"===e.subCommand&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof Ye))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}Ye.COMMAND="CAP",Ye.SUPPORTS_CAPTURE=!0;class Ze extends ce{constructor(e,t,n){super(e,t,n,{target:{}})}}Ze.COMMAND="TAGMSG";class Xe extends ce{constructor(e,t,n){super(e,t,n,{me:{},welcomeText:{trailing:!0}})}}Xe.COMMAND="001";class et extends ce{constructor(e,t,n){super(e,t,n,{me:{},yourHost:{trailing:!0}})}}et.COMMAND="002";class tt extends ce{constructor(e,t,n){super(e,t,n,{me:{},createdText:{trailing:!0}})}}tt.COMMAND="003";class nt extends ce{constructor(e,t,n){super(e,t,n,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}nt.COMMAND="004";class rt extends ce{constructor(e,t,n){super(e,t,n,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}rt.COMMAND="005";class st extends ce{constructor(e,t,n){super(e,t,n,{me:{},modes:{}})}}st.COMMAND="221";class it extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},text:{trailing:!0}})}}it.COMMAND="301";class ot extends ce{constructor(e,t,n){super(e,t,n,{me:{},hosts:{trailing:!0}})}}ot.COMMAND="302";class at extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}at.COMMAND="305";class ct extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}ct.COMMAND="306";class ut extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}ut.COMMAND="311";class lt extends ce{constructor(e,t,n){super(e,t,n,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof Ue}endsResponseTo(){return!0}}lt.COMMAND="315";class ht extends ce{constructor(e,t,n){super(e,t,n,{me:{},nickMask:{},suffix:{trailing:!0}})}}ht.COMMAND="318";class dt extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},channels:{trailing:!0}})}}dt.COMMAND="319";class pt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}pt.COMMAND="322";class gt extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}gt.COMMAND="323";class ft extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}ft.COMMAND="324";class mt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}mt.COMMAND="331";class _t extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}_t.COMMAND="332";class vt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},who:{},ts:{}})}}vt.COMMAND="333";class yt extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},channel:{type:"channel"}})}}yt.COMMAND="341";class bt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}bt.COMMAND="348";class wt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}wt.COMMAND="349";class Ct extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof Ue}}Ct.COMMAND="352";class kt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof Ae}}kt.COMMAND="353";class Tt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof Ae}endsResponseTo(){return!0}}Tt.COMMAND="366";class Mt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}Mt.COMMAND="367";class Nt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Nt.COMMAND="368";class Rt extends ce{constructor(e,t,n){super(e,t,n,{me:{},line:{trailing:!0}})}}Rt.COMMAND="372";class Ot extends ce{constructor(e,t,n){super(e,t,n,{me:{},line:{trailing:!0}})}}Ot.COMMAND="375";class xt extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}xt.COMMAND="376";class Et extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}Et.COMMAND="381";class At extends ce{constructor(e,t,n){super(e,t,n,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}At.COMMAND="391";class St extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},suffix:{trailing:!0}})}}St.COMMAND="401";class It extends ce{constructor(e,t,n){super(e,t,n,{me:{},server:{},suffix:{trailing:!0}})}}It.COMMAND="402";class Pt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{},suffix:{trailing:!0}})}}Pt.COMMAND="403";class Dt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Dt.COMMAND="404";class jt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}jt.COMMAND="405";class Lt extends ce{constructor(e,t,n){super(e,t,n,{me:{},subCommand:{},suffix:{trailing:!0}})}}Lt.COMMAND="410";class Ut extends ce{constructor(e,t,n){super(e,t,n,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}Ut.COMMAND="421";class $t extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}$t.COMMAND="422";class Ft extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}Ft.COMMAND="431";class qt extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}qt.COMMAND="432";class Bt extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}Bt.COMMAND="433";class Gt extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}Gt.COMMAND="436";class Wt extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}Wt.COMMAND="441";class zt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}zt.COMMAND="442";class Ht extends ce{constructor(e,t,n){super(e,t,n,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return"NICK"===e.command}endsResponseTo(){return!0}}Ht.COMMAND="443";class Qt extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}Qt.COMMAND="451";class Jt extends ce{constructor(e,t,n){super(e,t,n,{me:{},originalCommand:{},suffix:{trailing:!0}})}}Jt.COMMAND="461";class Kt extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}Kt.COMMAND="462";class Vt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Vt.COMMAND="471";class Yt extends ce{constructor(e,t,n){super(e,t,n,{me:{},char:{},suffix:{trailing:!0}})}}Yt.COMMAND="472";class Zt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Zt.COMMAND="473";class Xt extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Xt.COMMAND="474";class en extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}en.COMMAND="475";class tn extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{},suffix:{trailing:!0}})}}tn.COMMAND="479";class nn extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}nn.COMMAND="481";class rn extends ce{constructor(e,t,n){super(e,t,n,{me:{},channel:{},suffix:{trailing:!0}})}}rn.COMMAND="482";class sn extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}sn.COMMAND="491";class on extends ce{constructor(e,t,n){super(e,t,n,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}on.COMMAND="501";class an extends ce{constructor(e,t,n){super(e,t,n,{me:{},suffix:{trailing:!0}})}}an.COMMAND="502";const cn=new Map([...Object.values(s),...Object.values(i)].map((e=>[e.COMMAND,e])));function un(e){const[t,n]=K(e,"!",2);if(n){const[e,r]=K(n,"@",2);return r?{nick:t,user:e,host:r}:{nick:t,host:e}}return{nick:t}}const ln={":":";",n:"\n",r:"\r",s:" "};function hn(e){const t=new Map,n=e.split(";");for(const r of n){const[e,n]=K(r,"=",2);""!==e&&t.set(e,n?n.replace(/\\(.?)/g,((e,t)=>Object.prototype.hasOwnProperty.call(ln,t)?ln[t]:t)):"")}return t}class dn extends R.v{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=Z(ne),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:t,credentials:n,channels:s,channelTypes:i,webSocket:o,logger:c={}}=e;this._options=e;const{pingOnInactivity:u=60,pingTimeout:l=10}=t;this._pingOnInactivity=u,this._pingTimeout=l,this._currentNick=n.nick,this._logger=(0,a.h)({name:"ircv3",emoji:!0,...c}),this.registerCoreMessageTypes();const{hostName:h,secure:d,reconnect:p=!0}=t,g={hostName:h,port:this.port,secure:d},f={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},m=o?z.C:H;this._connection=p?new Q.U(m,g,f):new m(f,this._logger,e.connectionOptions);for(const a of Object.values(r))this.addCapability(a);this.addInternalListener(this.onRegister,(async()=>{const e=this._hasRegisteredBefore,t=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const n=e&&this._options.rejoinChannelsOnReconnect?t:await(0,k.R)(s);if(n)for(const r of n)this.join(r)})),this.onTypedMessage(Ye,(async e=>{let{subCommand:t,capabilities:n}=e;const r=n.split(" ");switch(t.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${r.join(", ")}`);const e=J(r,(e=>{if(!e)return{};const[t,n]=K(e,"=",2);return{[t]:{name:t,param:n||!0}}}));for(const[n,r]of Object.entries(e))this._serverCapabilities.set(n,r);const t=Object.keys(e);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter((e=>{let[n]=e;return t.includes(n)})).map((e=>{let[,t]=e;return t})));break}case"DEL":this._logger.debug(`Server removed capabilities: ${r.join(", ")}`);for(const e of r)this._serverCapabilities.delete(e),this._negotiatedCapabilities.delete(e)}})),this.onTypedMessage(Be,(e=>{let{text:t}=e;this.sendMessage(Ge,{text:t})})),this.onTypedMessage(Xe,(e=>{let{me:t}=e;return this._handleReceivedClientNick(t)})),this.onTypedMessage(nt,(e=>{let{userModes:t}=e;t&&(this._serverProperties.supportedUserModes=t)})),this.onTypedMessage(rt,(e=>{let{supports:t}=e;const n=J(t.split(" "),(e=>{const[t,n]=K(e,"=",2);return{[t]:n||!0}}));this._supportedFeatures={...this._supportedFeatures,...n}})),this.onTypedMessage(xt,(e=>{let{me:t}=e;this._registered||(this._handleReceivedClientNick(t),this._registered=!0,this.emit(this.onRegister))})),this.onTypedMessage($t,(e=>{let{me:t}=e;this._registered||(this._handleReceivedClientNick(t),this._registered=!0,this.emit(this.onRegister))})),this.onTypedMessage(Kt,(e=>{let{me:t}=e;this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(t),this._registered=!0,this.emit(this.onRegister))})),this.onTypedMessage(je,(e=>{var t;const{target:n,text:r}=e,s=oe(r),i=null===(t=e.prefix)||void 0===t?void 0:t.nick;s?"ACTION"===s.command?this.emit(this.onAction,n,i,s.params,e):this.emit(this.onCtcp,n,i,s.command,s.params,e):this.emit(this.onPrivmsg,n,i,r,e)})),this.onTypedMessage(we,(e=>{var t;const{nick:n}=e,r=null===(t=e.prefix)||void 0===t?void 0:t.nick;r===this._currentNick&&(this._currentNick=n),this.emit(this.onNickChange,r,n,e)})),this.onTypedMessage(Le,(e=>{var t;const{target:n,text:r}=e,s=oe(r),i=null===(t=e.prefix)||void 0===t?void 0:t.nick;s&&this.emit(this.onCtcpReply,n,i,s.command,s.params,e),this.emit(this.onNotice,n,i,r,e)})),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(Ne,(e=>{let{channel:t,prefix:n}=e;(null===n||void 0===n?void 0:n.nick)===this._currentNick&&this.acknowledgeJoin(t)})),this.onTypedMessage(Re,(e=>{var t;(null===(t=e.prefix)||void 0===t?void 0:t.nick)===this._currentNick&&(this._currentChannels.delete(e.channel),this._channelsFromLastRegister.delete(e.channel))})),this.addInternalListener(this.onRegister,(()=>this._startPingCheckTimer())),this._desiredNick=n.nick,this._userName=n.userName,this._realName=n.realName,i&&(this._serverProperties.channelTypes=i)}receiveLine(e){var t;let n;this._logger.debug(`Received message: ${e}`);try{n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cn,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=e.split(" ");let a,c;const u=[];let l,h;for(;o.length;){if(a=o[0],!a.startsWith("@")||l||c||h)if(a.startsWith(":")){if(h||c){u.push({value:o.join(" ").slice(1),trailing:!0});break}a.length>1&&(h=un(a.slice(1)))}else c?u.push({value:a,trailing:!1}):c=a.toUpperCase();else l=hn(a.slice(1));o.shift()}if(l||(l=new Map),!c)throw new Error(`line without command received: ${e}`);i&&(i=!s.includes(c));let d=ce;return n.has(c)&&(d=n.get(c)),new d(c,{params:u,tags:l,prefix:h,rawLine:e},{serverProperties:t,isServer:r,shouldParseParams:i})}(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(r){return this._logger.error(`Error parsing message: ${r.message}`),void this._logger.trace(null!==(t=r.stack)&&void 0!==t?t:"No stack available")}this._logger.trace(`Parsed message: ${JSON.stringify(n)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,n),this._handleEvents(n)}get serverProperties(){return Z(this._serverProperties)}get port(){const{webSocket:e,connection:{port:t,secure:n}}=this._options;return t||(e?n?443:80:n?6697:6667)}pingCheck(){const e=Date.now(),t=e.toString(),n=this.onTypedMessage(Ge,(r=>{const{text:s}=r;s===t&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(n))}));this._pingTimeoutTimer=setTimeout((()=>{this.removeMessageListener(n),!1===this._options.connection.reconnect?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()}),1e3*this._pingTimeout),this.sendMessage(Be,{text:t})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){""!==e.COMMAND&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const t of Object.values(e.messageTypes))this.registerMessageType(t)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,t,n){this._events.has(e)||this._events.set(e,new Map);const r=this._events.get(e);if(!n)do{n=`${e}:${V(1e4*Math.random(),4,"0")}`}while(r.has(n));return r.set(n,t),n}onTypedMessage(e,t,n){return this.onNamedMessage(e.COMMAND,t,n)}removeMessageListener(e){const[t]=e.split(":");this._events.has(t)&&this._events.get(t).delete(e)}createMessage(e,t,n){return function(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ne,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=new e(e.COMMAND,void 0,{serverProperties:s}),a={};if(o._paramSpec&&Y(o._paramSpec,((n,r)=>{if((!i||!n.noServer)&&(i||!n.noClient)){if(r in t){const i=t[r];if(void 0!==i)if(e.checkParam(i,n,s))a[r]={value:i,trailing:Boolean(n.trailing)};else if(!n.optional)throw new Error(`required parameter "${r}" did not suit requirements: "${i}"`)}if(!(r in a)&&!n.optional)throw new Error(`required parameter "${r}" not found in command "${e.COMMAND}"`)}})),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var e,t;return null===(t=null===(e=this._parsedParams)||void 0===e?void 0:e[c])||void 0===t?void 0:t.value}});return o._initPrefixAndTags(n,r),o}(e,t,void 0,n?new Map(Object.entries(n)):void 0,this.serverProperties)}sendMessage(e,t,n){this.send(this.createMessage(e,t,n))}async sendMessageAndCaptureReply(e,t){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const n=this.createMessage(e,t),r=this.collect(n).promise();return this.send(n),await r}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=new ye(this,e,...n);return this._collectors.push(s),s}stopCollect(e){this._collectors.splice(this._collectors.findIndex((t=>t===e)),1)}join(e,t){this.sendMessage(Ne,{channel:e,key:t})}part(e){this.sendMessage(Re,{channel:e})}quit(e){this.sendMessage(Te,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.sendMessage(je,{target:e,text:t},n)}sendCtcp(e,t,n){this.say(e,`\x01${t.toUpperCase()} ${n}\x01`)}action(e,t){this.sendCtcp(e,"ACTION",t)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(we,{nick:e}))}registerCoreMessageTypes(){Y(s,(e=>{this.registerMessageType(e)})),Y(i,(e=>{this.registerMessageType(e)}))}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter((e=>e.length)).map((async e=>await this._negotiateCapabilities(e))))}async _negotiateCapabilities(e){const t=J(e,(e=>({[e.name]:e}))),n=(await this.sendMessageAndCaptureReply(Ye,{subCommand:"REQ",capabilities:e.map((e=>e.name)).join(" ")})).shift();if(!n)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(n instanceof Ye))throw new Error(`capability negotiation failed unexpectedly with "${n.command}" command`);const r=n.capabilities.split(" ").filter((e=>e));if("ACK"===n.subCommand){this._logger.debug(`Successfully negotiated capabilities: ${r.join(", ")}`);const e=r.map((e=>t[e]));for(const t of e){const e=this._clientCapabilities.get(t.name);e.param=t.param,this._negotiatedCapabilities.set(e.name,e)}return e}return this._logger.warn(`Failed to negotiate capabilities: ${r.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect((async()=>{var e,t;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[n]=await Promise.all([(0,k.R)(this._options.credentials.password),this.sendMessageAndCaptureReply(Ye,{subCommand:"LS",version:"302"}).then((e=>{if(!e.length||!(e[0]instanceof Ye))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const t=e.map((e=>J(e.capabilities.split(" "),(e=>{if(!e)return{};const[t,n]=K(e,"=",2);return{[t]:{name:t,param:n||!0}}}))));this._serverCapabilities=new Map(Object.entries(Object.assign({},...t))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const n=t.map((e=>{const t=Object.keys(e);return Array.from(this._clientCapabilities.entries()).filter((e=>{let[n]=e;return t.includes(n)})).map((e=>{let[,t]=e;return t}))}));return this._negotiateCapabilityBatch(n)})).then((()=>{this.sendMessage(Ye,{subCommand:"END"})}))]);n&&this.sendMessage(be,{password:n}),this.sendMessage(we,{nick:this._desiredNick}),this.sendMessage(Ce,{user:null!==(e=this._userName)&&void 0!==e?e:this._desiredNick,mode:"8",unused:"*",realName:null!==(t=this._realName)&&void 0!==t?t:this._desiredNick})}catch(n){this.emit(this.onPasswordError,n),this.quit()}})),this._initialConnectionSetupDone=!0,this._connection.onReceive((e=>{this.receiveLine(e)})),this._connection.onDisconnect(((e,t)=>{var n;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const e=null===(n=this._options.connection.reconnect)||void 0===n||n,r=t?`Disconnected unexpectedly: ${t.message}`:"Disconnected unexpectedly";e?this._logger.warn(`${r}; trying to reconnect`):this._logger.error(r)}this.emit(this.onDisconnect,e,t)})),this._connection.onEnd((e=>{e||this._logger.warn("No further retries will be made")})))}_handleReceivedClientNick(e){this._currentNick!==e&&(""!==this._currentNick&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some((t=>t.collect(e)));const t=this._events.get(e.constructor.COMMAND);if(t)for(const n of t.values())n(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout((()=>this.pingCheck()),1e3*this._pingOnInactivity):this._pingCheckTimer=void 0}}W([(0,N._)(!1)],dn.prototype,"_options",void 0);class pn extends Error{constructor(e){var t;super(`Received error from IRC server: ${null!==e.rawLine&&void 0!==t?t:"[message internally built]"}`),this.ircMessage=e,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}}class gn extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return null!==(e=this._tags.get("target-user-id"))&&void 0!==e?e:null}}gn.COMMAND="CLEARCHAT";class fn extends ce{}fn.COMMAND="RECONNECT";class mn extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"}})}}function _n(e){switch(typeof e){case"undefined":return"";case"object":{if(null===e)return"";if("cacheKey"in e)return e.cacheKey;const t=JSON.stringify(e);if("{}"!==t)return t}default:return e.toString()}}function vn(e,t,n){return[e,...t.map(_n)].join("/")+(n?"/":"")}function yn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return function(t,n,r){if(r.get){const t=r.get;r.get=function(){const r=vn(n,[]),s=this.getFromCache(r);if(s)return s;const i=t.call(this);return this.setCache(r,i,e),i}}return r}}var bn;mn.COMMAND="ROOMSTATE";let wn=bn=class{constructor(e,t){this._userName=e.toLowerCase(),this._userData=t?new Map(t):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map((e=>{const t=e.indexOf("/");return-1===t?[e,""]:[e.slice(0,t),e.slice(t+1)]}))):new Map}get userName(){return this._userName}get displayName(){var e;return null!==(e=this._userData.get("display-name"))&&void 0!==e?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return bn._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return bn._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){return this._userData.has("vip")}get isArtist(){return this.badges.has("artist-badge")}};function Cn(e){return e?new Map(e.split("/").map((e=>{const[t,n]=e.split(":",2);return n?[t,n.split(",")]:null})).filter((e=>null!==e))):new Map}o([(0,N._)(!1)],wn.prototype,"_userData",void 0),o([yn()],wn.prototype,"badges",null),o([yn()],wn.prototype,"badgeInfo",null),wn=bn=o([function(e){return class extends e{constructor(){super(...arguments),this.cache=new Map}getFromCache(e){if(this._cleanCache(),this.cache.has(e)){const t=this.cache.get(e);if(t)return t.value}}setCache(e,t,n){this.cache.set(e,{value:t,expires:Date.now()+1e3*n})}removeFromCache(e,t){const n=this._getInternalCacheKey(e,t);t?this.cache.forEach(((e,t)=>{t.startsWith(n)&&this.cache.delete(t)})):this.cache.delete(n)}_cleanCache(){const e=Date.now();this.cache.forEach(((t,n)=>{t.expires<e&&this.cache.delete(n)}))}_getInternalCacheKey(e,t){if("string"===typeof e){let t=e;return t.endsWith("/")||(t+="/"),t}return vn(e.shift(),e,t)}}},(0,U.P)("chat","ChatUser","userId")],wn);class kn extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new wn(this._tags.get("login"),this._tags)}get channelId(){var e;return null!==(e=this._tags.get("room-id"))&&void 0!==e?e:null}get emoteOffsets(){return Cn(this._tags.get("emotes"))}}kn.COMMAND="USERNOTICE";class Tn extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"}})}}Tn.COMMAND="USERSTATE";class Mn extends ce{constructor(e,t,n){super(e,t,n,{target:{},text:{trailing:!0}})}get userInfo(){return new wn(this._prefix.nick,this._tags)}get emoteOffsets(){return Cn(this._tags.get("emotes"))}}Mn.COMMAND="WHISPER";const Nn={name:"twitch.tv/commands",messageTypes:[gn,fn,mn,kn,Tn,Mn]},Rn={name:"twitch.tv/membership"};class On extends ce{constructor(e,t,n){super(e,t,n,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}On.COMMAND="CLEARMSG";class xn extends ce{}xn.COMMAND="GLOBALUSERSTATE";const En={name:"twitch.tv/tags",messageTypes:[xn,On]};let An=class extends je{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new wn(this._prefix.nick,this._tags)}get channelId(){var e;return null!==(e=this._tags.get("room-id"))&&void 0!==e?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return Boolean(this._tags.get("custom-reward-id"))}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return"1"===this._tags.get("first-msg")}get isReturningChatter(){return"1"===this._tags.get("returning-chatter")}get isHighlight(){return"highlighted-message"===this._tags.get("msg-id")}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return null!==(e=this._tags.get("reply-parent-msg-id"))&&void 0!==e?e:null}get parentMessageText(){var e;return null!==(e=this._tags.get("reply-parent-msg-body"))&&void 0!==e?e:null}get parentMessageUserId(){var e;return null!==(e=this._tags.get("reply-parent-user-id"))&&void 0!==e?e:null}get parentMessageUserName(){var e;return null!==(e=this._tags.get("reply-parent-user-login"))&&void 0!==e?e:null}get parentMessageUserDisplayName(){var e;return null!==(e=this._tags.get("reply-parent-display-name"))&&void 0!==e?e:null}get bits(){var e;return Number(null!==(e=this._tags.get("bits"))&&void 0!==e?e:0)}get emoteOffsets(){return Cn(this._tags.get("emotes"))}};An=o([(0,U.P)("chat","ChatMessage","id")],An);function Sn(e,t){if(e.length<=t)return[e];e=e.trim();const n=[];let r=0,s=t;for(;r<e.length;){let i=e.lastIndexOf(" ",s);(-1===i||i<=r||e.length-r+1<=t)&&(i=r+t);const o=e.slice(r,i).trim();o.length&&n.push(o),r=i+(" "===e[i]?1:0),s=r+t}return n}const In=/^[a-z0-9][a-z0-9_]{0,24}$/;function Pn(e){const t=e.replace(/^#/,"").toLowerCase();if(!In.test(t))throw new Error(`"${t}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return t}function Dn(e){return`#${Pn(e)}`}var jn;let Ln=jn=class extends R.v{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t,n,r,s,i;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new x("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new dn({connection:{hostName:null!==(t=e.hostName)&&void 0!==t?t:null===(n=e.webSocket)||void 0===n||n?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:null===(r=e.ssl)||void 0===r||r},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:null===(s=e.webSocket)||void 0===s||s,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect(((e,t)=>{this._messageRateLimiter.clear(),this._messageRateLimiter.pause(),this._joinRateLimiter.clear(),this._joinRateLimiter.pause(),this.emit(this.onDisconnect,e,t)})),this._ircClient.registerMessageType(An),this._chatLogger=(0,a.h)({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...null!==(i=e.authIntents)&&void 0!==i?i:[],"chat"];const o=async e=>{let{type:t,text:n,channel:r,tags:s}=e;"say"===t?this._ircClient.say(r,n,s):this._ircClient.action(r,n)};if(e.isAlwaysMod)this._messageRateLimiter=new y({bucketSize:"verified"===e.botLevel?7500:100,timeFrame:32e3,doRequest:o});else{let t=20;"verified"===e.botLevel?t=7500:"known"===e.botLevel&&(t=50),this._messageRateLimiter=new b(new w({bucketSize:1,timeFrame:1200,logger:{minLevel:c.in.ERROR},doRequest:o,getPartitionKey:e=>{let{channel:t}=e;return t}}),{bucketSize:t,timeFrame:32e3})}this._joinRateLimiter=new y({bucketSize:"verified"===e.botLevel?2e3:20,timeFrame:11e3,doRequest:async e=>{const{promise:t,resolve:n,reject:r}=(0,C.B)();let s;const i=this.addInternalListener(this._onJoinResult,((t,o,a)=>{t===e&&(clearTimeout(s),a?r(a):n(),this.removeListener(i))}));s=setTimeout((()=>{this.removeListener(i),this.emit(this._onJoinResult,e,void 0,"twurple_timeout"),r(new Error(`Did not receive a reply to join ${e} in time; assuming that the join failed`))}),1e4),this._ircClient.join(e),await t}}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause(),this._ircClient.addCapability(En),this._ircClient.addCapability(Nn),e.requestMembershipEvents&&this._ircClient.addCapability(Rn),this._ircClient.onConnect((()=>{this.emit(this.onConnect)})),this._ircClient.onRegister((async()=>{this._messageRateLimiter.resume(),this._joinRateLimiter.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const t=await(0,k.R)(e.channels);t&&await Promise.all(t.map((async e=>{var t;try{await this.join(e)}catch(n){this._chatLogger.warn(`Failed to join configured channel ${e}; original message: ${null!==(t=null===n||void 0===n?void 0:n.message)&&void 0!==t?t:n}`)}})))})),this._ircClient.onPasswordError((e=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${e.message}`),this.emit(this.onTokenFetchFailure,e)})),this._ircClient.onPrivmsg(((e,t,n,r)=>{"jtv"!==t&&this.emit(this.onMessage,Pn(e),t,n,r)})),this._ircClient.onAction(((e,t,n,r)=>{this.emit(this.onAction,Pn(e),t,n,r)})),this.addInternalListener(this._onJoinResult,((e,t,n)=>{n?this.emit(this.onJoinFailure,Pn(e),n):this._ircClient.acknowledgeJoin(e)})),this._ircClient.onTypedMessage(gn,(e=>{const{channel:t,user:n,tags:r}=e,s=Pn(t);if(n){const t=r.get("ban-duration");void 0===t?this.emit(this.onBan,s,n,e):this.emit(this.onTimeout,s,n,Number(t),e)}else this.emit(this.onChatClear,s,e)})),this._ircClient.onTypedMessage(On,(e=>{const{channel:t,targetMessageId:n}=e;this.emit(this.onMessageRemove,Pn(t),n,e)})),this._ircClient.onTypedMessage(Ne,(e=>{let{prefix:t,channel:n}=e;this.emit(this.onJoin,Pn(n),t.nick)})),this._ircClient.onTypedMessage(Re,(e=>{let{prefix:t,channel:n}=e;this.emit(this.onPart,Pn(n),t.nick)})),this._ircClient.onTypedMessage(mn,(e=>{let{channel:t,tags:n}=e,r=!1;if(n.has("subs-only")&&n.has("slow")&&(this.emit(this._onJoinResult,t,n),r=!0),!r){const e=Pn(t);if(n.has("slow")){const t=Number(n.get("slow"));t?this.emit(this.onSlow,e,!0,t):this.emit(this.onSlow,e,!1)}if(n.has("followers-only")){const t=Number(n.get("followers-only"));-1===t?this.emit(this.onFollowersOnly,e,!1):this.emit(this.onFollowersOnly,e,!0,t)}}})),this._ircClient.onTypedMessage(kn,(e=>{const{channel:t,text:n,tags:r}=e,s=r.get("msg-id"),i=Pn(t);switch(s){case"sub":case"resub":{const t="sub"===s?this.onSub:this.onResub,o=r.get("msg-param-sub-plan"),a=r.get("msg-param-streak-months"),c={userId:r.get("user-id"),displayName:r.get("display-name"),plan:o,planName:r.get("msg-param-sub-plan-name"),isPrime:"Prime"===o,months:Number(r.get("msg-param-cumulative-months")),streak:a?Number(a):void 0,message:n};if("true"===r.get("msg-param-was-gifted")){const e="true"===r.get("msg-param-anon-gift"),t=Number(r.get("msg-param-gift-months")),n=Number(r.get("msg-param-gift-month-being-redeemed"));c.originalGiftInfo=e?{anonymous:!0,duration:t,redeemedMonth:n}:{anonymous:!1,duration:t,redeemedMonth:n,userId:r.get("msg-param-gifter-id"),userName:r.get("msg-param-gifter-login"),userDisplayName:r.get("msg-param-gifter-name")}}this.emit(t,i,r.get("login"),c,e);break}case"subgift":{const t=r.get("msg-param-sub-plan"),n=r.get("login"),s="ananonymousgifter"===n,o={userId:r.get("msg-param-recipient-id"),displayName:r.get("msg-param-recipient-display-name"),gifter:s?void 0:n,gifterUserId:s?void 0:r.get("user-id"),gifterDisplayName:s?void 0:r.get("display-name"),gifterGiftCount:s?void 0:Number(r.get("msg-param-sender-count")),giftDuration:Number(r.get("msg-param-gift-months")),plan:t,planName:r.get("msg-param-sub-plan-name"),isPrime:"Prime"===t,months:Number(r.get("msg-param-months"))};this.emit(this.onSubGift,i,r.get("msg-param-recipient-user-name"),o,e);break}case"submysterygift":{const t=r.get("login"),n="ananonymousgifter"===t,s={gifter:n?void 0:t,gifterUserId:n?void 0:r.get("user-id"),gifterDisplayName:n?void 0:r.get("display-name"),gifterGiftCount:n?void 0:Number(r.get("msg-param-sender-count")),count:Number(r.get("msg-param-mass-gift-count")),plan:r.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,i,r.get("login"),s,e);break}case"primepaidupgrade":{const t={userId:r.get("user-id"),displayName:r.get("display-name"),plan:r.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,i,r.get("login"),t,e);break}case"giftpaidupgrade":{const t={userId:r.get("user-id"),displayName:r.get("display-name"),gifter:r.get("msg-param-sender-login"),gifterDisplayName:r.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,i,r.get("login"),t,e);break}case"standardpayforward":{const t="true"===r.get("msg-param-prior-gifter-anonymous"),n={userId:r.get("user-id"),displayName:r.get("display-name"),originalGifterUserId:t?void 0:r.get("msg-param-prior-gifter-id"),originalGifterDisplayName:t?void 0:r.get("msg-param-prior-gifter-display-name"),recipientUserId:r.get("msg-param-recipient-id"),recipientDisplayName:r.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,i,r.get("login"),n,e);break}case"communitypayforward":{const t="true"===r.get("msg-param-prior-gifter-anonymous"),n={userId:r.get("user-id"),displayName:r.get("display-name"),originalGifterUserId:t?void 0:r.get("msg-param-prior-gifter-id"),originalGifterDisplayName:t?void 0:r.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,i,r.get("login"),n,e);break}case"primecommunitygiftreceived":{const t={name:r.get("msg-param-gift-name"),gifter:r.get("login"),gifterDisplayName:r.get("display-name")};this.emit(this.onPrimeCommunityGift,i,r.get("msg-param-recipient"),t,e);break}case"raid":{const t={displayName:r.get("msg-param-displayName"),viewerCount:Number(r.get("msg-param-viewerCount"))};this.emit(this.onRaid,i,r.get("login"),t,e);break}case"unraid":this.emit(this.onRaidCancel,i,e);break;case"ritual":{const t={ritualName:r.get("msg-param-ritual-name"),message:n};this.emit(this.onRitual,i,r.get("login"),t,e);break}case"bitsbadgetier":{const t={displayName:r.get("display-name"),threshold:Number(r.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,i,r.get("login"),t,e);break}case"extendsub":{const t={userId:r.get("user-id"),displayName:r.get("display-name"),plan:r.get("msg-param-sub-plan"),months:Number(r.get("msg-param-cumulative-months")),endMonth:Number(r.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,i,r.get("login"),t,e);break}case"rewardgift":{const t={domain:r.get("msg-param-domain"),gifterId:r.get("user-id"),gifterDisplayName:r.get("display-name"),count:Number(r.get("msg-param-selected-count")),gifterGiftCount:Number(r.get("msg-param-total-reward-count")),triggerType:r.get("msg-param-trigger-type")};this.emit(this.onRewardGift,i,r.get("login"),t,e);break}case"announcement":{const t={color:r.get("msg-param-color")};this.emit(this.onAnnouncement,i,r.get("login"),t,e);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${s}`)}})),this._ircClient.onTypedMessage(Mn,(e=>{this.emit(this.onWhisper,e.prefix.nick,e.text,e)})),this._ircClient.onTypedMessage(Le,(async e=>{let{target:t,text:n,tags:r}=e;const s=r.get("msg-id");switch(s){case"emote_only_on":this.emit(this.onEmoteOnly,Pn(t),!0);break;case"emote_only_off":this.emit(this.onEmoteOnly,Pn(t),!1);break;case"msg_channel_suspended":case"msg_banned":this.emit(this._onJoinResult,t,void 0,s);break;case"r9k_on":this.emit(this.onUniqueChat,Pn(t),!0);break;case"r9k_off":this.emit(this.onUniqueChat,Pn(t),!1);break;case"subs_on":this.emit(this.onSubsOnly,Pn(t),!0);break;case"subs_off":this.emit(this.onSubsOnly,Pn(t),!1);break;case"cmds_available":case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":case"timeout_success":case"unrecognized_cmd":break;case"no_permission":this.emit(this.onNoPermission,Pn(t),n);break;case"msg_ratelimit":this.emit(this.onMessageRatelimit,Pn(t),n);break;case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":this.emit(this.onMessageFailed,Pn(t),s);break;case void 0:if("Login authentication failed"===n||"Improperly formatted AUTH"===n||"Invalid NICK"===n){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=(0,T.j)(120),this._authRetryCount=0);const e=this._authRetryTimer.next().value,t=++this._authRetryCount;this.emit(this.onAuthenticationFailure,n,t),0!==e&&this._chatLogger.info(`Retrying authentication in ${e} seconds`),await function(e){return(0,M.mG)(this,void 0,Promise,(function(){return(0,M.Jh)(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))}(1e3*e),this._ircClient.reconnect()}break;default:s.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${s}'`)}}))}connect(){this._authProvider||this._ircClient.changeNick(jn._generateJustinfanNick()),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const s={};var i;n.replyTo&&(s["reply-parent-msg-id"]=(i=n.replyTo)instanceof An?i.tags.get("id"):i);const o=Sn(t,500);await Promise.all(o.map((async t=>await this._messageRateLimiter.request({type:"say",channel:Dn(e),text:t,tags:s},r))))}async action(e,t,n){const r=Sn(t,490);await Promise.all(r.map((async t=>await this._messageRateLimiter.request({type:"action",channel:Dn(e),text:t},n))))}async join(e){await this._joinRateLimiter.request(Dn(e))}part(e){this._ircClient.part(Dn(e))}quit(){this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,t;if(!this._authProvider)return void this._chatLogger.debug("No authProvider given; connecting anonymously");if(this._authToken&&!S(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const n=this._getNecessaryScopes();let r,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,n),!this._authToken)continue;s=!0;const e=await(0,I.z3)(this._authToken.accessToken);if(!e.userName)throw new x("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(e.userName),`oauth:${this._authToken.accessToken}`}catch(i){i instanceof P._?r=i:this._chatLogger.error(`Retrieving an access token failed: ${i.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await(null===(t=(e=this._authProvider).refreshAccessTokenForIntent)||void 0===t?void 0:t.call(e,"chat")),this._authToken){const e=await(0,I.z3)(this._authToken.accessToken);if(!e.userName)throw new x("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(e.userName),`oauth:${this._authToken.accessToken}`}}catch(i){i instanceof P._?r=i:this._chatLogger.error(`Refreshing the access token failed: ${i.message}`)}}throw this._authVerified=!1,null!==r&&void 0!==r?r:new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof G?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(1e5*Math.random()).toString().padStart(5,"0")}`}};o([(0,N._)(!1)],Ln.prototype,"_authProvider",void 0),Ln=jn=o([(0,U.P)("chat","ChatClient")],Ln)},7805:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});class r extends Error{constructor(e,t){var n;super(e,t),Object.setPrototypeOf(this,new.target.prototype),null===(n=Error.captureStackTrace)||void 0===n||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}},4408:function(e,t,n){"use strict";n.d(t,{v:function(){return s}});var r=n(7805);class s extends r.s{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}},2330:function(e,t,n){"use strict";function r(e,t,n){return r=>{const s=n?function(){return`[${t}#${this[n]} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`}:function(){return`[${t} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:s,enumerable:!1})}}n.d(t,{P:function(){return r}})},7564:function(e,t,n){"use strict";n.d(t,{p:function(){return g}});function r(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var s,i=n(4768),o=n(2805),a=n(7),c=n(876),u=n(4936),l=n(3578),h=n(6002),d=n(4408),p=n(2330);let g=s=class extends l.v{constructor(e){super(),this._topics=new Map,this._pingOnActivity=240,this._pingOnInactivity=60,this._pingTimeout=10,this._onPong=this.registerInternalEvent(),this._onResponse=this.registerInternalEvent(),this.onMessage=this.registerEvent(),this.onListenError=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPong=this.registerEvent(),this._logger=(0,a.h)({name:"twurple:pubsub:basic",...null===e||void 0===e?void 0:e.logger}),this._connection=new i.U(o.C,{hostName:"pubsub-edge.twitch.tv",port:443,secure:!0},{logger:this._logger,additionalOptions:{wsOptions:null===e||void 0===e?void 0:e.wsOptions}}),this._connection.onConnect((async()=>{this._logger.info("Connection established"),this._pingCheck(),this._startActivityPingCheckTimer(),this._startInactivityPingCheckTimer(),this._resendListens(),this._topics.size&&(this._logger.info("Listened to previously registered topics"),this._logger.debug(`Previously registered topics: ${Array.from(this._topics.keys()).join(", ")}`)),this.emit(this.onConnect)})),this._connection.onReceive((e=>{this._receiveMessage(e.trim()),this._startInactivityPingCheckTimer()})),this._connection.onDisconnect(((e,t)=>{clearInterval(this._activityPingCheckTimer),clearInterval(this._inactivityPingCheckTimer),clearTimeout(this._pingTimeoutTimer),this.removeInternalListener(),e?this._logger.info("Disconnected"):t?this._logger.error(`Disconnected unexpectedly: ${t.message}`):this._logger.error("Disconnected unexpectedly"),this.emit(this.onDisconnect,e,t)}))}listen(e,t){const n="string"===typeof e?[e]:e,r=s._wrapResolvable(t);for(const s of n)this._topics.set(s,r);this.isConnected&&this._resolveToken(r).then((async e=>await this._sendListen(n,e))).catch((e=>{for(const t of n)this.emit(this.onListenError,t,e,!0)}))}unlisten(e){const t="string"===typeof e?[e]:e;for(const n of e)this._topics.delete(n);this.isConnected&&this._sendUnlisten(t).catch((e=>{var n;this._logger.error(`Error during unlisten of topics ${t.join(", ")}: ${null!==(n=null===e||void 0===e?void 0:e.message)&&void 0!==n?n:e}`)}))}connect(){this._connection.isConnected||this._connection.isConnecting||(this._logger.info("Connecting..."),this._connection.connect())}disconnect(){this._logger.info("Disconnecting..."),this._connection.disconnect()}reconnect(){this.disconnect(),this.connect()}get isConnecting(){return this._connection.isConnecting}get isConnected(){return this._connection.isConnected}get hasAnyTopics(){return this._topics.size>0}async _sendListen(e,t){await this._sendNonced(function(e,t){return{type:"LISTEN",data:{topics:e,auth_token:t}}}(e,t))}async _sendUnlisten(e){await this._sendNonced({type:"UNLISTEN",data:{topics:e}})}static _wrapResolvable(e){switch(typeof e){case"object":return e;case"string":return{type:"static",token:e};case"function":return{type:"function",function:e};default:throw new d.v("Passed unknown type to wrapResolvable: "+typeof e)}}async _resolveToken(e){switch(e.type){case"provider":{const{provider:t,scopes:n,userId:r}=e,{accessToken:s}=await(0,h.B0)(t,r,n,this._logger);return s.accessToken}case"function":return await e.function();case"static":return e.token;default:throw new d.v(`Passed unknown type to resolveToken: ${e.type}`)}}_resendListens(){const e=new Map;for(const[t,n]of this._topics)e.has(n)?e.get(n).push(t):e.set(n,[t]);Array.from(e).reduce(((e,t)=>{let[n,r]=t;return e.then((async e=>{const t=await this._resolveToken(n);return e.has(t)?e.get(t).push(...r):e.set(t,r),e}))}),Promise.resolve(new Map)).then((e=>{for(const[t,n]of e)this._sendListen(n,t).catch((e=>{for(const t of n)this.emit(this.onListenError,t,e,!1)}))}))}async _sendNonced(e){const{promise:t,resolve:n,reject:r}=(0,c.B)(),s=Math.random().toString(16).slice(2),i=this._onResponse(((t,o)=>{t===s&&(o?r(new Error(`Error sending nonced ${e.type} packet: ${o}`)):n(),i.unbind())}));e.nonce=s,this._sendPacket(e),await t}_receiveMessage(e){this._logger.debug(`Received message: ${e}`);const t=JSON.parse(e);switch(t.type){case"PONG":this.emit(this._onPong);break;case"RECONNECT":this.reconnect();break;case"RESPONSE":this.emit(this._onResponse,t.nonce,t.error);break;case"MESSAGE":this.emit(this.onMessage,t.data.topic,JSON.parse(t.data.message));break;default:this._logger.warn(`PubSub connection received unexpected message type: ${t.type}`)}}_sendPacket(e){const t=JSON.stringify(e);this._logger.debug(`Sending message: ${t}`),this._connection.sendLine(t)}_pingCheck(){const e=Date.now();this._onPong((()=>{const t=Date.now()-e;this.emit(this.onPong,t,e),this._logger.info(`Current latency: ${t}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeInternalListener(this._onPong)})),this._pingTimeoutTimer=setTimeout((async()=>{this._logger.error("Ping timeout"),this.removeInternalListener(this._onPong),this._connection.assumeExternalDisconnect()}),1e3*this._pingTimeout),this._sendPacket({type:"PING"})}_startActivityPingCheckTimer(){clearInterval(this._activityPingCheckTimer),this._connection.isConnected?this._activityPingCheckTimer=setInterval((()=>{this._startInactivityPingCheckTimer(),this._pingCheck()}),1e3*this._pingOnActivity):this._activityPingCheckTimer=void 0}_startInactivityPingCheckTimer(){clearInterval(this._inactivityPingCheckTimer),this._connection.isConnected?this._inactivityPingCheckTimer=setInterval((()=>{this._startActivityPingCheckTimer(),this._pingCheck()}),1e3*this._pingOnInactivity):this._inactivityPingCheckTimer=void 0}};r([(0,u._)(!1)],g.prototype,"_logger",void 0),r([(0,u._)(!1)],g.prototype,"_topics",void 0),g=s=r([(0,p.P)("pubsub","BasicPubSubClient")],g)}}]);
//# sourceMappingURL=799.4bfbc80e.chunk.js.map